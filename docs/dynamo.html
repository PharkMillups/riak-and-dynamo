<!DOCTYPE html>  <html> <head>   <title>dynamo.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               dynamo.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>Hear Ye! Hear Ye! This is not done. It's a work in progress.</strong></p>

<p>This is a modified version of Amazon's Dynamo Paper, annotated with information about Riak and how its design compares to Dynamo. 
Basho Technologies built  Riak based on many (but not all) of the ideas and design decisions set forth in this paper. We 
often get questions about how closely we adhered to the principles and design decisions
put forth in the paper. I thought it would be worthwhile to annotate it with 
Riak specifics.  </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>In the right column, you'll find the paper reprinted in its entirety, images and all. 
In this, the left column, you have Riak specifics that relate to a given section of the paper; 
anything from links to the Riak wiki, to code references, to explanations of why and how
we did what we did when we did it. There is also some work to do to make Riak more like Dynamo in some 
ways. This is noted, too. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The goal for this resource is to simplify the Dynamo paper in the context of Riak and better introduce Riak's
design principles to developers and technologists. I hope you enjoy it and find it useful. If there's something
you believe needs changing, drop me a note or <a href="#">submit a pull request</a>. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><a href="https://twitter.com/pharkmillups">Mark</a></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <hr>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Dynamo</span><span class="o">:</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">Highly</span> <span class="nx">Available</span> <span class="nx">Key</span><span class="o">-</span><span class="nx">value</span> <span class="nx">Store</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>This paper was first release in ... and was popularized on the blog of Werner Vogels. Since then there 
has been a large amount of databases that were insprired (either entirely or partially) by this paper. 
In addition to Riak, Cassandra and Voldemort come to mind. Some of you may also remember 
Dynomite (which predates all of these). I'm sure there are more. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Giuseppe</span> <span class="nx">DeCandia</span><span class="p">,</span> <span class="nx">Deniz</span> <span class="nx">Hastorun</span><span class="p">,</span> <span class="nx">Madan</span> <span class="nx">Jampani</span><span class="p">,</span> <span class="nx">Gunavardhan</span> <span class="nx">Kakulapati</span><span class="p">,</span> 
<span class="nx">Avinash</span> <span class="nx">Lakshman</span><span class="p">,</span> <span class="nx">Alex</span> <span class="nx">Pilchin</span><span class="p">,</span> <span class="nx">Swaminathan</span> <span class="nx">Sivasubramanian</span><span class="p">,</span> <span class="nx">Peter</span> <span class="nx">Vosshall</span> <span class="nx">and</span> <span class="nx">Werner</span> <span class="nx">Vogels</span>

<span class="nx">Amazon</span><span class="p">.</span><span class="nx">com</span>

<span class="nx">Abstract</span>

<span class="nx">Reliability</span> <span class="nx">at</span> <span class="nx">massive</span> <span class="nx">scale</span> <span class="nx">is</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">biggest</span> <span class="nx">challenges</span> <span class="nx">we</span> <span class="nx">face</span> <span class="nx">at</span> <span class="nx">Amazon</span><span class="p">.</span><span class="nx">com</span><span class="p">,</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">largest</span> <span class="nx">e</span><span class="o">-</span><span class="nx">commerce</span> <span class="nx">operations</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">world</span><span class="p">;</span> <span class="nx">even</span> <span class="nx">the</span> <span class="nx">slightest</span> <span class="nx">outage</span> <span class="nx">has</span> <span class="nx">significant</span> <span class="nx">financial</span> 
<span class="nx">consequences</span> <span class="nx">and</span> <span class="nx">impacts</span> <span class="nx">customer</span> <span class="nx">trust</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">Amazon</span><span class="p">.</span><span class="nx">com</span> <span class="nx">platform</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">provides</span> <span class="nx">services</span> <span class="k">for</span> 
<span class="nx">many</span> <span class="nx">web</span> <span class="nx">sites</span> <span class="nx">worldwide</span><span class="p">,</span> <span class="nx">is</span> <span class="nx">implemented</span> <span class="nx">on</span> <span class="nx">top</span> <span class="nx">of</span> <span class="nx">an</span> <span class="nx">infrastructure</span> <span class="nx">of</span> <span class="nx">tens</span> <span class="nx">of</span> <span class="nx">thousands</span> <span class="nx">of</span> 
<span class="nx">servers</span> <span class="nx">and</span> <span class="nx">network</span> <span class="nx">components</span> <span class="nx">located</span> <span class="k">in</span> <span class="nx">many</span> <span class="nx">datacenters</span> <span class="nx">around</span> <span class="nx">the</span> <span class="nx">world</span><span class="p">.</span> <span class="nx">At</span> <span class="k">this</span> <span class="nx">scale</span><span class="p">,</span> 
<span class="nx">small</span> <span class="nx">and</span> <span class="nx">large</span> <span class="nx">components</span> <span class="nx">fail</span> <span class="nx">continuously</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">way</span> <span class="nx">persistent</span> <span class="nx">state</span> <span class="nx">is</span> <span class="nx">managed</span> <span class="k">in</span> <span class="nx">the</span> 
<span class="nx">face</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">failures</span> <span class="nx">drives</span> <span class="nx">the</span> <span class="nx">reliability</span> <span class="nx">and</span> <span class="nx">scalability</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">software</span> <span class="nx">systems</span><span class="p">.</span>

<span class="nx">This</span> <span class="nx">paper</span> <span class="nx">presents</span> <span class="nx">the</span> <span class="nx">design</span> <span class="nx">and</span> <span class="nx">implementation</span> <span class="nx">of</span> <span class="nx">Dynamo</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">highly</span> <span class="nx">available</span> <span class="nx">key</span><span class="o">-</span><span class="nx">value</span> 
<span class="nx">storage</span> <span class="nx">system</span> <span class="nx">that</span> <span class="nx">some</span> <span class="nx">of</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">core</span> <span class="nx">services</span> <span class="nx">use</span> <span class="nx">to</span> <span class="nx">provide</span> <span class="nx">an</span> <span class="err">“</span><span class="nx">always</span><span class="o">-</span><span class="nx">on</span><span class="err">”</span> <span class="nx">experience</span><span class="p">.</span>  
<span class="nx">To</span> <span class="nx">achieve</span> <span class="k">this</span> <span class="nx">level</span> <span class="nx">of</span> <span class="nx">availability</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">sacrifices</span> <span class="nx">consistency</span> <span class="nx">under</span> <span class="nx">certain</span> <span class="nx">failure</span> <span class="nx">scenarios</span><span class="p">.</span> 
<span class="nx">It</span> <span class="nx">makes</span> <span class="nx">extensive</span> <span class="nx">use</span> <span class="nx">of</span> <span class="nx">object</span> <span class="nx">versioning</span> <span class="nx">and</span> <span class="nx">application</span><span class="o">-</span><span class="nx">assisted</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">manner</span> 
<span class="nx">that</span> <span class="nx">provides</span> <span class="nx">a</span> <span class="nx">novel</span> <span class="kr">interface</span> <span class="k">for</span> <span class="nx">developers</span> <span class="nx">to</span> <span class="nx">use</span><span class="p">.</span>

<span class="nx">Categories</span> <span class="nx">and</span> <span class="nx">Subject</span> <span class="nx">Descriptors</span>
<span class="nx">D</span><span class="p">.</span><span class="mf">4.2</span> <span class="p">[</span><span class="nx">Operating</span> <span class="nx">Systems</span><span class="p">]</span><span class="o">:</span> <span class="nx">Storage</span> <span class="nx">Management</span><span class="p">;</span> <span class="nx">D</span><span class="p">.</span><span class="mf">4.5</span> <span class="p">[</span><span class="nx">Operating</span> <span class="nx">Systems</span><span class="p">]</span><span class="o">:</span> <span class="nx">Reliability</span><span class="p">;</span> <span class="nx">D</span><span class="p">.</span><span class="mf">4.2</span> 
<span class="p">[</span><span class="nx">Operating</span> <span class="nx">Systems</span><span class="p">]</span><span class="o">:</span> <span class="nx">Performance</span><span class="p">;</span>

<span class="nx">General</span> <span class="nx">Terms</span>
<span class="nx">Algorithms</span><span class="p">,</span> <span class="nx">Management</span><span class="p">,</span> <span class="nx">Measurement</span><span class="p">,</span> <span class="nx">Performance</span><span class="p">,</span> <span class="nx">Design</span><span class="p">,</span> <span class="nx">Reliability</span><span class="p">.</span>

<span class="mi">1</span><span class="p">.</span> <span class="nx">Introduction</span>

<span class="nx">Amazon</span> <span class="nx">runs</span> <span class="nx">a</span> <span class="nx">world</span><span class="o">-</span><span class="nx">wide</span> <span class="nx">e</span><span class="o">-</span><span class="nx">commerce</span> <span class="nx">platform</span> <span class="nx">that</span> <span class="nx">serves</span> <span class="nx">tens</span> <span class="nx">of</span> <span class="nx">millions</span> <span class="nx">customers</span> <span class="nx">at</span> <span class="nx">peak</span> <span class="nx">times</span> <span class="nx">using</span> 
<span class="nx">tens</span> <span class="nx">of</span> <span class="nx">thousands</span> <span class="nx">of</span> <span class="nx">servers</span> <span class="nx">located</span> <span class="k">in</span> <span class="nx">many</span> <span class="nx">data</span> <span class="nx">centers</span> <span class="nx">around</span> <span class="nx">the</span> <span class="nx">world</span><span class="p">.</span> <span class="nx">There</span> <span class="nx">are</span> <span class="nx">strict</span> <span class="nx">operational</span> 
<span class="nx">requirements</span> <span class="nx">on</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span> <span class="k">in</span> <span class="nx">terms</span> <span class="nx">of</span> <span class="nx">performance</span><span class="p">,</span> <span class="nx">reliability</span> <span class="nx">and</span> <span class="nx">efficiency</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">to</span> <span class="nx">support</span> 
<span class="nx">continuous</span> <span class="nx">growth</span> <span class="nx">the</span> <span class="nx">platform</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">highly</span> <span class="nx">scalable</span><span class="p">.</span> <span class="nx">Reliability</span> <span class="nx">is</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">most</span> <span class="nx">important</span> 
<span class="nx">requirements</span> <span class="nx">because</span> <span class="nx">even</span> <span class="nx">the</span> <span class="nx">slightest</span> <span class="nx">outage</span> <span class="nx">has</span> <span class="nx">significant</span> <span class="nx">financial</span> <span class="nx">consequences</span> <span class="nx">and</span> <span class="nx">impacts</span> <span class="nx">customer</span> 
<span class="nx">trust</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">addition</span><span class="p">,</span> <span class="nx">to</span> <span class="nx">support</span> <span class="nx">continuous</span> <span class="nx">growth</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">platform</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">highly</span> <span class="nx">scalable</span><span class="p">.</span>

<span class="nx">One</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">lessons</span> <span class="nx">our</span> <span class="nx">organization</span> <span class="nx">has</span> <span class="nx">learned</span> <span class="nx">from</span> <span class="nx">operating</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">reliability</span> 
<span class="nx">and</span> <span class="nx">scalability</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">system</span> <span class="nx">is</span> <span class="nx">dependent</span> <span class="nx">on</span> <span class="nx">how</span> <span class="nx">its</span> <span class="nx">application</span> <span class="nx">state</span> <span class="nx">is</span> <span class="nx">managed</span><span class="p">.</span> <span class="nx">Amazon</span> <span class="nx">uses</span> <span class="nx">a</span> <span class="nx">highly</span> 
<span class="nx">decentralized</span><span class="p">,</span> <span class="nx">loosely</span> <span class="nx">coupled</span><span class="p">,</span> <span class="nx">service</span> <span class="nx">oriented</span> <span class="nx">architecture</span> <span class="nx">consisting</span> <span class="nx">of</span> <span class="nx">hundreds</span> <span class="nx">of</span> <span class="nx">services</span><span class="p">.</span> <span class="nx">In</span> 
<span class="k">this</span> <span class="nx">environment</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">particular</span> <span class="nx">need</span> <span class="k">for</span> <span class="nx">storage</span> <span class="nx">technologies</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">always</span> <span class="nx">available</span><span class="p">.</span> <span class="nx">For</span> 
<span class="nx">example</span><span class="p">,</span> <span class="nx">customers</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">able</span> <span class="nx">to</span> <span class="nx">view</span> <span class="nx">and</span> <span class="nx">add</span> <span class="nx">items</span> <span class="nx">to</span> <span class="nx">their</span> <span class="nx">shopping</span> <span class="nx">cart</span> <span class="nx">even</span> <span class="k">if</span> <span class="nx">disks</span> <span class="nx">are</span> <span class="nx">failing</span><span class="p">,</span> 
<span class="nx">network</span> <span class="nx">routes</span> <span class="nx">are</span> <span class="nx">flapping</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">data</span> <span class="nx">centers</span> <span class="nx">are</span> <span class="nx">being</span> <span class="nx">destroyed</span> <span class="nx">by</span> <span class="nx">tornados</span><span class="p">.</span> <span class="nx">Therefore</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">service</span> 
<span class="nx">responsible</span> <span class="k">for</span> <span class="nx">managing</span> <span class="nx">shopping</span> <span class="nx">carts</span> <span class="nx">requires</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">can</span> <span class="nx">always</span> <span class="nx">write</span> <span class="nx">to</span> <span class="nx">and</span> <span class="nx">read</span> <span class="nx">from</span> <span class="nx">its</span> <span class="nx">data</span> 
<span class="nx">store</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">that</span> <span class="nx">its</span> <span class="nx">data</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">available</span> <span class="nx">across</span> <span class="nx">multiple</span> <span class="nx">data</span> <span class="nx">centers</span><span class="p">.</span>

<span class="nx">Dealing</span> <span class="kd">with</span> <span class="nx">failures</span> <span class="k">in</span> <span class="nx">an</span> <span class="nx">infrastructure</span> <span class="nx">comprised</span> <span class="nx">of</span> <span class="nx">millions</span> <span class="nx">of</span> <span class="nx">components</span> <span class="nx">is</span> <span class="nx">our</span> <span class="nx">standard</span> 
<span class="nx">mode</span> <span class="nx">of</span> <span class="nx">operation</span><span class="p">;</span> <span class="nx">there</span> <span class="nx">are</span> <span class="nx">always</span> <span class="nx">a</span> <span class="nx">small</span> <span class="nx">but</span> <span class="nx">significant</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">server</span> <span class="nx">and</span> <span class="nx">network</span> <span class="nx">components</span> 
<span class="nx">that</span> <span class="nx">are</span> <span class="nx">failing</span> <span class="nx">at</span> <span class="nx">any</span> <span class="nx">given</span> <span class="nx">time</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">such</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">software</span> <span class="nx">systems</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">constructed</span> <span class="k">in</span> 
<span class="nx">a</span> <span class="nx">manner</span> <span class="nx">that</span> <span class="nx">treats</span> <span class="nx">failure</span> <span class="nx">handling</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">normal</span> <span class="k">case</span> <span class="nx">without</span> <span class="nx">impacting</span> <span class="nx">availability</span> <span class="nx">or</span> 
<span class="nx">performance</span><span class="p">.</span> 

<span class="nx">To</span> <span class="nx">meet</span> <span class="nx">the</span> <span class="nx">reliability</span> <span class="nx">and</span> <span class="nx">scaling</span> <span class="nx">needs</span><span class="p">,</span> <span class="nx">Amazon</span> <span class="nx">has</span> <span class="nx">developed</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">storage</span> 
<span class="nx">technologies</span><span class="p">,</span> <span class="nx">of</span> <span class="nx">which</span> <span class="nx">the</span> <span class="nx">Amazon</span> <span class="nx">Simple</span> <span class="nx">Storage</span> <span class="nx">Service</span> <span class="p">(</span><span class="nx">also</span> <span class="nx">available</span> <span class="nx">outside</span> <span class="nx">of</span> <span class="nx">Amazon</span> <span class="nx">and</span> 
<span class="nx">known</span> <span class="nx">as</span> <span class="nx">Amazon</span> <span class="nx">S3</span><span class="p">),</span> <span class="nx">is</span> <span class="nx">probably</span> <span class="nx">the</span> <span class="nx">best</span> <span class="nx">known</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">paper</span> <span class="nx">presents</span> <span class="nx">the</span> <span class="nx">design</span> <span class="nx">and</span> <span class="nx">implementation</span> <span class="nx">of</span> 
<span class="nx">Dynamo</span><span class="p">,</span> <span class="nx">another</span> <span class="nx">highly</span> <span class="nx">available</span> <span class="nx">and</span> <span class="nx">scalable</span> <span class="nx">distributed</span> <span class="nx">data</span> <span class="nx">store</span> <span class="nx">built</span> <span class="k">for</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span><span class="p">.</span> 
<span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">used</span> <span class="nx">to</span> <span class="nx">manage</span> <span class="nx">the</span> <span class="nx">state</span> <span class="nx">of</span> <span class="nx">services</span> <span class="nx">that</span> <span class="nx">have</span> <span class="nx">very</span> <span class="nx">high</span> <span class="nx">reliability</span> <span class="nx">requirements</span> <span class="nx">and</span> <span class="nx">need</span> 
<span class="nx">tight</span> <span class="nx">control</span> <span class="nx">over</span> <span class="nx">the</span> <span class="nx">tradeoffs</span> <span class="nx">between</span> <span class="nx">availability</span><span class="p">,</span> <span class="nx">consistency</span><span class="p">,</span> <span class="nx">cost</span><span class="o">-</span><span class="nx">effectiveness</span> <span class="nx">and</span> <span class="nx">performance</span><span class="p">.</span> 
<span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span> <span class="nx">has</span> <span class="nx">a</span> <span class="nx">very</span> <span class="nx">diverse</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">applications</span> <span class="kd">with</span> <span class="nx">different</span> <span class="nx">storage</span> <span class="nx">requirements</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">select</span> 
<span class="nx">set</span> <span class="nx">of</span> <span class="nx">applications</span> <span class="nx">requires</span> <span class="nx">a</span> <span class="nx">storage</span> <span class="nx">technology</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">flexible</span> <span class="nx">enough</span> <span class="nx">to</span> <span class="nx">let</span> <span class="nx">application</span> <span class="nx">designers</span> 
<span class="nx">configure</span> <span class="nx">their</span> <span class="nx">data</span> <span class="nx">store</span> <span class="nx">appropriately</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">these</span> <span class="nx">tradeoffs</span> <span class="nx">to</span> <span class="nx">achieve</span> <span class="nx">high</span> <span class="nx">availability</span> <span class="nx">and</span> 
<span class="nx">guaranteed</span> <span class="nx">performance</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">most</span> <span class="nx">cost</span> <span class="nx">effective</span> <span class="nx">manner</span><span class="p">.</span>

<span class="nx">There</span> <span class="nx">are</span> <span class="nx">many</span> <span class="nx">services</span> <span class="nx">on</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span> <span class="nx">that</span> <span class="nx">only</span> <span class="nx">need</span> <span class="nx">primary</span><span class="o">-</span><span class="nx">key</span> <span class="nx">access</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">data</span> <span class="nx">store</span><span class="p">.</span> 
<span class="nx">For</span> <span class="nx">many</span> <span class="nx">services</span><span class="p">,</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">those</span> <span class="nx">that</span> <span class="nx">provide</span> <span class="nx">best</span> <span class="nx">seller</span> <span class="nx">lists</span><span class="p">,</span> <span class="nx">shopping</span> <span class="nx">carts</span><span class="p">,</span> <span class="nx">customer</span> 
<span class="nx">preferences</span><span class="p">,</span> <span class="nx">session</span> <span class="nx">management</span><span class="p">,</span> <span class="nx">sales</span> <span class="nx">rank</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">product</span> <span class="nx">catalog</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">common</span> <span class="nx">pattern</span> <span class="nx">of</span> 
<span class="nx">using</span> <span class="nx">a</span> <span class="nx">relational</span> <span class="nx">database</span> <span class="nx">would</span> <span class="nx">lead</span> <span class="nx">to</span> <span class="nx">inefficiencies</span> <span class="nx">and</span> <span class="nx">limit</span> <span class="nx">scale</span> <span class="nx">and</span> <span class="nx">availability</span><span class="p">.</span> 
<span class="nx">Dynamo</span> <span class="nx">provides</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">primary</span><span class="o">-</span><span class="nx">key</span> <span class="nx">only</span> <span class="kr">interface</span> <span class="nx">to</span> <span class="nx">meet</span> <span class="nx">the</span> <span class="nx">requirements</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">applications</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Like Dynamo, Riak employs consistent hashing to partition and replicate date around the ring. For the consistent hashing that takes place in riak_core, Basho chose the SHA1 hash. </p>

<ul>
<li><a href="http://wiki.basho.com/display/RIAK/Riak+Glossary#RiakGlossary-ConsistentHashing">Consistent Hashing on the Riak wiki</a></li>
</ul>    

<p>Riak uses vector clocks for object versioning. Scroll down to section 4.4 to read up on this in depth.</p>

<p>Riak makes use of gossiping in the same way that Dynamo does: to communicate ring state and node membership.</p>

<ul>
<li><a href="https://wiki.basho.com/display/RIAK/Riak+Glossary#RiakGlossary-Gossiping">Gossip Protocol on the Riak Wiki</a></li>
</ul>

<p>And, nodes can added and removed from your Riak cluster as needed.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">a</span> <span class="nx">synthesis</span> <span class="nx">of</span> <span class="nx">well</span> <span class="nx">known</span> <span class="nx">techniques</span> <span class="nx">to</span> <span class="nx">achieve</span> <span class="nx">scalability</span> <span class="nx">and</span> <span class="nx">availability</span><span class="o">:</span> 
<span class="nx">Data</span> <span class="nx">is</span> <span class="nx">partitioned</span> <span class="nx">and</span> <span class="nx">replicated</span> <span class="nx">using</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="nx">and</span> <span class="nx">consistency</span> <span class="nx">is</span> <span class="nx">facilitated</span> 
<span class="nx">by</span> <span class="nx">object</span> <span class="nx">versioning</span> <span class="p">[</span><span class="mi">12</span><span class="p">].</span> <span class="nx">The</span> <span class="nx">consistency</span> <span class="nx">among</span> <span class="nx">replicas</span> <span class="nx">during</span> <span class="nx">updates</span> <span class="nx">is</span> <span class="nx">maintained</span> <span class="nx">by</span> <span class="nx">a</span> 
<span class="nx">quorum</span><span class="o">-</span><span class="nx">like</span> <span class="nx">technique</span> <span class="nx">and</span> <span class="nx">a</span> <span class="nx">decentralized</span> <span class="nx">replica</span> <span class="nx">synchronization</span> <span class="nx">protocol</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">employs</span> <span class="nx">a</span> <span class="nx">gossip</span> 
<span class="nx">based</span> <span class="nx">distributed</span> <span class="nx">failure</span> <span class="nx">detection</span> <span class="nx">and</span> <span class="nx">membership</span> <span class="nx">protocol</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">completely</span> <span class="nx">decentralized</span> 
<span class="nx">system</span> <span class="kd">with</span> <span class="nx">minimal</span> <span class="nx">need</span> <span class="k">for</span> <span class="nx">manual</span> <span class="nx">administration</span><span class="p">.</span> <span class="nx">Storage</span> <span class="nx">nodes</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">added</span> <span class="nx">and</span> <span class="nx">removed</span> <span class="nx">from</span> 
<span class="nx">Dynamo</span> <span class="nx">without</span> <span class="nx">requiring</span> <span class="nx">any</span> <span class="nx">manual</span> <span class="nx">partitioning</span> <span class="nx">or</span> <span class="nx">redistribution</span><span class="p">.</span>

<span class="nx">In</span> <span class="nx">the</span> <span class="nx">past</span> <span class="nx">year</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">the</span> <span class="nx">underlying</span> <span class="nx">storage</span> <span class="nx">technology</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">core</span> <span class="nx">services</span> <span class="k">in</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">e</span><span class="o">-</span><span class="nx">commerce</span> <span class="nx">platform</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">was</span> <span class="nx">able</span> <span class="nx">to</span> <span class="nx">scale</span> <span class="nx">to</span> <span class="nx">extreme</span> <span class="nx">peak</span> <span class="nx">loads</span> 
<span class="nx">efficiently</span> <span class="nx">without</span> <span class="nx">any</span> <span class="nx">downtime</span> <span class="nx">during</span> <span class="nx">the</span> <span class="nx">busy</span> <span class="nx">holiday</span> <span class="nx">shopping</span> <span class="nx">season</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">example</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">service</span> 
<span class="nx">that</span> <span class="nx">maintains</span> <span class="nx">shopping</span> <span class="nx">cart</span> <span class="p">(</span><span class="nx">Shopping</span> <span class="nx">Cart</span> <span class="nx">Service</span><span class="p">)</span> <span class="nx">served</span> <span class="nx">tens</span> <span class="nx">of</span> <span class="nx">millions</span> <span class="nx">requests</span> <span class="nx">that</span> <span class="nx">resulted</span> 
<span class="k">in</span> <span class="nx">well</span> <span class="nx">over</span> <span class="mi">3</span> <span class="nx">million</span> <span class="nx">checkouts</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">day</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">service</span> <span class="nx">that</span> <span class="nx">manages</span> <span class="nx">session</span> <span class="nx">state</span> <span class="nx">handled</span> 
<span class="nx">hundreds</span> <span class="nx">of</span> <span class="nx">thousands</span> <span class="nx">of</span> <span class="nx">concurrently</span> <span class="nx">active</span> <span class="nx">sessions</span><span class="p">.</span>
<span class="nx">The</span> <span class="nx">main</span> <span class="nx">contribution</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">work</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">research</span> <span class="nx">community</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">evaluation</span> <span class="nx">of</span> <span class="nx">how</span> <span class="nx">different</span> 
<span class="nx">techniques</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">combined</span> <span class="nx">to</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">highly</span><span class="o">-</span><span class="nx">available</span> <span class="nx">system</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">demonstrates</span> <span class="nx">that</span> <span class="nx">an</span> 
<span class="nx">eventually</span><span class="o">-</span><span class="nx">consistent</span> <span class="nx">storage</span> <span class="nx">system</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">used</span> <span class="k">in</span> <span class="nx">production</span> <span class="kd">with</span> <span class="nx">demanding</span> <span class="nx">applications</span><span class="p">.</span> <span class="nx">It</span> 
<span class="nx">also</span> <span class="nx">provides</span> <span class="nx">insight</span> <span class="nx">into</span> <span class="nx">the</span> <span class="nx">tuning</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">techniques</span> <span class="nx">to</span> <span class="nx">meet</span> <span class="nx">the</span> <span class="nx">requirements</span> <span class="nx">of</span> <span class="nx">production</span> 
<span class="nx">systems</span> <span class="kd">with</span> <span class="nx">very</span> <span class="nx">strict</span> <span class="nx">performance</span> <span class="nx">demands</span><span class="p">.</span>
<span class="nx">The</span> <span class="nx">paper</span> <span class="nx">is</span> <span class="nx">structured</span> <span class="nx">as</span> <span class="nx">follows</span><span class="p">.</span> <span class="nx">Section</span> <span class="mi">2</span> <span class="nx">presents</span> <span class="nx">the</span> <span class="nx">background</span> <span class="nx">and</span> <span class="nx">Section</span> <span class="mi">3</span> <span class="nx">presents</span> 
<span class="nx">the</span> <span class="nx">related</span> <span class="nx">work</span><span class="p">.</span> <span class="nx">Section</span> <span class="mi">4</span> <span class="nx">presents</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">design</span> <span class="nx">and</span> <span class="nx">Section</span> <span class="mi">5</span> <span class="nx">describes</span> <span class="nx">the</span> <span class="nx">implementation</span><span class="p">.</span> 
<span class="nx">Section</span> <span class="mi">6</span> <span class="nx">details</span> <span class="nx">the</span> <span class="nx">experiences</span> <span class="nx">and</span> <span class="nx">insights</span> <span class="nx">gained</span> <span class="nx">by</span> <span class="nx">running</span> <span class="nx">Dynamo</span> <span class="k">in</span> <span class="nx">production</span> <span class="nx">and</span> <span class="nx">Section</span> <span class="mi">7</span> 
<span class="nx">concludes</span> <span class="nx">the</span> <span class="nx">paper</span><span class="p">.</span> <span class="nx">There</span> <span class="nx">are</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">places</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">paper</span> <span class="nx">where</span> <span class="nx">additional</span> <span class="nx">information</span> <span class="nx">may</span> 
<span class="nx">have</span> <span class="nx">been</span> <span class="nx">appropriate</span> <span class="nx">but</span> <span class="nx">where</span> <span class="nx">protecting</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">business</span> <span class="nx">interests</span> <span class="nx">require</span> <span class="nx">us</span> <span class="nx">to</span> <span class="nx">reduce</span> <span class="nx">some</span> 
<span class="nx">level</span> <span class="nx">of</span> <span class="nx">detail</span><span class="p">.</span> <span class="nx">For</span> <span class="k">this</span> <span class="nx">reason</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">intra</span><span class="o">-</span> <span class="nx">and</span> <span class="nx">inter</span><span class="o">-</span><span class="nx">datacenter</span> <span class="nx">latencies</span> <span class="k">in</span> <span class="nx">section</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">the</span> 
<span class="nx">absolute</span> <span class="nx">request</span> <span class="nx">rates</span> <span class="k">in</span> <span class="nx">section</span> <span class="mf">6.2</span> <span class="nx">and</span> <span class="nx">outage</span> <span class="nx">lengths</span> <span class="nx">and</span> <span class="nx">workloads</span> <span class="k">in</span> <span class="nx">section</span> <span class="mf">6.3</span> <span class="nx">are</span> 
<span class="nx">provided</span> <span class="nx">through</span> <span class="nx">aggregate</span> <span class="nx">measures</span> <span class="nx">instead</span> <span class="nx">of</span> <span class="nx">absolute</span> <span class="nx">details</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><strong>Brief Background on Riak:</strong></p>

<hr>             </td>             <td class="code">               <div class="highlight"><pre><span class="mi">2</span><span class="p">.</span> <span class="nx">Background</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Basho Technologies started to develop Riak back in 2007 to solve an internal problem. We were, 
at the time, builing a web application that would require a database layer that afforded higher 
availability and scale out properties than any technology we knew of. So, we (primary Justin Sheehy, Andy 
Andy Gross, and Bryan Fink at the time) rolled our own. </p>

<p>After using Riak in production for several successful applications that generated revenue, we decided
to open source it and share our creation with the world. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">e</span><span class="o">-</span><span class="nx">commerce</span> <span class="nx">platform</span> <span class="nx">is</span> <span class="nx">composed</span> <span class="nx">of</span> <span class="nx">hundreds</span> <span class="nx">of</span> <span class="nx">services</span> <span class="nx">that</span> <span class="nx">work</span> <span class="k">in</span> <span class="nx">concert</span> 
<span class="nx">to</span> <span class="nx">deliver</span> <span class="nx">functionality</span> <span class="nx">ranging</span> <span class="nx">from</span> <span class="nx">recommendations</span> <span class="nx">to</span> <span class="nx">order</span> <span class="nx">fulfillment</span> <span class="nx">to</span> <span class="nx">fraud</span> <span class="nx">detection</span><span class="p">.</span> 
<span class="nx">Each</span> <span class="nx">service</span> <span class="nx">is</span> <span class="nx">exposed</span> <span class="nx">through</span> <span class="nx">a</span> <span class="nx">well</span> <span class="nx">defined</span> <span class="kr">interface</span> <span class="nx">and</span> <span class="nx">is</span> <span class="nx">accessible</span> <span class="nx">over</span> <span class="nx">the</span> <span class="nx">network</span><span class="p">.</span> 
<span class="nx">These</span> <span class="nx">services</span> <span class="nx">are</span> <span class="nx">hosted</span> <span class="k">in</span> <span class="nx">an</span> <span class="nx">infrastructure</span> <span class="nx">that</span> <span class="nx">consists</span> <span class="nx">of</span> <span class="nx">tens</span> <span class="nx">of</span> <span class="nx">thousands</span> <span class="nx">of</span> <span class="nx">servers</span> 
<span class="nx">located</span> <span class="nx">across</span> <span class="nx">many</span> <span class="nx">data</span> <span class="nx">centers</span> <span class="nx">world</span><span class="o">-</span><span class="nx">wide</span><span class="p">.</span> <span class="nx">Some</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">services</span> <span class="nx">are</span> <span class="nx">stateless</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> 
<span class="nx">services</span> <span class="nx">which</span> <span class="nx">aggregate</span> <span class="nx">responses</span> <span class="nx">from</span> <span class="nx">other</span> <span class="nx">services</span><span class="p">)</span> <span class="nx">and</span> <span class="nx">some</span> <span class="nx">are</span> <span class="nx">stateful</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">a</span> 
<span class="nx">service</span> <span class="nx">that</span> <span class="nx">generates</span> <span class="nx">its</span> <span class="nx">response</span> <span class="nx">by</span> <span class="nx">executing</span> <span class="nx">business</span> <span class="nx">logic</span> <span class="nx">on</span> <span class="nx">its</span> <span class="nx">state</span> <span class="nx">stored</span> <span class="k">in</span> 
<span class="nx">persistent</span> <span class="nx">store</span><span class="p">).</span>

<span class="nx">Traditionally</span> <span class="nx">production</span> <span class="nx">systems</span> <span class="nx">store</span> <span class="nx">their</span> <span class="nx">state</span> <span class="k">in</span> <span class="nx">relational</span> <span class="nx">databases</span><span class="p">.</span> 
<span class="nx">For</span> <span class="nx">many</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">more</span> <span class="nx">common</span> <span class="nx">usage</span> <span class="nx">patterns</span> <span class="nx">of</span> <span class="nx">state</span> <span class="nx">persistence</span><span class="p">,</span> <span class="nx">however</span><span class="p">,</span> <span class="nx">a</span> 
<span class="nx">relational</span> <span class="nx">database</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">solution</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">far</span> <span class="nx">from</span> <span class="nx">ideal</span><span class="p">.</span> <span class="nx">Most</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">services</span> <span class="nx">only</span> <span class="nx">store</span> <span class="nx">and</span> 
<span class="nx">retrieve</span> <span class="nx">data</span> <span class="nx">by</span> <span class="nx">primary</span> <span class="nx">key</span> <span class="nx">and</span> <span class="k">do</span> <span class="nx">not</span> <span class="nx">require</span> <span class="nx">the</span> <span class="nx">complex</span> <span class="nx">querying</span> <span class="nx">and</span> <span class="nx">management</span> <span class="nx">functionality</span> 
<span class="nx">offered</span> <span class="nx">by</span> <span class="nx">an</span> <span class="nx">RDBMS</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">excess</span> <span class="nx">functionality</span> <span class="nx">requires</span> <span class="nx">expensive</span> <span class="nx">hardware</span> <span class="nx">and</span> <span class="nx">highly</span> <span class="nx">skilled</span> 
<span class="nx">personnel</span> <span class="k">for</span> <span class="nx">its</span> <span class="nx">operation</span><span class="p">,</span> <span class="nx">making</span> <span class="nx">it</span> <span class="nx">a</span> <span class="nx">very</span> <span class="nx">inefficient</span> <span class="nx">solution</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">addition</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">available</span> <span class="nx">replication</span> 
<span class="nx">technologies</span> <span class="nx">are</span> <span class="nx">limited</span> <span class="nx">and</span> <span class="nx">typically</span> <span class="nx">choose</span> <span class="nx">consistency</span> <span class="nx">over</span> <span class="nx">availability</span><span class="p">.</span> <span class="nx">Although</span> <span class="nx">many</span> <span class="nx">advances</span> <span class="nx">have</span> 
<span class="nx">been</span> <span class="nx">made</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">recent</span> <span class="nx">years</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">still</span> <span class="nx">not</span> <span class="nx">easy</span> <span class="nx">to</span> <span class="nx">scale</span><span class="o">-</span><span class="nx">out</span> <span class="nx">databases</span> <span class="nx">or</span> <span class="nx">use</span> <span class="nx">smart</span> <span class="nx">partitioning</span> 
<span class="nx">schemes</span> <span class="k">for</span> <span class="nx">load</span> <span class="nx">balancing</span><span class="p">.</span> </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Riak is a highly available, scalable, open source key/value database. Theses notes
describe where Riak's design decisions emulated and diverged from Dynamo's (as described in this paper).</p>

<p>Riak has offers several query methods in addition to the standard key/value interface, 
is made to be highly-avaible, is efficient in its resource uses, and has a simple scale out 
story accompany data and traffic growth. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">This</span> <span class="nx">paper</span> <span class="nx">describes</span> <span class="nx">Dynamo</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">highly</span> <span class="nx">available</span> <span class="nx">data</span> <span class="nx">storage</span> <span class="nx">technology</span> 
<span class="nx">that</span> <span class="nx">addresses</span> <span class="nx">the</span> <span class="nx">needs</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">important</span> <span class="nx">classes</span> <span class="nx">of</span> <span class="nx">services</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">has</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">key</span><span class="o">/</span><span class="nx">value</span> 
<span class="kr">interface</span><span class="p">,</span> <span class="nx">is</span> <span class="nx">highly</span> <span class="nx">available</span> <span class="kd">with</span> <span class="nx">a</span> <span class="nx">clearly</span> <span class="nx">defined</span> <span class="nx">consistency</span> <span class="nb">window</span><span class="p">,</span> <span class="nx">is</span> <span class="nx">efficient</span> <span class="k">in</span> <span class="nx">its</span> 
<span class="nx">resource</span> <span class="nx">usage</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">has</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">scale</span> <span class="nx">out</span> <span class="nx">scheme</span> <span class="nx">to</span> <span class="nx">address</span> <span class="nx">growth</span> <span class="k">in</span> <span class="nx">data</span> <span class="nx">set</span> <span class="nx">size</span> <span class="nx">or</span> <span class="nx">request</span> 
<span class="nx">rates</span><span class="p">.</span> <span class="nx">Each</span> <span class="nx">service</span> <span class="nx">that</span> <span class="nx">uses</span> <span class="nx">Dynamo</span> <span class="nx">runs</span> <span class="nx">its</span> <span class="nx">own</span> <span class="nx">Dynamo</span> <span class="nx">instances</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="mf">2.1</span> <span class="nx">System</span> <span class="nx">Assumptions</span> <span class="nx">and</span> <span class="nx">Requirements</span>

<span class="nx">The</span> <span class="nx">storage</span> <span class="nx">system</span> <span class="k">for</span> <span class="k">this</span> <span class="kr">class</span> <span class="nx">of</span> <span class="nx">services</span> <span class="nx">has</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">requirements</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><strong>Riak's Query Model</strong></p>

<p>We've extended Dynamo's proposed query model in severl ways. Currently Riak offers:</p>

<ol>
<li>Standard key/value access (GET, PUT, DELETE)</li>
<li>MapReduce querying </li>
<li>Links and Link Walking (which is analogous to relationships in GraphDBs and is a form 
    or MapReduce under the hood)
<li>Secondary Indexing</li>
<li>Full-text Search</li>
</ol>

<p>Riak's realistic object size limit is around 5MB. Basho does offer a commercial extenstion to Riak called 
<a href="#">Riak CS</a> that can store objects well into the GB range. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Query</span> <span class="nx">Model</span><span class="o">:</span> <span class="nx">simple</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">operations</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">data</span> <span class="nx">item</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">uniquely</span> <span class="nx">identified</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">key</span><span class="p">.</span> 
<span class="nx">State</span> <span class="nx">is</span> <span class="nx">stored</span> <span class="nx">as</span> <span class="nx">binary</span> <span class="nx">objects</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">blobs</span><span class="p">)</span> <span class="nx">identified</span> <span class="nx">by</span> <span class="nx">unique</span> <span class="nx">keys</span><span class="p">.</span> <span class="nx">No</span> <span class="nx">operations</span> <span class="nx">span</span> <span class="nx">multiple</span> 
<span class="nx">data</span> <span class="nx">items</span> <span class="nx">and</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">no</span> <span class="nx">need</span> <span class="k">for</span> <span class="nx">relational</span> <span class="nx">schema</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">requirement</span> <span class="nx">is</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">observation</span> <span class="nx">that</span> 
<span class="nx">a</span> <span class="nx">significant</span> <span class="nx">portion</span> <span class="nx">of</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">services</span> <span class="nx">can</span> <span class="nx">work</span> <span class="kd">with</span> <span class="k">this</span> <span class="nx">simple</span> <span class="nx">query</span> <span class="nx">model</span> <span class="nx">and</span> <span class="k">do</span> <span class="nx">not</span> <span class="nx">need</span> <span class="nx">any</span> 
<span class="nx">relational</span> <span class="nx">schema</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">targets</span> <span class="nx">applications</span> <span class="nx">that</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">store</span> <span class="nx">objects</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">relatively</span> <span class="nx">small</span> 
<span class="p">(</span><span class="nx">usually</span> <span class="nx">less</span> <span class="nx">than</span> <span class="mi">1</span> <span class="nx">MB</span><span class="p">).</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><strong>ACID?</strong></p>

<p>Riak offers no traditional "ACID" semantics around transactions. Instead, it's built to 
be "evenutually consistent." We did this because we were of the opinion (and our users proved this)
that most applications don't require heavy transactions. (Even ATMs are eventually consistent.)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">ACID</span> <span class="nx">Properties</span><span class="o">:</span> <span class="nx">ACID</span> <span class="p">(</span><span class="nx">Atomicity</span><span class="p">,</span> <span class="nx">Consistency</span><span class="p">,</span> <span class="nx">Isolation</span><span class="p">,</span> <span class="nx">Durability</span><span class="p">)</span> <span class="nx">is</span> <span class="nx">a</span> 
<span class="nx">set</span> <span class="nx">of</span> <span class="nx">properties</span> <span class="nx">that</span> <span class="nx">guarantee</span> <span class="nx">that</span> <span class="nx">database</span> <span class="nx">transactions</span> <span class="nx">are</span> <span class="nx">processed</span> <span class="nx">reliably</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">the</span> <span class="nx">context</span> <span class="nx">of</span> 
<span class="nx">databases</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">logical</span> <span class="nx">operation</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">is</span> <span class="nx">called</span> <span class="nx">a</span> <span class="nx">transaction</span><span class="p">.</span> <span class="nx">Experience</span> <span class="nx">at</span> <span class="nx">Amazon</span> <span class="nx">has</span> 
<span class="nx">shown</span> <span class="nx">that</span> <span class="nx">data</span> <span class="nx">stores</span> <span class="nx">that</span> <span class="nx">provide</span> <span class="nx">ACID</span> <span class="nx">guarantees</span> <span class="nx">tend</span> <span class="nx">to</span> <span class="nx">have</span> <span class="nx">poor</span> <span class="nx">availability</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">widely</span> 
<span class="nx">acknowledged</span> <span class="nx">by</span> <span class="nx">both</span> <span class="nx">the</span> <span class="nx">industry</span> <span class="nx">and</span> <span class="nx">academia</span> <span class="p">[</span><span class="mi">5</span><span class="p">].</span> <span class="nx">Dynamo</span> <span class="nx">targets</span> <span class="nx">applications</span> <span class="nx">that</span> <span class="nx">operate</span> <span class="kd">with</span> <span class="nx">weaker</span> 
<span class="nx">consistency</span> <span class="p">(</span><span class="nx">the</span> <span class="err">“</span><span class="nx">C</span><span class="err">”</span> <span class="k">in</span> <span class="nx">ACID</span><span class="p">)</span> <span class="k">if</span> <span class="k">this</span> <span class="nx">results</span> <span class="k">in</span> <span class="nx">high</span> <span class="nx">availability</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">provide</span> <span class="nx">any</span> <span class="nx">isolation</span> 
<span class="nx">guarantees</span> <span class="nx">and</span> <span class="nx">permits</span> <span class="nx">only</span> <span class="nx">single</span> <span class="nx">key</span> <span class="nx">updates</span><span class="p">.</span> </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p><strong>Efficiency</strong></p>

<p>Agreed. Riak is made to (and will!) scale linearly on commodity hardware (often called "pizza boxes").</p>

<p><li><a href="http://wiki.basho.com/display/RIAK/Hosting+and+Server+Configuration#HostingandServerConfiguration-Hardware">More on Hardware</a></li></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Efficiency</span><span class="o">:</span> <span class="nx">The</span> <span class="nx">system</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="kd">function</span> <span class="nx">on</span> <span class="nx">a</span> <span class="nx">commodity</span>  <span class="nx">hardware</span> <span class="nx">infrastructure</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span><span class="p">,</span> <span class="nx">services</span> <span class="nx">have</span> <span class="nx">stringent</span> <span class="nx">latency</span> <span class="nx">requirements</span> <span class="nx">which</span> <span class="nx">are</span> 
<span class="k">in</span> <span class="nx">general</span> <span class="nx">measured</span> <span class="nx">at</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">distribution</span><span class="p">.</span> <span class="nx">Given</span> <span class="nx">that</span> <span class="nx">state</span> <span class="nx">access</span> <span class="nx">plays</span> <span class="nx">a</span> <span class="nx">crucial</span> 
<span class="nx">role</span> <span class="k">in</span> <span class="nx">service</span> <span class="nx">operation</span> <span class="nx">the</span> <span class="nx">storage</span> <span class="nx">system</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">capable</span> <span class="nx">of</span> <span class="nx">meeting</span> <span class="nx">such</span> <span class="nx">stringent</span> <span class="nx">SLAs</span> <span class="p">(</span><span class="nx">see</span> <span class="nx">Section</span> 
<span class="mf">2.2</span> <span class="nx">below</span><span class="p">).</span> <span class="nx">Services</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">able</span> <span class="nx">to</span> <span class="nx">configure</span> <span class="nx">Dynamo</span> <span class="nx">such</span> <span class="nx">that</span> <span class="nx">they</span> <span class="nx">consistently</span> <span class="nx">achieve</span> <span class="nx">their</span> <span class="nx">latency</span> <span class="nx">and</span> 
<span class="nx">throughput</span> <span class="nx">requirements</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">tradeoffs</span> <span class="nx">are</span> <span class="k">in</span> <span class="nx">performance</span><span class="p">,</span> <span class="nx">cost</span> <span class="nx">efficiency</span><span class="p">,</span> <span class="nx">availability</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">durability</span> 
<span class="nx">guarantees</span><span class="p">.</span>

<span class="nx">Other</span> <span class="nx">Assumptions</span><span class="o">:</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">used</span> <span class="nx">only</span> <span class="nx">by</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">internal</span> <span class="nx">services</span><span class="p">.</span> <span class="nx">Its</span> <span class="nx">operation</span> <span class="nx">environment</span> <span class="nx">is</span> <span class="nx">assumed</span> 
<span class="nx">to</span> <span class="nx">be</span> <span class="nx">non</span><span class="o">-</span><span class="nx">hostile</span> <span class="nx">and</span> <span class="nx">there</span> <span class="nx">are</span> <span class="nx">no</span> <span class="nx">security</span> <span class="nx">related</span> <span class="nx">requirements</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">authentication</span> <span class="nx">and</span> <span class="nx">authorization</span><span class="p">.</span> 
<span class="nx">Moreover</span><span class="p">,</span> <span class="nx">since</span> <span class="nx">each</span> <span class="nx">service</span> <span class="nx">uses</span> <span class="nx">its</span> <span class="nx">distinct</span> <span class="nx">instance</span> <span class="nx">of</span> <span class="nx">Dynamo</span><span class="p">,</span> <span class="nx">its</span> <span class="nx">initial</span> <span class="nx">design</span> <span class="nx">targets</span> <span class="nx">a</span> <span class="nx">scale</span> <span class="nx">of</span> 
<span class="nx">up</span> <span class="nx">to</span> <span class="nx">hundreds</span> <span class="nx">of</span> <span class="nx">storage</span> <span class="nx">hosts</span><span class="p">.</span> <span class="nx">We</span> <span class="nx">will</span> <span class="nx">discuss</span> <span class="nx">the</span> <span class="nx">scalability</span> <span class="nx">limitations</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="nx">and</span> <span class="nx">possible</span> 
<span class="nx">scalability</span> <span class="nx">related</span> <span class="nx">extensions</span> <span class="k">in</span> <span class="nx">later</span> <span class="nx">sections</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><strong>Riak Loves SLAs</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">2.2</span> <span class="nx">Service</span> <span class="nx">Level</span> <span class="nx">Agreements</span> <span class="p">(</span><span class="nx">SLA</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Much like Amazon built Dynamo to guarantee their applications were always available to retail shoppers,
the design decisions in Riak were taken to ensure that developers could sleep well knowing that their
database would always be available to serve requests. </p>

<p>Many of our clients and open source users have explicit uptime agreements related to their applications and
services built on Riak. This was not an accident. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">To</span> <span class="nx">guarantee</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">application</span> <span class="nx">can</span> <span class="nx">deliver</span> <span class="nx">its</span> <span class="nx">functionality</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">bounded</span> <span class="nx">time</span><span class="p">,</span> <span class="nx">each</span> <span class="nx">and</span> <span class="nx">every</span> 
<span class="nx">dependency</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">platform</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">deliver</span> <span class="nx">its</span> <span class="nx">functionality</span> <span class="kd">with</span> <span class="nx">even</span> <span class="nx">tighter</span> <span class="nx">bounds</span><span class="p">.</span> <span class="nx">Clients</span> <span class="nx">and</span> 
<span class="nx">services</span> <span class="nx">engage</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">Service</span> <span class="nx">Level</span> <span class="nx">Agreement</span> <span class="p">(</span><span class="nx">SLA</span><span class="p">),</span> <span class="nx">a</span> <span class="nx">formally</span> <span class="nx">negotiated</span> <span class="nx">contract</span> <span class="nx">where</span> <span class="nx">a</span> <span class="nx">client</span> <span class="nx">and</span> 
<span class="nx">a</span> <span class="nx">service</span> <span class="nx">agree</span> <span class="nx">on</span> <span class="nx">several</span> <span class="nx">system</span><span class="o">-</span><span class="nx">related</span> <span class="nx">characteristics</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">most</span> <span class="nx">prominently</span> <span class="nx">include</span> <span class="nx">the</span> <span class="nx">client</span><span class="err">’</span><span class="nx">s</span> 
<span class="nx">expected</span> <span class="nx">request</span> <span class="nx">rate</span> <span class="nx">distribution</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">particular</span> <span class="nx">API</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">expected</span> <span class="nx">service</span> <span class="nx">latency</span> <span class="nx">under</span> <span class="nx">those</span> 
<span class="nx">conditions</span><span class="p">.</span> <span class="nx">An</span> <span class="nx">example</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">SLA</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">service</span> <span class="nx">guaranteeing</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">will</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="nx">response</span> <span class="nx">within</span> 
<span class="mi">300</span><span class="nx">ms</span> <span class="k">for</span> <span class="mf">99.9</span><span class="o">%</span> <span class="nx">of</span> <span class="nx">its</span> <span class="nx">requests</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">peak</span> <span class="nx">client</span> <span class="nx">load</span> <span class="nx">of</span> <span class="mi">500</span> <span class="nx">requests</span> <span class="nx">per</span> <span class="nx">second</span><span class="p">.</span>

<span class="nx">In</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">decentralized</span> <span class="nx">service</span> <span class="nx">oriented</span> <span class="nx">infrastructure</span><span class="p">,</span> <span class="nx">SLAs</span> <span class="nx">play</span> <span class="nx">an</span> <span class="nx">important</span> <span class="nx">role</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">example</span> 
<span class="nx">a</span> <span class="nx">page</span> <span class="nx">request</span> <span class="nx">to</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">e</span><span class="o">-</span><span class="nx">commerce</span> <span class="nx">sites</span> <span class="nx">typically</span> <span class="nx">requires</span> <span class="nx">the</span> <span class="nx">rendering</span> <span class="nx">engine</span> <span class="nx">to</span> <span class="nx">construct</span> 
<span class="nx">its</span> <span class="nx">response</span> <span class="nx">by</span> <span class="nx">sending</span> <span class="nx">requests</span> <span class="nx">to</span> <span class="nx">over</span> <span class="mi">150</span> <span class="nx">services</span><span class="p">.</span> <span class="nx">These</span> <span class="nx">services</span> <span class="nx">often</span> <span class="nx">have</span> <span class="nx">multiple</span> <span class="nx">dependencies</span><span class="p">,</span> 
<span class="nx">which</span> <span class="nx">frequently</span> <span class="nx">are</span> <span class="nx">other</span> <span class="nx">services</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">as</span> <span class="nx">such</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">uncommon</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">call</span> <span class="nx">graph</span> <span class="nx">of</span> <span class="nx">an</span> <span class="nx">application</span> 
<span class="nx">to</span> <span class="nx">have</span> <span class="nx">more</span> <span class="nx">than</span> <span class="nx">one</span> <span class="nx">level</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">ensure</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">page</span> <span class="nx">rendering</span> <span class="nx">engine</span> <span class="nx">can</span> <span class="nx">maintain</span> <span class="nx">a</span> <span class="nx">clear</span> <span class="nx">bound</span> <span class="nx">on</span> <span class="nx">page</span> 
<span class="nx">delivery</span> <span class="nx">each</span> <span class="nx">service</span> <span class="nx">within</span> <span class="nx">the</span> <span class="nx">call</span> <span class="nx">chain</span> <span class="nx">must</span> <span class="nx">obey</span> <span class="nx">its</span> <span class="nx">performance</span> <span class="nx">contract</span><span class="p">.</span>

<span class="nx">Figure</span> <span class="mi">1</span> <span class="nx">shows</span> <span class="nx">an</span> <span class="kr">abstract</span> <span class="nx">view</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">architecture</span> <span class="nx">of</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span><span class="p">,</span> <span class="nx">where</span> <span class="nx">dynamic</span> <span class="nx">web</span> <span class="nx">content</span> 
<span class="nx">is</span> <span class="nx">generated</span> <span class="nx">by</span> <span class="nx">page</span> <span class="nx">rendering</span> <span class="nx">components</span> <span class="nx">which</span> <span class="k">in</span> <span class="nx">turn</span> <span class="nx">query</span> <span class="nx">many</span> <span class="nx">other</span> <span class="nx">services</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">service</span> <span class="nx">can</span> <span class="nx">use</span> 
<span class="nx">different</span> <span class="nx">data</span> <span class="nx">stores</span> <span class="nx">to</span> <span class="nx">manage</span> <span class="nx">its</span> <span class="nx">state</span> <span class="nx">and</span> <span class="nx">these</span> <span class="nx">data</span> <span class="nx">stores</span> <span class="nx">are</span> <span class="nx">only</span> <span class="nx">accessible</span> <span class="nx">within</span> <span class="nx">its</span> <span class="nx">service</span> 
<span class="nx">boundaries</span><span class="p">.</span> <span class="nx">Some</span> <span class="nx">services</span> <span class="nx">act</span> <span class="nx">as</span> <span class="nx">aggregators</span> <span class="nx">by</span> <span class="nx">using</span> <span class="nx">several</span> <span class="nx">other</span> <span class="nx">services</span> <span class="nx">to</span> <span class="nx">produce</span> <span class="nx">a</span> <span class="nx">composite</span> 
<span class="nx">response</span><span class="p">.</span> <span class="nx">Typically</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">aggregator</span> <span class="nx">services</span> <span class="nx">are</span> <span class="nx">stateless</span><span class="p">,</span> <span class="nx">although</span> <span class="nx">they</span> <span class="nx">use</span> <span class="nx">extensive</span> <span class="nx">caching</span><span class="p">.</span>

<span class="nx">Figure</span> <span class="mi">1</span><span class="o">:</span> <span class="nx">Service</span><span class="o">-</span><span class="nx">oriented</span> <span class="nx">architecture</span> <span class="nx">of</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span><span class="p">.</span>

<span class="nx">A</span> <span class="nx">common</span> <span class="nx">approach</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">industry</span> <span class="k">for</span> <span class="nx">forming</span> <span class="nx">a</span> <span class="nx">performance</span> <span class="nx">oriented</span> <span class="nx">SLA</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">describe</span> <span class="nx">it</span> <span class="nx">using</span> <span class="nx">average</span><span class="p">,</span>
<span class="nx">median</span> <span class="nx">and</span> <span class="nx">expected</span> <span class="nx">variance</span><span class="p">.</span> <span class="nx">At</span> <span class="nx">Amazon</span> <span class="nx">we</span> <span class="nx">have</span> <span class="nx">found</span> <span class="nx">that</span> <span class="nx">these</span> <span class="nx">metrics</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">good</span> <span class="nx">enough</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">goal</span>
<span class="nx">is</span> <span class="nx">to</span> <span class="nx">build</span> <span class="nx">a</span> <span class="nx">system</span> <span class="nx">where</span> <span class="nx">all</span> <span class="nx">customers</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">good</span> <span class="nx">experience</span><span class="p">,</span> <span class="nx">rather</span> <span class="nx">than</span> <span class="nx">just</span> <span class="nx">the</span> <span class="nx">majority</span><span class="p">.</span> <span class="nx">For</span>
<span class="nx">example</span> <span class="k">if</span> <span class="nx">extensive</span> <span class="nx">personalization</span> <span class="nx">techniques</span> <span class="nx">are</span> <span class="nx">used</span> <span class="nx">then</span> <span class="nx">customers</span> <span class="kd">with</span> <span class="nx">longer</span> <span class="nx">histories</span> <span class="nx">require</span> 
<span class="nx">more</span> <span class="nx">processing</span> <span class="nx">which</span> <span class="nx">impacts</span> <span class="nx">performance</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">high</span><span class="o">-</span><span class="nx">end</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">distribution</span><span class="p">.</span> <span class="nx">An</span> <span class="nx">SLA</span> <span class="nx">stated</span> <span class="k">in</span> <span class="nx">terms</span> 
<span class="nx">of</span> <span class="nx">mean</span> <span class="nx">or</span> <span class="nx">median</span> <span class="nx">response</span> <span class="nx">times</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">address</span> <span class="nx">the</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">important</span> <span class="nx">customer</span> <span class="nx">segment</span><span class="p">.</span> 
<span class="nx">To</span> <span class="nx">address</span> <span class="k">this</span> <span class="nx">issue</span><span class="p">,</span> <span class="nx">at</span> <span class="nx">Amazon</span><span class="p">,</span> <span class="nx">SLAs</span> <span class="nx">are</span> <span class="nx">expressed</span> <span class="nx">and</span> <span class="nx">measured</span> <span class="nx">at</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">distribution</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">choice</span> <span class="k">for</span> <span class="mf">99.9</span><span class="o">%</span> <span class="nx">over</span> <span class="nx">an</span> <span class="nx">even</span> <span class="nx">higher</span> <span class="nx">percentile</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">made</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">a</span> <span class="nx">cost</span><span class="o">-</span><span class="nx">benefit</span> 
<span class="nx">analysis</span> <span class="nx">which</span> <span class="nx">demonstrated</span> <span class="nx">a</span> <span class="nx">significant</span> <span class="nx">increase</span> <span class="k">in</span> <span class="nx">cost</span> <span class="nx">to</span> <span class="nx">improve</span> <span class="nx">performance</span> <span class="nx">that</span> <span class="nx">much</span><span class="p">.</span> <span class="nx">Experiences</span> 
<span class="kd">with</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">production</span> <span class="nx">systems</span> <span class="nx">have</span> <span class="nx">shown</span> <span class="nx">that</span> <span class="k">this</span> <span class="nx">approach</span> <span class="nx">provides</span> <span class="nx">a</span> <span class="nx">better</span> <span class="nx">overall</span> <span class="nx">experience</span> 
<span class="nx">compared</span> <span class="nx">to</span> <span class="nx">those</span> <span class="nx">systems</span> <span class="nx">that</span> <span class="nx">meet</span> <span class="nx">SLAs</span> <span class="nx">defined</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">mean</span> <span class="nx">or</span> <span class="nx">median</span><span class="p">.</span>

<span class="nx">In</span> <span class="k">this</span> <span class="nx">paper</span> <span class="nx">there</span> <span class="nx">are</span> <span class="nx">many</span> <span class="nx">references</span> <span class="nx">to</span> <span class="k">this</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">of</span> <span class="nx">distributions</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">reflects</span> 
<span class="nx">Amazon</span> <span class="nx">engineers</span><span class="err">’</span> <span class="nx">relentless</span> <span class="nx">focus</span> <span class="nx">on</span> <span class="nx">performance</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">perspective</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">customers</span><span class="err">’</span> <span class="nx">experience</span><span class="p">.</span> 
<span class="nx">Many</span> <span class="nx">papers</span> <span class="nx">report</span> <span class="nx">on</span> <span class="nx">averages</span><span class="p">,</span> <span class="nx">so</span> <span class="nx">these</span> <span class="nx">are</span> <span class="nx">included</span> <span class="nx">where</span> <span class="nx">it</span> <span class="nx">makes</span> <span class="nx">sense</span> <span class="k">for</span> <span class="nx">comparison</span> <span class="nx">purposes</span><span class="p">.</span> 
<span class="nx">Nevertheless</span><span class="p">,</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">engineering</span> <span class="nx">and</span> <span class="nx">optimization</span> <span class="nx">efforts</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">focused</span> <span class="nx">on</span> <span class="nx">averages</span><span class="p">.</span> <span class="nx">Several</span> 
<span class="nx">techniques</span><span class="p">,</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">balanced</span> <span class="nx">selection</span> <span class="nx">of</span> <span class="nx">write</span> <span class="nx">coordinators</span><span class="p">,</span> <span class="nx">are</span> <span class="nx">purely</span> <span class="nx">targeted</span> <span class="nx">at</span> 
<span class="nx">controlling</span> <span class="nx">performance</span> <span class="nx">at</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span><span class="p">.</span>

<span class="nx">Storage</span> <span class="nx">systems</span> <span class="nx">often</span> <span class="nx">play</span> <span class="nx">an</span> <span class="nx">important</span> <span class="nx">role</span> <span class="k">in</span> <span class="nx">establishing</span> <span class="nx">a</span> <span class="nx">service</span><span class="err">’</span><span class="nx">s</span> <span class="nx">SLA</span><span class="p">,</span> <span class="nx">especially</span> <span class="k">if</span> <span class="nx">the</span> 
<span class="nx">business</span> <span class="nx">logic</span> <span class="nx">is</span> <span class="nx">relatively</span> <span class="nx">lightweight</span><span class="p">,</span> <span class="nx">as</span> <span class="nx">is</span> <span class="nx">the</span> <span class="k">case</span> <span class="k">for</span> <span class="nx">many</span> <span class="nx">Amazon</span> <span class="nx">services</span><span class="p">.</span> <span class="nx">State</span> <span class="nx">management</span> 
<span class="nx">then</span> <span class="nx">becomes</span> <span class="nx">the</span> <span class="nx">main</span> <span class="nx">component</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">service</span><span class="err">’</span><span class="nx">s</span> <span class="nx">SLA</span><span class="p">.</span> <span class="nx">One</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">main</span> <span class="nx">design</span> <span class="nx">considerations</span> <span class="k">for</span> <span class="nx">Dynamo</span> 
<span class="nx">is</span> <span class="nx">to</span> <span class="nx">give</span> <span class="nx">services</span> <span class="nx">control</span> <span class="nx">over</span> <span class="nx">their</span> <span class="nx">system</span> <span class="nx">properties</span><span class="p">,</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">durability</span> <span class="nx">and</span> <span class="nx">consistency</span><span class="p">,</span> 
<span class="nx">and</span> <span class="nx">to</span> <span class="nx">let</span> <span class="nx">services</span> <span class="nx">make</span> <span class="nx">their</span> <span class="nx">own</span> <span class="nx">tradeoffs</span> <span class="nx">between</span> <span class="nx">functionality</span><span class="p">,</span> <span class="nx">performance</span> <span class="nx">and</span> <span class="nx">cost</span><span class="o">-</span><span class="nx">effectiveness</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><strong>Riak's Design Considerations</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">2.3</span> <span class="nx">Design</span> <span class="nx">Considerations</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Availability under any circumstances was something we stressed when 
designing Riak, too. Most database didn't enable developers to do this in a simple way
so we set out to change this.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Data</span> <span class="nx">replication</span> <span class="nx">algorithms</span> <span class="nx">used</span> <span class="k">in</span> <span class="nx">commercial</span> <span class="nx">systems</span> <span class="nx">traditionally</span> <span class="nx">perform</span> <span class="nx">synchronous</span> <span class="nx">replica</span> 
<span class="nx">coordination</span> <span class="k">in</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="nx">strongly</span> <span class="nx">consistent</span> <span class="nx">data</span> <span class="nx">access</span> <span class="kr">interface</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">achieve</span> <span class="k">this</span> <span class="nx">level</span> <span class="nx">of</span> 
<span class="nx">consistency</span><span class="p">,</span> <span class="nx">these</span> <span class="nx">algorithms</span> <span class="nx">are</span> <span class="nx">forced</span> <span class="nx">to</span> <span class="nx">tradeoff</span> <span class="nx">the</span> <span class="nx">availability</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">under</span> <span class="nx">certain</span> <span class="nx">failure</span> 
<span class="nx">scenarios</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">rather</span> <span class="nx">than</span> <span class="nx">dealing</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">uncertainty</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">correctness</span> <span class="nx">of</span> <span class="nx">an</span> <span class="nx">answer</span><span class="p">,</span> <span class="nx">the</span> 
<span class="nx">data</span> <span class="nx">is</span> <span class="nx">made</span> <span class="nx">unavailable</span> <span class="nx">until</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">absolutely</span> <span class="nx">certain</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">correct</span><span class="p">.</span> <span class="nx">From</span> <span class="nx">the</span> <span class="nx">very</span> <span class="nx">early</span> <span class="nx">replicated</span> 
<span class="nx">database</span> <span class="nx">works</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">well</span> <span class="nx">known</span> <span class="nx">that</span> <span class="nx">when</span> <span class="nx">dealing</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">possibility</span> <span class="nx">of</span> <span class="nx">network</span> <span class="nx">failures</span><span class="p">,</span> <span class="nx">strong</span> 
<span class="nx">consistency</span> <span class="nx">and</span> <span class="nx">high</span> <span class="nx">data</span> <span class="nx">availability</span> <span class="nx">cannot</span> <span class="nx">be</span> <span class="nx">achieved</span> <span class="nx">simultaneously</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">].</span> <span class="nx">As</span> <span class="nx">such</span> <span class="nx">systems</span> <span class="nx">and</span> 
<span class="nx">applications</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">aware</span> <span class="nx">which</span> <span class="nx">properties</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">achieved</span> <span class="nx">under</span> <span class="nx">which</span> <span class="nx">conditions</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Remember Eventual Consistency? We followed Dynamo's lead here and 
made sure that Riak could withstand network, server and other failures
by sacrificing absolute consistency and building in mechanisms to rectify 
object conflicts.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">For</span> <span class="nx">systems</span> <span class="nx">prone</span> <span class="nx">to</span> <span class="nx">server</span> <span class="nx">and</span> <span class="nx">network</span> <span class="nx">failures</span><span class="p">,</span> <span class="nx">availability</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">increased</span> <span class="nx">by</span> <span class="nx">using</span> <span class="nx">optimistic</span> 
<span class="nx">replication</span> <span class="nx">techniques</span><span class="p">,</span> <span class="nx">where</span> <span class="nx">changes</span> <span class="nx">are</span> <span class="nx">allowed</span> <span class="nx">to</span> <span class="nx">propagate</span> <span class="nx">to</span> <span class="nx">replicas</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">background</span><span class="p">,</span> <span class="nx">and</span> 
<span class="nx">concurrent</span><span class="p">,</span> <span class="nx">disconnected</span> <span class="nx">work</span> <span class="nx">is</span> <span class="nx">tolerated</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">challenge</span> <span class="kd">with</span> <span class="k">this</span> <span class="nx">approach</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">can</span> <span class="nx">lead</span> <span class="nx">to</span> 
<span class="nx">conflicting</span> <span class="nx">changes</span> <span class="nx">which</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">detected</span> <span class="nx">and</span> <span class="nx">resolved</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">process</span> <span class="nx">of</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">introduces</span> 
<span class="nx">two</span> <span class="nx">problems</span><span class="o">:</span> <span class="nx">when</span> <span class="nx">to</span> <span class="nx">resolve</span> <span class="nx">them</span> <span class="nx">and</span> <span class="nx">who</span> <span class="nx">resolves</span> <span class="nx">them</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">designed</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">an</span> <span class="nx">eventually</span> 
<span class="nx">consistent</span> <span class="nx">data</span> <span class="nx">store</span><span class="p">;</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">all</span> <span class="nx">updates</span> <span class="nx">reach</span> <span class="nx">all</span> <span class="nx">replicas</span> <span class="nx">eventually</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Ditto</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">An</span> <span class="nx">important</span> <span class="nx">design</span> <span class="nx">consideration</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">decide</span> <span class="nx">when</span> <span class="nx">to</span> <span class="nx">perform</span> <span class="nx">the</span> <span class="nx">process</span> <span class="nx">of</span> <span class="nx">resolving</span> <span class="nx">update</span> 
<span class="nx">conflicts</span><span class="p">,</span> <span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">whether</span> <span class="nx">conflicts</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">resolved</span> <span class="nx">during</span> <span class="nx">reads</span> <span class="nx">or</span> <span class="nx">writes</span><span class="p">.</span> <span class="nx">Many</span> <span class="nx">traditional</span> 
<span class="nx">data</span> <span class="nx">stores</span> <span class="nx">execute</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">during</span> <span class="nx">writes</span> <span class="nx">and</span> <span class="nx">keep</span> <span class="nx">the</span> <span class="nx">read</span> <span class="nx">complexity</span> <span class="nx">simple</span> <span class="p">[</span><span class="mi">7</span><span class="p">].</span> 
<span class="nx">In</span> <span class="nx">such</span> <span class="nx">systems</span><span class="p">,</span> <span class="nx">writes</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">rejected</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">store</span> <span class="nx">cannot</span> <span class="nx">reach</span> <span class="nx">all</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">a</span> <span class="nx">majority</span> <span class="nx">of</span><span class="p">)</span> 
<span class="nx">the</span> <span class="nx">replicas</span> <span class="nx">at</span> <span class="nx">a</span> <span class="nx">given</span> <span class="nx">time</span><span class="p">.</span> <span class="nx">On</span> <span class="nx">the</span> <span class="nx">other</span> <span class="nx">hand</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">targets</span> <span class="nx">the</span> <span class="nx">design</span> <span class="nx">space</span> <span class="nx">of</span> <span class="nx">an</span> <span class="err">“</span><span class="nx">always</span> 
<span class="nx">writeable</span><span class="err">”</span> <span class="nx">data</span> <span class="nx">store</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">a</span> <span class="nx">data</span> <span class="nx">store</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">highly</span> <span class="nx">available</span> <span class="k">for</span> <span class="nx">writes</span><span class="p">).</span> <span class="nx">For</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">of</span> 
<span class="nx">Amazon</span> <span class="nx">services</span><span class="p">,</span> <span class="nx">rejecting</span> <span class="nx">customer</span> <span class="nx">updates</span> <span class="nx">could</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">poor</span> <span class="nx">customer</span> <span class="nx">experience</span><span class="p">.</span> <span class="nx">For</span> 
<span class="nx">instance</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">shopping</span> <span class="nx">cart</span> <span class="nx">service</span> <span class="nx">must</span> <span class="nx">allow</span> <span class="nx">customers</span> <span class="nx">to</span> <span class="nx">add</span> <span class="nx">and</span> <span class="nx">remove</span> <span class="nx">items</span> <span class="nx">from</span> <span class="nx">their</span> 
<span class="nx">shopping</span> <span class="nx">cart</span> <span class="nx">even</span> <span class="nx">amidst</span> <span class="nx">network</span> <span class="nx">and</span> <span class="nx">server</span> <span class="nx">failures</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">requirement</span> <span class="nx">forces</span> <span class="nx">us</span> <span class="nx">to</span> <span class="nx">push</span> <span class="nx">the</span> 
<span class="nx">complexity</span> <span class="nx">of</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">reads</span> <span class="k">in</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">ensure</span> <span class="nx">that</span> <span class="nx">writes</span> <span class="nx">are</span> <span class="nx">never</span> <span class="nx">rejected</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>No conflict here (pun intended). Riak follows this approach to conflict resolution.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">The</span> <span class="nx">next</span> <span class="nx">design</span> <span class="nx">choice</span> <span class="nx">is</span> <span class="nx">who</span> <span class="nx">performs</span> <span class="nx">the</span> <span class="nx">process</span> <span class="nx">of</span> <span class="nx">conflict</span> <span class="nx">resolution</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">done</span> <span class="nx">by</span> 
<span class="nx">the</span> <span class="nx">data</span> <span class="nx">store</span> <span class="nx">or</span> <span class="nx">the</span> <span class="nx">application</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">is</span> <span class="nx">done</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">its</span> <span class="nx">choices</span> 
<span class="nx">are</span> <span class="nx">rather</span> <span class="nx">limited</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">such</span> <span class="nx">cases</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">store</span> <span class="nx">can</span> <span class="nx">only</span> <span class="nx">use</span> <span class="nx">simple</span> <span class="nx">policies</span><span class="p">,</span> <span class="nx">such</span> <span class="nx">as</span> <span class="err">“</span><span class="nx">last</span> 
<span class="nx">write</span> <span class="nx">wins</span><span class="err">”</span> <span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="nx">to</span> <span class="nx">resolve</span> <span class="nx">conflicting</span> <span class="nx">updates</span><span class="p">.</span> <span class="nx">On</span> <span class="nx">the</span> <span class="nx">other</span> <span class="nx">hand</span><span class="p">,</span> <span class="nx">since</span> <span class="nx">the</span> <span class="nx">application</span> <span class="nx">is</span> 
<span class="nx">aware</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">schema</span> <span class="nx">it</span> <span class="nx">can</span> <span class="nx">decide</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">method</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">best</span> <span class="nx">suited</span> <span class="k">for</span> 
<span class="nx">its</span> <span class="nx">client</span><span class="err">’</span><span class="nx">s</span> <span class="nx">experience</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">application</span> <span class="nx">that</span> <span class="nx">maintains</span> <span class="nx">customer</span> <span class="nx">shopping</span> <span class="nx">carts</span> 
<span class="nx">can</span> <span class="nx">choose</span> <span class="nx">to</span> <span class="err">“</span><span class="nx">merge</span><span class="err">”</span> <span class="nx">the</span> <span class="nx">conflicting</span> <span class="nx">versions</span> <span class="nx">and</span> <span class="k">return</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">unified</span> <span class="nx">shopping</span> <span class="nx">cart</span><span class="p">.</span> <span class="nx">Despite</span> 
<span class="k">this</span> <span class="nx">flexibility</span><span class="p">,</span> <span class="nx">some</span> <span class="nx">application</span> <span class="nx">developers</span> <span class="nx">may</span> <span class="nx">not</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">write</span> <span class="nx">their</span> <span class="nx">own</span> <span class="nx">conflict</span> <span class="nx">resolution</span> 
<span class="nx">mechanisms</span> <span class="nx">and</span> <span class="nx">choose</span> <span class="nx">to</span> <span class="nx">push</span> <span class="nx">it</span> <span class="nx">down</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">which</span> <span class="k">in</span> <span class="nx">turn</span> <span class="nx">chooses</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">policy</span> 
<span class="nx">such</span> <span class="nx">as</span> <span class="err">“</span><span class="nx">last</span> <span class="nx">write</span> <span class="nx">wins</span><span class="err">”</span><span class="p">.</span>

<span class="nx">Other</span> <span class="nx">key</span> <span class="nx">principles</span> <span class="nx">embraced</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">design</span> <span class="nx">are</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>We refer to hosts as "nodes", too. Riak provides a simple set of commands to start 
and join nodes to a running cluster. With proper capacity planning, this process should
be painless for the ops team and devs, and imperceivable by the client.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Incremental</span> <span class="nx">scalability</span><span class="o">:</span> <span class="nx">Dynamo</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">able</span> <span class="nx">to</span> <span class="nx">scale</span> <span class="nx">out</span> <span class="nx">one</span> <span class="nx">storage</span> <span class="nx">host</span> <span class="p">(</span><span class="nx">henceforth</span><span class="p">,</span> <span class="nx">referred</span> 
<span class="nx">to</span> <span class="nx">as</span> <span class="err">“</span><span class="nx">node</span><span class="err">”</span><span class="p">)</span> <span class="nx">at</span> <span class="nx">a</span> <span class="nx">time</span><span class="p">,</span> <span class="kd">with</span> <span class="nx">minimal</span> <span class="nx">impact</span> <span class="nx">on</span> <span class="nx">both</span> <span class="nx">operators</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">itself</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Again, we agree. Each storage nope is the same at its neighbor. Any node can coordinate 
a request and, in the event that a node goes does, its neighbors can cover for it until 
it's restarted or decommissioned. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Symmetry</span><span class="o">:</span> <span class="nx">Every</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">Dynamo</span> <span class="nx">should</span> <span class="nx">have</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">responsibilities</span> <span class="nx">as</span> <span class="nx">its</span> <span class="nx">peers</span><span class="p">;</span> 
<span class="nx">there</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">no</span> <span class="nx">distinguished</span> <span class="nx">node</span> <span class="nx">or</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">take</span> <span class="nx">special</span> <span class="nx">roles</span> <span class="nx">or</span> <span class="nx">extra</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">responsibilities</span><span class="p">.</span> 
<span class="nx">In</span> <span class="nx">our</span> <span class="nx">experience</span><span class="p">,</span> <span class="nx">symmetry</span> <span class="nx">simplifies</span> <span class="nx">the</span> <span class="nx">process</span> <span class="nx">of</span> <span class="nx">system</span> <span class="nx">provisioning</span> <span class="nx">and</span> <span class="nx">maintenance</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>A Riak cluster is completely decentralized. No single node is special and this leads to 
no single points of failure.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Decentralization</span><span class="o">:</span> <span class="nx">An</span> <span class="nx">extension</span> <span class="nx">of</span> <span class="nx">symmetry</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">design</span> <span class="nx">should</span> <span class="nx">favor</span> <span class="nx">decentralized</span> <span class="nx">peer</span><span class="o">-</span><span class="nx">to</span><span class="o">-</span><span class="nx">peer</span> 
<span class="nx">techniques</span> <span class="nx">over</span> <span class="nx">centralized</span> <span class="nx">control</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">the</span> <span class="nx">past</span><span class="p">,</span> <span class="nx">centralized</span> <span class="nx">control</span> <span class="nx">has</span> <span class="nx">resulted</span> <span class="k">in</span> <span class="nx">outages</span> <span class="nx">and</span> 
<span class="nx">the</span> <span class="nx">goal</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">avoid</span> <span class="nx">it</span> <span class="nx">as</span> <span class="nx">much</span> <span class="nx">as</span> <span class="nx">possible</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">leads</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">simpler</span><span class="p">,</span> <span class="nx">more</span> <span class="nx">scalable</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">more</span> 
<span class="nx">available</span> <span class="nx">system</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Riak agrees. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Heterogeneity</span><span class="o">:</span> <span class="nx">The</span> <span class="nx">system</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">able</span> <span class="nx">to</span> <span class="nx">exploit</span> <span class="nx">heterogeneity</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">infrastructure</span> <span class="nx">it</span> 
<span class="nx">runs</span> <span class="nx">on</span><span class="p">.</span> <span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span> <span class="nx">the</span> <span class="nx">work</span> <span class="nx">distribution</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">proportional</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">capabilities</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">individual</span> 
<span class="nx">servers</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">essential</span> <span class="k">in</span> <span class="nx">adding</span> <span class="k">new</span> <span class="nx">nodes</span> <span class="kd">with</span> <span class="nx">higher</span> <span class="nx">capacity</span> <span class="nx">without</span> <span class="nx">having</span> <span class="nx">to</span> <span class="nx">upgrade</span> <span class="nx">all</span> 
<span class="nx">hosts</span> <span class="nx">at</span> <span class="nx">once</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Blurb about how this section is a wonderful study in some technology and how it should be read when
you have a moment. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mi">3</span><span class="p">.</span> <span class="nx">Related</span> <span class="nx">Work</span>

<span class="mf">3.1</span> <span class="nx">Peer</span> <span class="nx">to</span> <span class="nx">Peer</span> <span class="nx">Systems</span>

<span class="nx">There</span> <span class="nx">are</span> <span class="nx">several</span> <span class="nx">peer</span><span class="o">-</span><span class="nx">to</span><span class="o">-</span><span class="nx">peer</span> <span class="p">(</span><span class="nx">P2P</span><span class="p">)</span> <span class="nx">systems</span> <span class="nx">that</span> <span class="nx">have</span> <span class="nx">looked</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">problem</span> <span class="nx">of</span> <span class="nx">data</span> <span class="nx">storage</span> <span class="nx">and</span> <span class="nx">distribution</span><span class="p">.</span> 
<span class="nx">The</span> <span class="nx">first</span> <span class="nx">generation</span> <span class="nx">of</span> <span class="nx">P2P</span> <span class="nx">systems</span><span class="p">,</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">Freenet</span> <span class="nx">and</span> <span class="nx">Gnutella</span><span class="p">,</span> <span class="nx">were</span> <span class="nx">predominantly</span> <span class="nx">used</span> <span class="nx">as</span> <span class="nx">file</span> <span class="nx">sharing</span> 
<span class="nx">systems</span><span class="p">.</span> <span class="nx">These</span> <span class="nx">were</span> <span class="nx">examples</span> <span class="nx">of</span> <span class="nx">unstructured</span> <span class="nx">P2P</span> <span class="nx">networks</span> <span class="nx">where</span> <span class="nx">the</span> <span class="nx">overlay</span> <span class="nx">links</span> <span class="nx">between</span> <span class="nx">peers</span> <span class="nx">were</span> 
<span class="nx">established</span> <span class="nx">arbitrarily</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">these</span> <span class="nx">networks</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">search</span> <span class="nx">query</span> <span class="nx">is</span> <span class="nx">usually</span> <span class="nx">flooded</span> <span class="nx">through</span> <span class="nx">the</span> <span class="nx">network</span> <span class="nx">to</span> 
<span class="nx">find</span> <span class="nx">as</span> <span class="nx">many</span> <span class="nx">peers</span> <span class="nx">as</span> <span class="nx">possible</span> <span class="nx">that</span> <span class="nx">share</span> <span class="nx">the</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">P2P</span> <span class="nx">systems</span> <span class="nx">evolved</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">next</span> <span class="nx">generation</span> <span class="nx">into</span> 
<span class="nx">what</span> <span class="nx">is</span> <span class="nx">widely</span> <span class="nx">known</span> <span class="nx">as</span> <span class="nx">structured</span> <span class="nx">P2P</span> <span class="nx">networks</span><span class="p">.</span> <span class="nx">These</span> <span class="nx">networks</span> <span class="nx">employ</span> <span class="nx">a</span> <span class="nx">globally</span> <span class="nx">consistent</span> <span class="nx">protocol</span> 
<span class="nx">to</span> <span class="nx">ensure</span> <span class="nx">that</span> <span class="nx">any</span> <span class="nx">node</span> <span class="nx">can</span> <span class="nx">efficiently</span> <span class="nx">route</span> <span class="nx">a</span> <span class="nx">search</span> <span class="nx">query</span> <span class="nx">to</span> <span class="nx">some</span> <span class="nx">peer</span> <span class="nx">that</span> <span class="nx">has</span> <span class="nx">the</span> <span class="nx">desired</span> <span class="nx">data</span><span class="p">.</span> 
<span class="nx">Systems</span> <span class="nx">like</span> <span class="nx">Pastry</span> <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="nx">and</span> <span class="nx">Chord</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nx">use</span> <span class="nx">routing</span> <span class="nx">mechanisms</span> <span class="nx">to</span> <span class="nx">ensure</span> <span class="nx">that</span> <span class="nx">queries</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">answered</span> 
<span class="nx">within</span> <span class="nx">a</span> <span class="nx">bounded</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">hops</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">reduce</span> <span class="nx">the</span> <span class="nx">additional</span> <span class="nx">latency</span> <span class="nx">introduced</span> <span class="nx">by</span> <span class="nx">multi</span><span class="o">-</span><span class="nx">hop</span> <span class="nx">routing</span><span class="p">,</span> <span class="nx">some</span>
<span class="nx">P2P</span> <span class="nx">systems</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.,</span> <span class="p">[</span><span class="mi">14</span><span class="p">])</span> <span class="nx">employ</span> <span class="nx">O</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="nx">routing</span> <span class="nx">where</span> <span class="nx">each</span> <span class="nx">peer</span> <span class="nx">maintains</span> <span class="nx">enough</span> <span class="nx">routing</span> <span class="nx">information</span> <span class="nx">locally</span>
<span class="nx">so</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">can</span> <span class="nx">route</span> <span class="nx">requests</span> <span class="p">(</span><span class="nx">to</span> <span class="nx">access</span> <span class="nx">a</span> <span class="nx">data</span> <span class="nx">item</span><span class="p">)</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">appropriate</span> <span class="nx">peer</span> <span class="nx">within</span> <span class="nx">a</span> <span class="nx">constant</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">hops</span><span class="p">.</span>

<span class="nx">Various</span> <span class="nx">storage</span> <span class="nx">systems</span><span class="p">,</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">Oceanstore</span> <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="nx">and</span> <span class="nx">PAST</span> <span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="nx">were</span> <span class="nx">built</span> <span class="nx">on</span> <span class="nx">top</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">routing</span> 
<span class="nx">overlays</span><span class="p">.</span> <span class="nx">Oceanstore</span> <span class="nx">provides</span> <span class="nx">a</span> <span class="nx">global</span><span class="p">,</span> <span class="nx">transactional</span><span class="p">,</span> <span class="nx">persistent</span> <span class="nx">storage</span> <span class="nx">service</span> <span class="nx">that</span> <span class="nx">supports</span> 
<span class="nx">serialized</span> <span class="nx">updates</span> <span class="nx">on</span> <span class="nx">widely</span> <span class="nx">replicated</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">allow</span> <span class="k">for</span> <span class="nx">concurrent</span> <span class="nx">updates</span> <span class="k">while</span> <span class="nx">avoiding</span> <span class="nx">many</span> 
<span class="nx">of</span> <span class="nx">the</span> <span class="nx">problems</span> <span class="nx">inherent</span> <span class="kd">with</span> <span class="nx">wide</span><span class="o">-</span><span class="nx">area</span> <span class="nx">locking</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">uses</span> <span class="nx">an</span> <span class="nx">update</span> <span class="nx">model</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">conflict</span> <span class="nx">resolution</span><span class="p">.</span> 
<span class="nx">Conflict</span> <span class="nx">resolution</span> <span class="nx">was</span> <span class="nx">introduced</span> <span class="k">in</span> <span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="nx">to</span> <span class="nx">reduce</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">transaction</span> <span class="nx">aborts</span><span class="p">.</span> <span class="nx">Oceanstore</span> <span class="nx">resolves</span> 
<span class="nx">conflicts</span> <span class="nx">by</span> <span class="nx">processing</span> <span class="nx">a</span> <span class="nx">series</span> <span class="nx">of</span> <span class="nx">updates</span><span class="p">,</span> <span class="nx">choosing</span> <span class="nx">a</span> <span class="nx">total</span> <span class="nx">order</span> <span class="nx">among</span> <span class="nx">them</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">then</span> <span class="nx">applying</span> <span class="nx">them</span> 
<span class="nx">atomically</span> <span class="k">in</span> <span class="nx">that</span> <span class="nx">order</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">is</span> <span class="nx">built</span> <span class="k">for</span> <span class="nx">an</span> <span class="nx">environment</span> <span class="nx">where</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">is</span> <span class="nx">replicated</span> <span class="nx">on</span> <span class="nx">an</span> <span class="nx">untrusted</span> 
<span class="nx">infrastructure</span><span class="p">.</span> <span class="nx">By</span> <span class="nx">comparison</span><span class="p">,</span> <span class="nx">PAST</span> <span class="nx">provides</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">abstraction</span> <span class="nx">layer</span> <span class="nx">on</span> <span class="nx">top</span> <span class="nx">of</span> <span class="nx">Pastry</span> <span class="k">for</span> <span class="nx">persistent</span> 
<span class="nx">and</span> <span class="nx">immutable</span> <span class="nx">objects</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">assumes</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">application</span> <span class="nx">can</span> <span class="nx">build</span> <span class="nx">the</span> <span class="nx">necessary</span> <span class="nx">storage</span> <span class="nx">semantics</span> <span class="p">(</span><span class="nx">such</span> <span class="nx">as</span> 
<span class="nx">mutable</span> <span class="nx">files</span><span class="p">)</span> <span class="nx">on</span> <span class="nx">top</span> <span class="nx">of</span> <span class="nx">it</span><span class="p">.</span>

<span class="mf">3.2</span> <span class="nx">Distributed</span> <span class="nx">File</span> <span class="nx">Systems</span> <span class="nx">and</span> <span class="nx">Databases</span>

<span class="nx">Distributing</span> <span class="nx">data</span> <span class="k">for</span> <span class="nx">performance</span><span class="p">,</span> <span class="nx">availability</span> <span class="nx">and</span> <span class="nx">durability</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">widely</span> <span class="nx">studied</span> <span class="k">in</span> 
<span class="nx">the</span> <span class="nx">file</span> <span class="nx">system</span> <span class="nx">and</span> <span class="nx">database</span> <span class="nx">systems</span> <span class="nx">community</span><span class="p">.</span> <span class="nx">Compared</span> <span class="nx">to</span> <span class="nx">P2P</span> <span class="nx">storage</span> <span class="nx">systems</span> <span class="nx">that</span> <span class="nx">only</span> 
<span class="nx">support</span> <span class="nx">flat</span> <span class="nx">namespaces</span><span class="p">,</span> <span class="nx">distributed</span> <span class="nx">file</span> <span class="nx">systems</span> <span class="nx">typically</span> <span class="nx">support</span> <span class="nx">hierarchical</span> <span class="nx">namespaces</span><span class="p">.</span> 
<span class="nx">Systems</span> <span class="nx">like</span> <span class="nx">Ficus</span> <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="nx">and</span> <span class="nx">Coda</span> <span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="nx">replicate</span> <span class="nx">files</span> <span class="k">for</span> <span class="nx">high</span> <span class="nx">availability</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">expense</span> <span class="nx">of</span> 
<span class="nx">consistency</span><span class="p">.</span> <span class="nx">Update</span> <span class="nx">conflicts</span> <span class="nx">are</span> <span class="nx">typically</span> <span class="nx">managed</span> <span class="nx">using</span> <span class="nx">specialized</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">procedures</span><span class="p">.</span> 
<span class="nx">The</span> <span class="nx">Farsite</span> <span class="nx">system</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">distributed</span> <span class="nx">file</span> <span class="nx">system</span> <span class="nx">that</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">use</span> <span class="nx">any</span> <span class="nx">centralized</span> <span class="nx">server</span> <span class="nx">like</span> <span class="nx">NFS</span><span class="p">.</span> 
<span class="nx">Farsite</span> <span class="nx">achieves</span> <span class="nx">high</span> <span class="nx">availability</span> <span class="nx">and</span> <span class="nx">scalability</span> <span class="nx">using</span> <span class="nx">replication</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">Google</span> <span class="nx">File</span> <span class="nx">System</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="nx">is</span> 
<span class="nx">another</span> <span class="nx">distributed</span> <span class="nx">file</span> <span class="nx">system</span> <span class="nx">built</span> <span class="k">for</span> <span class="nx">hosting</span> <span class="nx">the</span> <span class="nx">state</span> <span class="nx">of</span> <span class="nx">Google</span><span class="err">’</span><span class="nx">s</span> <span class="nx">internal</span> <span class="nx">applications</span><span class="p">.</span> <span class="nx">GFS</span> 
<span class="nx">uses</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">design</span> <span class="kd">with</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">master</span> <span class="nx">server</span> <span class="k">for</span> <span class="nx">hosting</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nx">metadata</span> <span class="nx">and</span> <span class="nx">where</span> <span class="nx">the</span> <span class="nx">data</span> 
<span class="nx">is</span> <span class="nx">split</span> <span class="nx">into</span> <span class="nx">chunks</span> <span class="nx">and</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">chunkservers</span><span class="p">.</span> <span class="nx">Bayou</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">distributed</span> <span class="nx">relational</span> <span class="nx">database</span> <span class="nx">system</span> 
<span class="nx">that</span> <span class="nx">allows</span> <span class="nx">disconnected</span> <span class="nx">operations</span> <span class="nx">and</span> <span class="nx">provides</span> <span class="nx">eventual</span> <span class="nx">data</span> <span class="nx">consistency</span> <span class="p">[</span><span class="mi">21</span><span class="p">].</span>

<span class="nx">Among</span> <span class="nx">these</span> <span class="nx">systems</span><span class="p">,</span> <span class="nx">Bayou</span><span class="p">,</span> <span class="nx">Coda</span> <span class="nx">and</span> <span class="nx">Ficus</span> <span class="nx">allow</span> <span class="nx">disconnected</span> <span class="nx">operations</span> <span class="nx">and</span> <span class="nx">are</span> <span class="nx">resilient</span> <span class="nx">to</span> 
<span class="nx">issues</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">network</span> <span class="nx">partitions</span> <span class="nx">and</span> <span class="nx">outages</span><span class="p">.</span> <span class="nx">These</span> <span class="nx">systems</span> <span class="nx">differ</span> <span class="nx">on</span> <span class="nx">their</span> <span class="nx">conflict</span> <span class="nx">resolution</span> 
<span class="nx">procedures</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">Coda</span> <span class="nx">and</span> <span class="nx">Ficus</span> <span class="nx">perform</span> <span class="nx">system</span> <span class="nx">level</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">and</span> <span class="nx">Bayou</span> <span class="nx">allows</span> 
<span class="nx">application</span> <span class="nx">level</span> <span class="nx">resolution</span><span class="p">.</span> <span class="nx">All</span> <span class="nx">of</span> <span class="nx">them</span><span class="p">,</span> <span class="nx">however</span><span class="p">,</span> <span class="nx">guarantee</span> <span class="nx">eventual</span> <span class="nx">consistency</span><span class="p">.</span> <span class="nx">Similar</span> <span class="nx">to</span> <span class="nx">these</span> 
<span class="nx">systems</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">allows</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">operations</span> <span class="nx">to</span> <span class="k">continue</span> <span class="nx">even</span> <span class="nx">during</span> <span class="nx">network</span> <span class="nx">partitions</span> <span class="nx">and</span> 
<span class="nx">resolves</span> <span class="nx">updated</span> <span class="nx">conflicts</span> <span class="nx">using</span> <span class="nx">different</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">mechanisms</span><span class="p">.</span> <span class="nx">Distributed</span> <span class="nx">block</span> <span class="nx">storage</span> 
<span class="nx">systems</span> <span class="nx">like</span> <span class="nx">FAB</span> <span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="nx">split</span> <span class="nx">large</span> <span class="nx">size</span> <span class="nx">objects</span> <span class="nx">into</span> <span class="nx">smaller</span> <span class="nx">blocks</span> <span class="nx">and</span> <span class="nx">stores</span> <span class="nx">each</span> <span class="nx">block</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">highly</span> 
<span class="nx">available</span> <span class="nx">manner</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">comparison</span> <span class="nx">to</span> <span class="nx">these</span> <span class="nx">systems</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">key</span><span class="o">-</span><span class="nx">value</span> <span class="nx">store</span> <span class="nx">is</span> <span class="nx">more</span> <span class="nx">suitable</span> <span class="k">in</span> <span class="k">this</span> <span class="k">case</span> 
<span class="nx">because</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">intended</span> <span class="nx">to</span> <span class="nx">store</span> <span class="nx">relatively</span> <span class="nx">small</span> <span class="nx">objects</span> <span class="p">(</span><span class="nx">size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="nx">M</span><span class="p">)</span> <span class="nx">and</span> <span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="nx">key</span><span class="o">-</span><span class="nx">value</span> <span class="nx">stores</span> 
<span class="nx">are</span> <span class="nx">easier</span> <span class="nx">to</span> <span class="nx">configure</span> <span class="nx">on</span> <span class="nx">a</span> <span class="nx">per</span><span class="o">-</span><span class="nx">application</span> <span class="nx">basis</span><span class="p">.</span> <span class="nx">Antiquity</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">wide</span><span class="o">-</span><span class="nx">area</span> <span class="nx">distributed</span> <span class="nx">storage</span> 
<span class="nx">system</span> <span class="nx">designed</span> <span class="nx">to</span> <span class="nx">handle</span> <span class="nx">multiple</span> <span class="nx">server</span> <span class="nx">failures</span> <span class="p">[</span><span class="mi">23</span><span class="p">].</span> <span class="nx">It</span> <span class="nx">uses</span> <span class="nx">a</span> <span class="nx">secure</span> <span class="nx">log</span> <span class="nx">to</span> <span class="nx">preserve</span> <span class="nx">data</span> 
<span class="nx">integrity</span><span class="p">,</span> <span class="nx">replicates</span> <span class="nx">each</span> <span class="nx">log</span> <span class="nx">on</span> <span class="nx">multiple</span> <span class="nx">servers</span> <span class="k">for</span> <span class="nx">durability</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">uses</span> <span class="nx">Byzantine</span> <span class="nx">fault</span> <span class="nx">tolerance</span> 
<span class="nx">protocols</span> <span class="nx">to</span> <span class="nx">ensure</span> <span class="nx">data</span> <span class="nx">consistency</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">contrast</span> <span class="nx">to</span> <span class="nx">Antiquity</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">focus</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">problem</span> 
<span class="nx">of</span> <span class="nx">data</span> <span class="nx">integrity</span> <span class="nx">and</span> <span class="nx">security</span> <span class="nx">and</span> <span class="nx">is</span> <span class="nx">built</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">trusted</span> <span class="nx">environment</span><span class="p">.</span> <span class="nx">Bigtable</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">distributed</span> 
<span class="nx">storage</span> <span class="nx">system</span> <span class="k">for</span> <span class="nx">managing</span> <span class="nx">structured</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">maintains</span> <span class="nx">a</span> <span class="nx">sparse</span><span class="p">,</span> <span class="nx">multi</span><span class="o">-</span><span class="nx">dimensional</span> <span class="nx">sorted</span> <span class="nx">map</span> 
<span class="nx">and</span> <span class="nx">allows</span> <span class="nx">applications</span> <span class="nx">to</span> <span class="nx">access</span> <span class="nx">their</span> <span class="nx">data</span> <span class="nx">using</span> <span class="nx">multiple</span> <span class="nx">attributes</span> <span class="p">[</span><span class="mi">2</span><span class="p">].</span> <span class="nx">Compared</span> <span class="nx">to</span> <span class="nx">Bigtable</span><span class="p">,</span> 
<span class="nx">Dynamo</span> <span class="nx">targets</span> <span class="nx">applications</span> <span class="nx">that</span> <span class="nx">require</span> <span class="nx">only</span> <span class="nx">key</span><span class="o">/</span><span class="nx">value</span> <span class="nx">access</span> <span class="kd">with</span> <span class="nx">primary</span> <span class="nx">focus</span> <span class="nx">on</span> <span class="nx">high</span> <span class="nx">availability</span> 
<span class="nx">where</span> <span class="nx">updates</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">rejected</span> <span class="nx">even</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">wake</span> <span class="nx">of</span> <span class="nx">network</span> <span class="nx">partitions</span> <span class="nx">or</span> <span class="nx">server</span> <span class="nx">failures</span><span class="p">.</span>

<span class="nx">Traditional</span> <span class="nx">replicated</span> <span class="nx">relational</span> <span class="nx">database</span> <span class="nx">systems</span> <span class="nx">focus</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">problem</span> <span class="nx">of</span> <span class="nx">guaranteeing</span> <span class="nx">strong</span> 
<span class="nx">consistency</span> <span class="nx">to</span> <span class="nx">replicated</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">Although</span> <span class="nx">strong</span> <span class="nx">consistency</span> <span class="nx">provides</span> <span class="nx">the</span> <span class="nx">application</span> <span class="nx">writer</span> <span class="nx">a</span> 
<span class="nx">convenient</span> <span class="nx">programming</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">these</span> <span class="nx">systems</span> <span class="nx">are</span> <span class="nx">limited</span> <span class="k">in</span> <span class="nx">scalability</span> <span class="nx">and</span> <span class="nx">availability</span> <span class="p">[</span><span class="mi">7</span><span class="p">].</span> <span class="nx">These</span> 
<span class="nx">systems</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">capable</span> <span class="nx">of</span> <span class="nx">handling</span> <span class="nx">network</span> <span class="nx">partitions</span> <span class="nx">because</span> <span class="nx">they</span> <span class="nx">typically</span> <span class="nx">provide</span> <span class="nx">strong</span> 
<span class="nx">consistency</span> <span class="nx">guarantees</span><span class="p">.</span>

<span class="mf">3.3</span> <span class="nx">Discussion</span>

<span class="nx">Dynamo</span> <span class="nx">differs</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">aforementioned</span> <span class="nx">decentralized</span> <span class="nx">storage</span> <span class="nx">systems</span> <span class="k">in</span> <span class="nx">terms</span> <span class="nx">of</span> <span class="nx">its</span> <span class="nx">target</span> <span class="nx">requirements</span><span class="p">.</span> 
<span class="nx">First</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">targeted</span> <span class="nx">mainly</span> <span class="nx">at</span> <span class="nx">applications</span> <span class="nx">that</span> <span class="nx">need</span> <span class="nx">an</span> <span class="err">“</span><span class="nx">always</span> <span class="nx">writeable</span><span class="err">”</span> <span class="nx">data</span> <span class="nx">store</span> <span class="nx">where</span> <span class="nx">no</span> 
<span class="nx">updates</span> <span class="nx">are</span> <span class="nx">rejected</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">failures</span> <span class="nx">or</span> <span class="nx">concurrent</span> <span class="nx">writes</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">crucial</span> <span class="nx">requirement</span> <span class="k">for</span> <span class="nx">many</span> <span class="nx">Amazon</span> 
<span class="nx">applications</span><span class="p">.</span> <span class="nx">Second</span><span class="p">,</span> <span class="nx">as</span> <span class="nx">noted</span> <span class="nx">earlier</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">built</span> <span class="k">for</span> <span class="nx">an</span> <span class="nx">infrastructure</span> <span class="nx">within</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">administrative</span> 
<span class="nx">domain</span> <span class="nx">where</span> <span class="nx">all</span> <span class="nx">nodes</span> <span class="nx">are</span> <span class="nx">assumed</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">trusted</span><span class="p">.</span> <span class="nx">Third</span><span class="p">,</span> <span class="nx">applications</span> <span class="nx">that</span> <span class="nx">use</span> <span class="nx">Dynamo</span> <span class="k">do</span> <span class="nx">not</span> <span class="nx">require</span> 
<span class="nx">support</span> <span class="k">for</span> <span class="nx">hierarchical</span> <span class="nx">namespaces</span> <span class="p">(</span><span class="nx">a</span> <span class="nx">norm</span> <span class="k">in</span> <span class="nx">many</span> <span class="nx">file</span> <span class="nx">systems</span><span class="p">)</span> <span class="nx">or</span> <span class="nx">complex</span> <span class="nx">relational</span> <span class="nx">schema</span> <span class="p">(</span><span class="nx">supported</span> 
<span class="nx">by</span> <span class="nx">traditional</span> <span class="nx">databases</span><span class="p">).</span> <span class="nx">Fourth</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">built</span> <span class="k">for</span> <span class="nx">latency</span> <span class="nx">sensitive</span> <span class="nx">applications</span> <span class="nx">that</span> <span class="nx">require</span> <span class="nx">at</span> 
<span class="nx">least</span> <span class="mf">99.9</span><span class="o">%</span> <span class="nx">of</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">operations</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">performed</span> <span class="nx">within</span> <span class="nx">a</span> <span class="nx">few</span> <span class="nx">hundred</span> <span class="nx">milliseconds</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">meet</span> <span class="nx">these</span> 
<span class="nx">stringent</span> <span class="nx">latency</span> <span class="nx">requirements</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">was</span> <span class="nx">imperative</span> <span class="k">for</span> <span class="nx">us</span> <span class="nx">to</span> <span class="nx">avoid</span> <span class="nx">routing</span> <span class="nx">requests</span> <span class="nx">through</span> <span class="nx">multiple</span> <span class="nx">nodes</span> 
<span class="p">(</span><span class="nx">which</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">typical</span> <span class="nx">design</span> <span class="nx">adopted</span> <span class="nx">by</span> <span class="nx">several</span> <span class="nx">distributed</span> <span class="nx">hash</span> <span class="nx">table</span> <span class="nx">systems</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">Chord</span> <span class="nx">and</span> <span class="nx">Pastry</span><span class="p">).</span> 
<span class="nx">This</span> <span class="nx">is</span> <span class="nx">because</span> <span class="nx">multi</span><span class="o">-</span><span class="nx">hop</span> <span class="nx">routing</span> <span class="nx">increases</span> <span class="nx">variability</span> <span class="k">in</span> <span class="nx">response</span> <span class="nx">times</span><span class="p">,</span> <span class="nx">thereby</span> <span class="nx">increasing</span> <span class="nx">the</span> <span class="nx">latency</span> 
<span class="nx">at</span> <span class="nx">higher</span> <span class="nx">percentiles</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">characterized</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">zero</span><span class="o">-</span><span class="nx">hop</span> <span class="nx">DHT</span><span class="p">,</span> <span class="nx">where</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">maintains</span> <span class="nx">enough</span> 
<span class="nx">routing</span> <span class="nx">information</span> <span class="nx">locally</span> <span class="nx">to</span> <span class="nx">route</span> <span class="nx">a</span> <span class="nx">request</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">appropriate</span> <span class="nx">node</span> <span class="nx">directly</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p><strong>System Architecture</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mi">4</span><span class="p">.</span><span class="nx">System</span> <span class="nx">Architecture</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>This is truly the meat of the Dynamo paper. Stick around. It gets good. Trust me.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">The</span> <span class="nx">architecture</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">storage</span> <span class="nx">system</span> <span class="nx">that</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">operate</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">production</span> <span class="nx">setting</span> <span class="nx">is</span> <span class="nx">complex</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">addition</span> 
<span class="nx">to</span> <span class="nx">the</span> <span class="nx">actual</span> <span class="nx">data</span> <span class="nx">persistence</span> <span class="nx">component</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">have</span> <span class="nx">scalable</span> <span class="nx">and</span> <span class="nx">robust</span> <span class="nx">solutions</span> <span class="k">for</span> <span class="nx">load</span> 
<span class="nx">balancing</span><span class="p">,</span> <span class="nx">membership</span> <span class="nx">and</span> <span class="nx">failure</span> <span class="nx">detection</span><span class="p">,</span> <span class="nx">failure</span> <span class="nx">recovery</span><span class="p">,</span> <span class="nx">replica</span> <span class="nx">synchronization</span><span class="p">,</span> <span class="nx">overload</span> <span class="nx">handling</span><span class="p">,</span> 
<span class="nx">state</span> <span class="nx">transfer</span><span class="p">,</span> <span class="nx">concurrency</span> <span class="nx">and</span> <span class="nx">job</span> <span class="nx">scheduling</span><span class="p">,</span> <span class="nx">request</span> <span class="nx">marshalling</span><span class="p">,</span> <span class="nx">request</span> <span class="nx">routing</span><span class="p">,</span> <span class="nx">system</span> <span class="nx">monitoring</span> <span class="nx">and</span>
<span class="nx">alarming</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">configuration</span> <span class="nx">management</span><span class="p">.</span> <span class="nx">Describing</span> <span class="nx">the</span> <span class="nx">details</span> <span class="nx">of</span> <span class="nx">each</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">solutions</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">possible</span><span class="p">,</span> 
<span class="nx">so</span> <span class="k">this</span> <span class="nx">paper</span> <span class="nx">focuses</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">core</span> <span class="nx">distributed</span> <span class="nx">systems</span> <span class="nx">techniques</span> <span class="nx">used</span> <span class="k">in</span> <span class="nx">Dynamo</span><span class="o">:</span> <span class="nx">partitioning</span><span class="p">,</span> <span class="nx">replication</span><span class="p">,</span> 
<span class="nx">versioning</span><span class="p">,</span> <span class="nx">membership</span><span class="p">,</span> <span class="nx">failure</span> <span class="nx">handling</span> <span class="nx">and</span> <span class="nx">scaling</span><span class="p">.</span> <span class="nx">Table</span> <span class="mi">1</span> <span class="nx">presents</span> <span class="nx">a</span> <span class="nx">summary</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">list</span> <span class="nx">of</span> <span class="nx">techniques</span> 
<span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">and</span> <span class="nx">their</span> <span class="nx">respective</span> <span class="nx">advantages</span><span class="p">.</span>

<span class="nx">Table</span> <span class="mi">1</span><span class="o">:</span> <span class="nx">Summary</span> <span class="nx">of</span> <span class="nx">techniques</span> <span class="nx">used</span> <span class="k">in</span> <span class="nx">Dynamo</span> <span class="nx">and</span> <span class="nx">their</span> <span class="nx">advantages</span><span class="p">.</span>


<span class="mf">4.1</span> <span class="nx">System</span> <span class="nx">Interface</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Whereas Dynamo only has the concept of keys, we added a higher level of organization called a "bucket."
Keys are stored in buckets and buckets are the level at which several Riak properties can be configured 
(primarily the "N" value, or the replication value.) In addition to the bucket+key identifier and value, Riak 
will also return the associated metadata for a given object with each get or put.</p>

<p>Riak has two APIs:</p>

<ul>
<li><a href="#">Riak's HTTP API</a></li>
<li><a href="#">Riak's Protocol Buffers API</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Dynamo</span> <span class="nx">stores</span> <span class="nx">objects</span> <span class="nx">associated</span> <span class="kd">with</span> <span class="nx">a</span> <span class="nx">key</span> <span class="nx">through</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="kr">interface</span><span class="p">;</span> <span class="nx">it</span> <span class="nx">exposes</span> <span class="nx">two</span> <span class="nx">operations</span><span class="o">:</span> <span class="nx">get</span><span class="p">()</span> 
<span class="nx">and</span> <span class="nx">put</span><span class="p">().</span> <span class="nx">The</span> <span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="nx">operation</span> <span class="nx">locates</span> <span class="nx">the</span> <span class="nx">object</span> <span class="nx">replicas</span> <span class="nx">associated</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">storage</span> 
<span class="nx">system</span> <span class="nx">and</span> <span class="nx">returns</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">object</span> <span class="nx">or</span> <span class="nx">a</span> <span class="nx">list</span> <span class="nx">of</span> <span class="nx">objects</span> <span class="kd">with</span> <span class="nx">conflicting</span> <span class="nx">versions</span> <span class="nx">along</span> <span class="kd">with</span> <span class="nx">a</span> <span class="nx">context</span><span class="p">.</span> 
<span class="nx">The</span> <span class="nx">put</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">object</span><span class="p">)</span> <span class="nx">operation</span> <span class="nx">determines</span> <span class="nx">where</span> <span class="nx">the</span> <span class="nx">replicas</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">object</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">placed</span> <span class="nx">based</span> 
<span class="nx">on</span> <span class="nx">the</span> <span class="nx">associated</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">writes</span> <span class="nx">the</span> <span class="nx">replicas</span> <span class="nx">to</span> <span class="nx">disk</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">context</span> <span class="nx">encodes</span> <span class="nx">system</span> <span class="nx">metadata</span> <span class="nx">about</span> <span class="nx">the</span> 
<span class="nx">object</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">opaque</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">caller</span> <span class="nx">and</span> <span class="nx">includes</span> <span class="nx">information</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">version</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">object</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">context</span> 
<span class="nx">information</span> <span class="nx">is</span> <span class="nx">stored</span> <span class="nx">along</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">object</span> <span class="nx">so</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">can</span> <span class="nx">verify</span> <span class="nx">the</span> <span class="nx">validity</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">context</span> <span class="nx">object</span> 
<span class="nx">supplied</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">put</span> <span class="nx">request</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Riak concatenates the bucket with the key and runs it through the SHA1 hash to generate a 160 bit identifier 
which is then used to determine where in the database each datum is stored. Riak treats data as an opaque
binary, thus enabling users to store virtually anything. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Dynamo</span> <span class="nx">treats</span> <span class="nx">both</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">object</span> <span class="nx">supplied</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">caller</span> <span class="nx">as</span> <span class="nx">an</span> <span class="nx">opaque</span> <span class="nx">array</span> <span class="nx">of</span> <span class="nx">bytes</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">applies</span> <span class="nx">a</span> <span class="nx">MD5</span> 
<span class="nx">hash</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">to</span> <span class="nx">generate</span> <span class="nx">a</span> <span class="mi">128</span><span class="o">-</span><span class="nx">bit</span> <span class="nx">identifier</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">is</span> <span class="nx">used</span> <span class="nx">to</span> <span class="nx">determine</span> <span class="nx">the</span> <span class="nx">storage</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">are</span> 
<span class="nx">responsible</span> <span class="k">for</span> <span class="nx">serving</span> <span class="nx">the</span> <span class="nx">key</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p><strong>Partitioning in Riak</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">4.2</span> <span class="nx">Partitioning</span> <span class="nx">Algorithm</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>As mentioned above, Riak uses consistent hashing to distribute data around ring to partitions responsible
for storing data. The ring has a maximum key space of 2^160. Each bucket+key (and its associated value)
is hashed to a location on the ring. </p>

<p>Riak also breaks the ring into a set number of partitions. This number is configured when a cluster is first built.
Each node will be repsonsible for storing the data hashed to a set number of partitions. 
Each storage node will optimisitically handle an equal number of partitions. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">One</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">design</span> <span class="nx">requirements</span> <span class="k">for</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">must</span> <span class="nx">scale</span> <span class="nx">incrementally</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">requires</span> <span class="nx">a</span> <span class="nx">mechanism</span> 
<span class="nx">to</span> <span class="nx">dynamically</span> <span class="nx">partition</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">over</span> <span class="nx">the</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">storage</span> <span class="nx">hosts</span><span class="p">)</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">.</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">partitioning</span> 
<span class="nx">scheme</span> <span class="nx">relies</span> <span class="nx">on</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="nx">to</span> <span class="nx">distribute</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">across</span> <span class="nx">multiple</span> <span class="nx">storage</span> <span class="nx">hosts</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> 
<span class="nx">the</span> <span class="nx">output</span> <span class="nx">range</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">hash</span> <span class="kd">function</span> <span class="nx">is</span> <span class="nx">treated</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">fixed</span> <span class="nx">circular</span> <span class="nx">space</span> <span class="nx">or</span> <span class="err">“</span><span class="nx">ring</span><span class="err">”</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.</span> <span class="nx">the</span> <span class="nx">largest</span> <span class="nx">hash</span> <span class="nx">value</span> 
<span class="nx">wraps</span> <span class="nx">around</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">smallest</span> <span class="nx">hash</span> <span class="nx">value</span><span class="p">).</span> <span class="nx">Each</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">a</span> <span class="nx">random</span> <span class="nx">value</span> <span class="nx">within</span> <span class="k">this</span> <span class="nx">space</span> <span class="nx">which</span> 
<span class="nx">represents</span> <span class="nx">its</span> <span class="err">“</span><span class="nx">position</span><span class="err">”</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">Each</span> <span class="nx">data</span> <span class="nx">item</span> <span class="nx">identified</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">key</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">by</span> <span class="nx">hashing</span> <span class="nx">the</span> 
<span class="nx">data</span> <span class="nx">item</span><span class="err">’</span><span class="nx">s</span> <span class="nx">key</span> <span class="nx">to</span> <span class="nx">yield</span> <span class="nx">its</span> <span class="nx">position</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">then</span> <span class="nx">walking</span> <span class="nx">the</span> <span class="nx">ring</span> <span class="nx">clockwise</span> <span class="nx">to</span> <span class="nx">find</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">node</span> <span class="kd">with</span> 
<span class="nx">a</span> <span class="nx">position</span> <span class="nx">larger</span> <span class="nx">than</span> <span class="nx">the</span> <span class="nx">item</span><span class="err">’</span><span class="nx">s</span> <span class="nx">position</span><span class="p">.</span> <span class="nx">Thus</span><span class="p">,</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">becomes</span> <span class="nx">responsible</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">region</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">ring</span> <span class="nx">between</span> 
<span class="nx">it</span> <span class="nx">and</span> <span class="nx">its</span> <span class="nx">predecessor</span> <span class="nx">node</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">principle</span> <span class="nx">advantage</span> <span class="nx">of</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">departure</span> <span class="nx">or</span> 
<span class="nx">arrival</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">only</span> <span class="nx">affects</span> <span class="nx">its</span> <span class="nx">immediate</span> <span class="nx">neighbors</span> <span class="nx">and</span> <span class="nx">other</span> <span class="nx">nodes</span> <span class="nx">remain</span> <span class="nx">unaffected</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Riak also has the concept of virtual nodes and they are used to the same end as they are in Dynamo. 
Phycical storage nodes are responsible for partitions, and each partition a vnode.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">The</span> <span class="nx">basic</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="nx">algorithm</span> <span class="nx">presents</span> <span class="nx">some</span> <span class="nx">challenges</span><span class="p">.</span> <span class="nx">First</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">random</span> <span class="nx">position</span> <span class="nx">assignment</span> <span class="nx">of</span> <span class="nx">each</span> 
<span class="nx">node</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">ring</span> <span class="nx">leads</span> <span class="nx">to</span> <span class="nx">non</span><span class="o">-</span><span class="nx">uniform</span> <span class="nx">data</span> <span class="nx">and</span> <span class="nx">load</span> <span class="nx">distribution</span><span class="p">.</span> <span class="nx">Second</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">basic</span> <span class="nx">algorithm</span> <span class="nx">is</span> <span class="nx">oblivious</span> <span class="nx">to</span> <span class="nx">the</span> 
<span class="nx">heterogeneity</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">address</span> <span class="nx">these</span> <span class="nx">issues</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">a</span> <span class="nx">variant</span> <span class="nx">of</span> <span class="nx">consistent</span> <span class="nx">hashing</span> 
<span class="p">(</span><span class="nx">similar</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">one</span> <span class="nx">used</span> <span class="k">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span><span class="o">:</span> <span class="nx">instead</span> <span class="nx">of</span> <span class="nx">mapping</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">point</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">circle</span><span class="p">,</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">gets</span> 
<span class="nx">assigned</span> <span class="nx">to</span> <span class="nx">multiple</span> <span class="nx">points</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">To</span> <span class="k">this</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">the</span> <span class="nx">concept</span> <span class="nx">of</span> <span class="err">“</span><span class="nx">virtual</span> <span class="nx">nodes</span><span class="err">”</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">virtual</span> <span class="nx">node</span> 
<span class="nx">looks</span> <span class="nx">like</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">but</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">responsible</span> <span class="k">for</span> <span class="nx">more</span> <span class="nx">than</span> <span class="nx">one</span> <span class="nx">virtual</span> <span class="nx">node</span><span class="p">.</span> 
<span class="nx">Effectively</span><span class="p">,</span> <span class="nx">when</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">added</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">multiple</span> <span class="nx">positions</span> <span class="p">(</span><span class="nx">henceforth</span><span class="p">,</span> <span class="err">“</span><span class="nx">tokens</span><span class="err">”</span><span class="p">)</span> 
<span class="k">in</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">process</span> <span class="nx">of</span> <span class="nx">fine</span><span class="o">-</span><span class="nx">tuning</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">partitioning</span> <span class="nx">scheme</span> <span class="nx">is</span> <span class="nx">discussed</span> <span class="k">in</span> <span class="nx">Section</span> <span class="mi">6</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>All of these properties for vnodes in Dynamo hold true for Riak, too. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Using</span> <span class="nx">virtual</span> <span class="nx">nodes</span> <span class="nx">has</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">advantages</span><span class="o">:</span>

<span class="nx">If</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">becomes</span> <span class="nx">unavailable</span> <span class="p">(</span><span class="nx">due</span> <span class="nx">to</span> <span class="nx">failures</span> <span class="nx">or</span> <span class="nx">routine</span> <span class="nx">maintenance</span><span class="p">),</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">handled</span> <span class="nx">by</span> <span class="k">this</span> <span class="nx">node</span> <span class="nx">is</span> 
<span class="nx">evenly</span> <span class="nx">dispersed</span> <span class="nx">across</span> <span class="nx">the</span> <span class="nx">remaining</span> <span class="nx">available</span> <span class="nx">nodes</span><span class="p">.</span>

<span class="nx">When</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">becomes</span> <span class="nx">available</span> <span class="nx">again</span><span class="p">,</span> <span class="nx">or</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">added</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">newly</span> <span class="nx">available</span> <span class="nx">node</span> <span class="nx">accepts</span> 
<span class="nx">a</span> <span class="nx">roughly</span> <span class="nx">equivalent</span> <span class="nx">amount</span> <span class="nx">of</span> <span class="nx">load</span> <span class="nx">from</span> <span class="nx">each</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">other</span> <span class="nx">available</span> <span class="nx">nodes</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p><u>Further Reading on Partitioning in Riak</u></p>

<ul>
<li><a href ="#">All about the Riak Ring</a></li> 
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">The</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">virtual</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">responsible</span> <span class="nx">can</span> <span class="nx">decided</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">its</span> <span class="nx">capacity</span><span class="p">,</span> <span class="nx">accounting</span> <span class="k">for</span> 
<span class="nx">heterogeneity</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">physical</span> <span class="nx">infrastructure</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p><strong>Replication</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">4.3</span> <span class="nx">Replication</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Replication in Riak, like in Dynamo, is fundamental and automatic. Remember above I introduced the 
concept of a bucket? In Riak, the replication parameter, "N" (also called "n&#95;val"),
is configurable at the bucket level. The default n_val in Riak is 3, meaning that 
out of the box Riak will store three replicas of your data on three different partitions on the ring. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">To</span> <span class="nx">achieve</span> <span class="nx">high</span> <span class="nx">availability</span> <span class="nx">and</span> <span class="nx">durability</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">replicates</span> <span class="nx">its</span> <span class="nx">data</span> <span class="nx">on</span> <span class="nx">multiple</span> <span class="nx">hosts</span><span class="p">.</span> <span class="nx">Each</span> <span class="nx">data</span> <span class="nx">item</span> <span class="nx">is</span> 
<span class="nx">replicated</span> <span class="nx">at</span> <span class="nx">N</span> <span class="nx">hosts</span><span class="p">,</span> <span class="nx">where</span> <span class="nx">N</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">parameter</span> <span class="nx">configured</span> <span class="err">“</span><span class="nx">per</span><span class="o">-</span><span class="nx">instance</span><span class="err">”</span><span class="p">.</span> <span class="nx">Each</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">coordinator</span> 
<span class="nx">node</span> <span class="p">(</span><span class="nx">described</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">previous</span> <span class="nx">section</span><span class="p">).</span> <span class="nx">The</span> <span class="nx">coordinator</span> <span class="nx">is</span> <span class="k">in</span> <span class="nx">charge</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">replication</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">items</span> <span class="nx">that</span> 
<span class="nx">fall</span> <span class="nx">within</span> <span class="nx">its</span> <span class="nx">range</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">addition</span> <span class="nx">to</span> <span class="nx">locally</span> <span class="nx">storing</span> <span class="nx">each</span> <span class="nx">key</span> <span class="nx">within</span> <span class="nx">its</span> <span class="nx">range</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">coordinator</span> <span class="nx">replicates</span> 
<span class="nx">these</span> <span class="nx">keys</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">N</span><span class="o">-</span><span class="mi">1</span> <span class="nx">clockwise</span> <span class="nx">successor</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">results</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">system</span> <span class="nx">where</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">is</span> 
<span class="nx">responsible</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">region</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">ring</span> <span class="nx">between</span> <span class="nx">it</span> <span class="nx">and</span> <span class="nx">its</span> <span class="nx">Nth</span> <span class="nx">predecessor</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">Figure</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">node</span> <span class="nx">B</span> <span class="nx">replicates</span> 
<span class="nx">the</span> <span class="nx">key</span> <span class="nx">k</span> <span class="nx">at</span> <span class="nx">nodes</span> <span class="nx">C</span> <span class="nx">and</span> <span class="nx">D</span> <span class="k">in</span> <span class="nx">addition</span> <span class="nx">to</span> <span class="nx">storing</span> <span class="nx">it</span> <span class="nx">locally</span><span class="p">.</span> <span class="nx">Node</span> <span class="nx">D</span> <span class="nx">will</span> <span class="nx">store</span> <span class="nx">the</span> <span class="nx">keys</span> <span class="nx">that</span> <span class="nx">fall</span> <span class="k">in</span> <span class="nx">the</span> 
<span class="nx">ranges</span> <span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">],</span> <span class="p">(</span><span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">],</span> <span class="nx">and</span> <span class="p">(</span><span class="nx">C</span><span class="p">,</span> <span class="nx">D</span><span class="p">].</span>


<span class="nx">Figure</span> <span class="mi">2</span><span class="o">:</span> <span class="nx">Partitioning</span> <span class="nx">and</span> <span class="nx">replication</span> <span class="nx">of</span> <span class="nx">keys</span> <span class="k">in</span> <span class="nx">Dynamo</span> <span class="nx">ring</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>This diagram is applicable to Riak and the manner in which it replicates data.
The preference list is present in Riak, too, and is the reason why any node in the ring
can coordinate a request. The node receives a request, consults the preference list, 
and routes the request accordingly. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">The</span> <span class="nx">list</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">responsible</span> <span class="k">for</span> <span class="nx">storing</span> <span class="nx">a</span> <span class="nx">particular</span> <span class="nx">key</span> <span class="nx">is</span> <span class="nx">called</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">system</span> 
<span class="nx">is</span> <span class="nx">designed</span><span class="p">,</span> <span class="nx">as</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">explained</span> <span class="k">in</span> <span class="nx">Section</span> <span class="mf">4.8</span><span class="p">,</span> <span class="nx">so</span> <span class="nx">that</span> <span class="nx">every</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">can</span> <span class="nx">determine</span> <span class="nx">which</span> <span class="nx">nodes</span> 
<span class="nx">should</span> <span class="nx">be</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">list</span> <span class="k">for</span> <span class="nx">any</span> <span class="nx">particular</span> <span class="nx">key</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">account</span> <span class="k">for</span> <span class="nx">node</span> <span class="nx">failures</span><span class="p">,</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="nx">contains</span> <span class="nx">more</span> 
<span class="nx">than</span> <span class="nx">N</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">Note</span> <span class="nx">that</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">use</span> <span class="nx">of</span> <span class="nx">virtual</span> <span class="nx">nodes</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">possible</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">N</span> <span class="nx">successor</span> <span class="nx">positions</span> 
<span class="k">for</span> <span class="nx">a</span> <span class="nx">particular</span> <span class="nx">key</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">owned</span> <span class="nx">by</span> <span class="nx">less</span> <span class="nx">than</span> <span class="nx">N</span> <span class="nx">distinct</span> <span class="nx">physical</span> <span class="nx">nodes</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">may</span> <span class="nx">hold</span> <span class="nx">more</span> <span class="nx">than</span> <span class="nx">one</span> 
<span class="nx">of</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">N</span> <span class="nx">positions</span><span class="p">).</span> <span class="nx">To</span> <span class="nx">address</span> <span class="k">this</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">key</span> <span class="nx">is</span> <span class="nx">constructed</span> <span class="nx">by</span> <span class="nx">skipping</span> 
<span class="nx">positions</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">ring</span> <span class="nx">to</span> <span class="nx">ensure</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">list</span> <span class="nx">contains</span> <span class="nx">only</span> <span class="nx">distinct</span> <span class="nx">physical</span> <span class="nx">nodes</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Data Versioning</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">4.4</span> <span class="nx">Data</span> <span class="nx">Versioning</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Riak is an "eventually consistent" database. All replication is done asynchronously,
as you can expect, could result in a datum being returned to the client that is out of
date. But don't worry. We built in some mechanisms to address this.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Dynamo</span> <span class="nx">provides</span> <span class="nx">eventual</span> <span class="nx">consistency</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">allows</span> <span class="k">for</span> <span class="nx">updates</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">propagated</span> <span class="nx">to</span> <span class="nx">all</span> <span class="nx">replicas</span> 
<span class="nx">asynchronously</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">put</span><span class="p">()</span> <span class="nx">call</span> <span class="nx">may</span> <span class="k">return</span> <span class="nx">to</span> <span class="nx">its</span> <span class="nx">caller</span> <span class="nx">before</span> <span class="nx">the</span> <span class="nx">update</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">applied</span> <span class="nx">at</span> <span class="nx">all</span> <span class="nx">the</span> 
<span class="nx">replicas</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">can</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">scenarios</span> <span class="nx">where</span> <span class="nx">a</span> <span class="nx">subsequent</span> <span class="nx">get</span><span class="p">()</span> <span class="nx">operation</span> <span class="nx">may</span> <span class="k">return</span> <span class="nx">an</span> <span class="nx">object</span> <span class="nx">that</span> 
<span class="nx">does</span> <span class="nx">not</span> <span class="nx">have</span> <span class="nx">the</span> <span class="nx">latest</span> <span class="nx">updates</span><span class="p">..</span> <span class="nx">If</span> <span class="nx">there</span> <span class="nx">are</span> <span class="nx">no</span> <span class="nx">failures</span> <span class="nx">then</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">bound</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">update</span> 
<span class="nx">propagation</span> <span class="nx">times</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">under</span> <span class="nx">certain</span> <span class="nx">failure</span> <span class="nx">scenarios</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.,</span> <span class="nx">server</span> <span class="nx">outages</span> <span class="nx">or</span> <span class="nx">network</span> <span class="nx">partitions</span><span class="p">),</span>
<span class="nx">updates</span> <span class="nx">may</span> <span class="nx">not</span> <span class="nx">arrive</span> <span class="nx">at</span> <span class="nx">all</span> <span class="nx">replicas</span> <span class="k">for</span> <span class="nx">an</span> <span class="nx">extended</span> <span class="nx">period</span> <span class="nx">of</span> <span class="nx">time</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Much like Dynamo was suited to the design of the shopping cart, Riak, and its tradeoffs, 
are appropriate for a certain set of use cases. We happen to feel that <em>most</em> use cases
can tolerate some level of eventual consistency. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">There</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">category</span> <span class="nx">of</span> <span class="nx">applications</span> <span class="k">in</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span> <span class="nx">that</span> <span class="nx">can</span> <span class="nx">tolerate</span> <span class="nx">such</span> <span class="nx">inconsistencies</span> <span class="nx">and</span> 
<span class="nx">can</span> <span class="nx">be</span> <span class="nx">constructed</span> <span class="nx">to</span> <span class="nx">operate</span> <span class="nx">under</span> <span class="nx">these</span> <span class="nx">conditions</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">example</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">shopping</span> <span class="nx">cart</span> <span class="nx">application</span> <span class="nx">requires</span> 
<span class="nx">that</span> <span class="nx">an</span> <span class="err">“</span><span class="nx">Add</span> <span class="nx">to</span> <span class="nx">Cart</span><span class="err">”</span> <span class="nx">operation</span> <span class="nx">can</span> <span class="nx">never</span> <span class="nx">be</span> <span class="nx">forgotten</span> <span class="nx">or</span> <span class="nx">rejected</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">the</span> <span class="nx">most</span> <span class="nx">recent</span> <span class="nx">state</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">cart</span> 
<span class="nx">is</span> <span class="nx">unavailable</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">makes</span> <span class="nx">changes</span> <span class="nx">to</span> <span class="nx">an</span> <span class="nx">older</span> <span class="nx">version</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">cart</span><span class="p">,</span> <span class="nx">that</span> <span class="nx">change</span> <span class="nx">is</span> <span class="nx">still</span> <span class="nx">meaningful</span> 
<span class="nx">and</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">preserved</span><span class="p">.</span> <span class="nx">But</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">time</span> <span class="nx">it</span> <span class="nx">shouldn</span><span class="err">’</span><span class="nx">t</span> <span class="nx">supersede</span> <span class="nx">the</span> <span class="nx">currently</span> <span class="nx">unavailable</span> <span class="nx">state</span> <span class="nx">of</span> 
<span class="nx">the</span> <span class="nx">cart</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">itself</span> <span class="nx">may</span> <span class="nx">contain</span> <span class="nx">changes</span> <span class="nx">that</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">preserved</span><span class="p">.</span> <span class="nx">Note</span> <span class="nx">that</span> <span class="nx">both</span> <span class="err">“</span><span class="nx">add</span> <span class="nx">to</span> <span class="nx">cart</span><span class="err">”</span> <span class="nx">and</span> 
<span class="err">“</span><span class="k">delete</span> <span class="nx">item</span> <span class="nx">from</span> <span class="nx">cart</span><span class="err">”</span> <span class="nx">operations</span> <span class="nx">are</span> <span class="nx">translated</span> <span class="nx">into</span> <span class="nx">put</span> <span class="nx">requests</span> <span class="nx">to</span> <span class="nx">Dynamo</span><span class="p">.</span> <span class="nx">When</span> <span class="nx">a</span> <span class="nx">customer</span> <span class="nx">wants</span> <span class="nx">to</span> 
<span class="nx">add</span> <span class="nx">an</span> <span class="nx">item</span> <span class="nx">to</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">remove</span> <span class="nx">from</span><span class="p">)</span> <span class="nx">a</span> <span class="nx">shopping</span> <span class="nx">cart</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">latest</span> <span class="nx">version</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">available</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">item</span> <span class="nx">is</span> <span class="nx">added</span> 
<span class="nx">to</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">removed</span> <span class="nx">from</span><span class="p">)</span> <span class="nx">the</span> <span class="nx">older</span> <span class="nx">version</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">divergent</span> <span class="nx">versions</span> <span class="nx">are</span> <span class="nx">reconciled</span> <span class="nx">later</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>The same holds true for Riak. If, by way of some failure and concurrent update 
(rare but quite possible), there come to exist multiple versions of the same object, 
Riak will push this decision down to the client (who are we to tell you which is the 
authoritative object?). All that said, if your application doesn't need this level of 
version control, we enable you to turn the usage of vector clocks on and off at the bucket 
level.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">In</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">provide</span> <span class="k">this</span> <span class="nx">kind</span> <span class="nx">of</span> <span class="nx">guarantee</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">treats</span> <span class="nx">the</span> <span class="nx">result</span> <span class="nx">of</span> <span class="nx">each</span> <span class="nx">modification</span> <span class="nx">as</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">and</span> 
<span class="nx">immutable</span> <span class="nx">version</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">allows</span> <span class="k">for</span> <span class="nx">multiple</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">an</span> <span class="nx">object</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">present</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">at</span> 
<span class="nx">the</span> <span class="nx">same</span> <span class="nx">time</span><span class="p">.</span> <span class="nx">Most</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">time</span><span class="p">,</span> <span class="k">new</span> <span class="nx">versions</span> <span class="nx">subsume</span> <span class="nx">the</span> <span class="nx">previous</span> <span class="nx">version</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">itself</span> <span class="nx">can</span> 
<span class="nx">determine</span> <span class="nx">the</span> <span class="nx">authoritative</span> <span class="nx">version</span> <span class="p">(</span><span class="nx">syntactic</span> <span class="nx">reconciliation</span><span class="p">).</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">version</span> <span class="nx">branching</span> <span class="nx">may</span> <span class="nx">happen</span><span class="p">,</span> <span class="k">in</span> 
<span class="nx">the</span> <span class="nx">presence</span> <span class="nx">of</span> <span class="nx">failures</span> <span class="nx">combined</span> <span class="kd">with</span> <span class="nx">concurrent</span> <span class="nx">updates</span><span class="p">,</span> <span class="nx">resulting</span> <span class="k">in</span> <span class="nx">conflicting</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">an</span> <span class="nx">object</span><span class="p">.</span> 
<span class="nx">In</span> <span class="nx">these</span> <span class="nx">cases</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">cannot</span> <span class="nx">reconcile</span> <span class="nx">the</span> <span class="nx">multiple</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">object</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">must</span> 
<span class="nx">perform</span> <span class="nx">the</span> <span class="nx">reconciliation</span> <span class="k">in</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">collapse</span> <span class="nx">multiple</span> <span class="nx">branches</span> <span class="nx">of</span> <span class="nx">data</span> <span class="nx">evolution</span> <span class="nx">back</span> <span class="nx">into</span> <span class="nx">one</span> <span class="p">(</span><span class="nx">semantic</span> 
<span class="nx">reconciliation</span><span class="p">).</span> <span class="nx">A</span> <span class="nx">typical</span> <span class="nx">example</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">collapse</span> <span class="nx">operation</span> <span class="nx">is</span> <span class="err">“</span><span class="nx">merging</span><span class="err">”</span> <span class="nx">different</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">customer</span><span class="err">’</span><span class="nx">s</span> 
<span class="nx">shopping</span> <span class="nx">cart</span><span class="p">.</span> <span class="nx">Using</span> <span class="k">this</span> <span class="nx">reconciliation</span> <span class="nx">mechanism</span><span class="p">,</span> <span class="nx">an</span> <span class="err">“</span><span class="nx">add</span> <span class="nx">to</span> <span class="nx">cart</span><span class="err">”</span> <span class="nx">operation</span> <span class="nx">is</span> <span class="nx">never</span> <span class="nx">lost</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> 
<span class="nx">deleted</span> <span class="nx">items</span> <span class="nx">can</span> <span class="nx">resurface</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Ditto</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">It</span> <span class="nx">is</span> <span class="nx">important</span> <span class="nx">to</span> <span class="nx">understand</span> <span class="nx">that</span> <span class="nx">certain</span> <span class="nx">failure</span> <span class="nx">modes</span> <span class="nx">can</span> <span class="nx">potentially</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">having</span> <span class="nx">not</span> 
<span class="nx">just</span> <span class="nx">two</span> <span class="nx">but</span> <span class="nx">several</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">data</span><span class="p">.</span> <span class="nx">Updates</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">presence</span> <span class="nx">of</span> <span class="nx">network</span> <span class="nx">partitions</span> <span class="nx">and</span> <span class="nx">node</span> 
<span class="nx">failures</span> <span class="nx">can</span> <span class="nx">potentially</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">an</span> <span class="nx">object</span> <span class="nx">having</span> <span class="nx">distinct</span> <span class="nx">version</span> <span class="nx">sub</span><span class="o">-</span><span class="nx">histories</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">will</span> 
<span class="nx">need</span> <span class="nx">to</span> <span class="nx">reconcile</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">future</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">requires</span> <span class="nx">us</span> <span class="nx">to</span> <span class="nx">design</span> <span class="nx">applications</span> <span class="nx">that</span> <span class="nx">explicitly</span> <span class="nx">acknowledge</span> <span class="nx">the</span> 
<span class="nx">possibility</span> <span class="nx">of</span> <span class="nx">multiple</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">data</span> <span class="p">(</span><span class="k">in</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">never</span> <span class="nx">lose</span> <span class="nx">any</span> <span class="nx">updates</span><span class="p">).</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>As you've probably figured out already, Riak uses vector clocks for object versioning, too.
Here are a whole host of resources to keep you busy for a while:</p>

<ul>
<li><a href ="http://wiki.basho.com/display/RIAK/Riak+Glossary#RiakGlossary-VectorClock">Vector Clocks on the Riak Wiki</a></li>
<li><a href="http://blog.basho.com/2010/01/29/why-vector-clocks-are-easy/">Why Vector Clocks are Easy</a></li>
<li><a href="http://blog.basho.com/2010/04/05/why-vector-clocks-are-hard/">Why Vector Clocks are Hard</a></li>
<li><a href="http://en.wikipedia.org/wiki/Vector_clock">Vector Clocks on Wikipedia</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">vector</span> <span class="nx">clocks</span> <span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="k">in</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">capture</span> <span class="nx">causality</span> <span class="nx">between</span> <span class="nx">different</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">object</span><span class="p">.</span> 
<span class="nx">A</span> <span class="nx">vector</span> <span class="nx">clock</span> <span class="nx">is</span> <span class="nx">effectively</span> <span class="nx">a</span> <span class="nx">list</span> <span class="nx">of</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">counter</span><span class="p">)</span> <span class="nx">pairs</span><span class="p">.</span> <span class="nx">One</span> <span class="nx">vector</span> <span class="nx">clock</span> <span class="nx">is</span> <span class="nx">associated</span> <span class="kd">with</span> <span class="nx">every</span> 
<span class="nx">version</span> <span class="nx">of</span> <span class="nx">every</span> <span class="nx">object</span><span class="p">.</span> <span class="nx">One</span> <span class="nx">can</span> <span class="nx">determine</span> <span class="nx">whether</span> <span class="nx">two</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">an</span> <span class="nx">object</span> <span class="nx">are</span> <span class="nx">on</span> <span class="nx">parallel</span> <span class="nx">branches</span> 
<span class="nx">or</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">causal</span> <span class="nx">ordering</span><span class="p">,</span> <span class="nx">by</span> <span class="nx">examine</span> <span class="nx">their</span> <span class="nx">vector</span> <span class="nx">clocks</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">the</span> <span class="nx">counters</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">object</span><span class="err">’</span><span class="nx">s</span> <span class="nx">clock</span> 
<span class="nx">are</span> <span class="nx">less</span><span class="o">-</span><span class="nx">than</span><span class="o">-</span><span class="nx">or</span><span class="o">-</span><span class="nx">equal</span> <span class="nx">to</span> <span class="nx">all</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">second</span> <span class="nx">clock</span><span class="p">,</span> <span class="nx">then</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">is</span> <span class="nx">an</span> <span class="nx">ancestor</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">second</span> <span class="nx">and</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">forgotten</span><span class="p">.</span> <span class="nx">Otherwise</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">two</span> <span class="nx">changes</span> <span class="nx">are</span> <span class="nx">considered</span> <span class="nx">to</span> <span class="nx">be</span> <span class="k">in</span> <span class="nx">conflict</span> <span class="nx">and</span> <span class="nx">require</span> 
<span class="nx">reconciliation</span><span class="p">.</span>

<span class="nx">In</span> <span class="nx">Dynamo</span><span class="p">,</span> <span class="nx">when</span> <span class="nx">a</span> <span class="nx">client</span> <span class="nx">wishes</span> <span class="nx">to</span> <span class="nx">update</span> <span class="nx">an</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">must</span> <span class="nx">specify</span> <span class="nx">which</span> <span class="nx">version</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">updating</span><span class="p">.</span> 
<span class="nx">This</span> <span class="nx">is</span> <span class="nx">done</span> <span class="nx">by</span> <span class="nx">passing</span> <span class="nx">the</span> <span class="nx">context</span> <span class="nx">it</span> <span class="nx">obtained</span> <span class="nx">from</span> <span class="nx">an</span> <span class="nx">earlier</span> <span class="nx">read</span> <span class="nx">operation</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">contains</span> <span class="nx">the</span> 
<span class="nx">vector</span> <span class="nx">clock</span> <span class="nx">information</span><span class="p">.</span> <span class="nx">Upon</span> <span class="nx">processing</span> <span class="nx">a</span> <span class="nx">read</span> <span class="nx">request</span><span class="p">,</span> <span class="k">if</span> <span class="nx">Dynamo</span> <span class="nx">has</span> <span class="nx">access</span> <span class="nx">to</span> <span class="nx">multiple</span> <span class="nx">branches</span> 
<span class="nx">that</span> <span class="nx">cannot</span> <span class="nx">be</span> <span class="nx">syntactically</span> <span class="nx">reconciled</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">will</span> <span class="k">return</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">objects</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">leaves</span><span class="p">,</span> <span class="kd">with</span> <span class="nx">the</span> 
<span class="nx">corresponding</span> <span class="nx">version</span> <span class="nx">information</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">context</span><span class="p">.</span> <span class="nx">An</span> <span class="nx">update</span> <span class="nx">using</span> <span class="k">this</span> <span class="nx">context</span> <span class="nx">is</span> <span class="nx">considered</span> <span class="nx">to</span> <span class="nx">have</span> 
<span class="nx">reconciled</span> <span class="nx">the</span> <span class="nx">divergent</span> <span class="nx">versions</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">branches</span> <span class="nx">are</span> <span class="nx">collapsed</span> <span class="nx">into</span> <span class="nx">a</span> <span class="nx">single</span> <span class="k">new</span> <span class="nx">version</span><span class="p">.</span>

<span class="nx">Figure</span> <span class="mi">3</span><span class="o">:</span> <span class="nx">Version</span> <span class="nx">evolution</span> <span class="nx">of</span> <span class="nx">an</span> <span class="nx">object</span> <span class="nx">over</span> <span class="nx">time</span><span class="p">.</span>

<span class="nx">To</span> <span class="nx">illustrate</span> <span class="nx">the</span> <span class="nx">use</span> <span class="nx">of</span> <span class="nx">vector</span> <span class="nx">clocks</span><span class="p">,</span> <span class="nx">let</span> <span class="nx">us</span> <span class="nx">consider</span> <span class="nx">the</span> <span class="nx">example</span> <span class="nx">shown</span> <span class="k">in</span> <span class="nx">Figure</span> <span class="mi">3</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">client</span> <span class="nx">writes</span> <span class="nx">a</span> 
<span class="k">new</span> <span class="nx">object</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">node</span> <span class="p">(</span><span class="nx">say</span> <span class="nx">Sx</span><span class="p">)</span> <span class="nx">that</span> <span class="nx">handles</span> <span class="nx">the</span> <span class="nx">write</span> <span class="k">for</span> <span class="k">this</span> <span class="nx">key</span> <span class="nx">increases</span> <span class="nx">its</span> <span class="nx">sequence</span> <span class="nx">number</span> <span class="nx">and</span> <span class="nx">uses</span> 
<span class="nx">it</span> <span class="nx">to</span> <span class="nx">create</span> <span class="nx">the</span> <span class="nx">data</span><span class="s1">&#39;s vector clock. The system now has the object D1 and its associated clock [(Sx, 1)]. </span>
<span class="s1">The client updates the object. Assume the same node handles this request as well. The system now also has </span>
<span class="s1">object D2 and its associated clock [(Sx, 2)]. D2 descends from D1 and therefore over-writes D1, however </span>
<span class="s1">there may be replicas of D1 lingering at nodes that have not yet seen D2. Let us assume that the same </span>
<span class="s1">client updates the object again and a different server (say Sy) handles the request. The system now has </span>
<span class="s1">data D3 and its associated clock [(Sx, 2), (Sy, 1)].</span>

<span class="s1">Next assume a different client reads D2 and then tries to update it, and another node (say Sz) does the </span>
<span class="s1">write. The system now has D4 (descendant of D2) whose version clock is [(Sx, 2), (Sz, 1)]. A node that is </span>
<span class="s1">aware of D1 or D2 could determine, upon receiving D4 and its clock, that D1 and D2 are overwritten by the </span>
<span class="s1">new data and can be garbage collected. A node that is aware of D3 and receives D4 will find that there </span>
<span class="s1">is no causal relation between them. In other words, there are changes in D3 and D4 that are not reflected </span>
<span class="s1">in each other. Both versions of the data must be kept and presented to a client (upon a read) for </span>
<span class="s1">semantic reconciliation.</span>

<span class="s1">Now assume some client reads both D3 and D4 (the context will reflect that </span>
<span class="s1">both values were found by the read). The read&#39;</span><span class="nx">s</span> <span class="nx">context</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">summary</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">clocks</span> <span class="nx">of</span> <span class="nx">D3</span> <span class="nx">and</span> <span class="nx">D4</span><span class="p">,</span> <span class="nx">namely</span> 
<span class="p">[(</span><span class="nx">Sx</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="nx">Sy</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="nx">Sz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)].</span> <span class="nx">If</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">performs</span> <span class="nx">the</span> <span class="nx">reconciliation</span> <span class="nx">and</span> <span class="nx">node</span> <span class="nx">Sx</span> 
<span class="nx">coordinates</span> <span class="nx">the</span> <span class="nx">write</span><span class="p">,</span> <span class="nx">Sx</span> <span class="nx">will</span> <span class="nx">update</span> <span class="nx">its</span> <span class="nx">sequence</span> <span class="nx">number</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">clock</span><span class="p">.</span> <span class="nx">The</span> <span class="k">new</span> 
<span class="nx">data</span> <span class="nx">D5</span> <span class="nx">will</span> <span class="nx">have</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">clock</span><span class="o">:</span> <span class="p">[(</span><span class="nx">Sx</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="nx">Sy</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="nx">Sz</span><span class="p">,</span> <span class="mi">1</span><span class="p">)].</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Riak does a certain amount of vector clock pruning to ensure their growth is kept under control.  </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">A</span> <span class="nx">possible</span> <span class="nx">issue</span> <span class="kd">with</span> <span class="nx">vector</span> <span class="nx">clocks</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">size</span> <span class="nx">of</span> <span class="nx">vector</span> <span class="nx">clocks</span> <span class="nx">may</span> <span class="nx">grow</span> <span class="k">if</span> <span class="nx">many</span> <span class="nx">servers</span> 
<span class="nx">coordinate</span> <span class="nx">the</span> <span class="nx">writes</span> <span class="nx">to</span> <span class="nx">an</span> <span class="nx">object</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">practice</span><span class="p">,</span> <span class="k">this</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">likely</span> <span class="nx">because</span> <span class="nx">the</span> <span class="nx">writes</span> <span class="nx">are</span> <span class="nx">usually</span> 
<span class="nx">handled</span> <span class="nx">by</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">.</span> <span class="nx">In</span> <span class="k">case</span> <span class="nx">of</span> <span class="nx">network</span> <span class="nx">partitions</span> <span class="nx">or</span> <span class="nx">multiple</span> 
<span class="nx">server</span> <span class="nx">failures</span><span class="p">,</span> <span class="nx">write</span> <span class="nx">requests</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">handled</span> <span class="nx">by</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">not</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> 
<span class="nx">preference</span> <span class="nx">list</span> <span class="nx">causing</span> <span class="nx">the</span> <span class="nx">size</span> <span class="nx">of</span> <span class="nx">vector</span> <span class="nx">clock</span> <span class="nx">to</span> <span class="nx">grow</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">these</span> <span class="nx">scenarios</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">desirable</span> <span class="nx">to</span> <span class="nx">limit</span> 
<span class="nx">the</span> <span class="nx">size</span> <span class="nx">of</span> <span class="nx">vector</span> <span class="nx">clock</span><span class="p">.</span> <span class="nx">To</span> <span class="k">this</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">employs</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">clock</span> <span class="nx">truncation</span> <span class="nx">scheme</span><span class="o">:</span> <span class="nx">Along</span> <span class="kd">with</span> 
<span class="nx">each</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">counter</span><span class="p">)</span> <span class="nx">pair</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">stores</span> <span class="nx">a</span> <span class="nx">timestamp</span> <span class="nx">that</span> <span class="nx">indicates</span> <span class="nx">the</span> <span class="nx">last</span> <span class="nx">time</span> <span class="nx">the</span> <span class="nx">node</span> <span class="nx">updated</span> <span class="nx">the</span> 
<span class="nx">data</span> <span class="nx">item</span><span class="p">.</span> <span class="nx">When</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">counter</span><span class="p">)</span> <span class="nx">pairs</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">vector</span> <span class="nx">clock</span> <span class="nx">reaches</span> <span class="nx">a</span> <span class="nx">threshold</span> <span class="p">(</span><span class="nx">say</span> <span class="mi">10</span><span class="p">),</span> 
<span class="nx">the</span> <span class="nx">oldest</span> <span class="nx">pair</span> <span class="nx">is</span> <span class="nx">removed</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">clock</span><span class="p">.</span> <span class="nx">Clearly</span><span class="p">,</span> <span class="k">this</span> <span class="nx">truncation</span> <span class="nx">scheme</span> <span class="nx">can</span> <span class="nx">lead</span> <span class="nx">to</span> <span class="nx">inefficiencies</span> 
<span class="k">in</span> <span class="nx">reconciliation</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">descendant</span> <span class="nx">relationships</span> <span class="nx">cannot</span> <span class="nx">be</span> <span class="nx">derived</span> <span class="nx">accurately</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="k">this</span> <span class="nx">problem</span> 
<span class="nx">has</span> <span class="nx">not</span> <span class="nx">surfaced</span> <span class="k">in</span> <span class="nx">production</span> <span class="nx">and</span> <span class="nx">therefore</span> <span class="k">this</span> <span class="nx">issue</span> <span class="nx">has</span> <span class="nx">not</span> <span class="nx">been</span> <span class="nx">thoroughly</span> <span class="nx">investigated</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p><strong>Execution of get () and put () operations</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">4.5</span> <span class="nx">Execution</span> <span class="nx">of</span> <span class="nx">get</span> <span class="p">()</span> <span class="nx">and</span> <span class="nx">put</span> <span class="p">()</span> <span class="nx">operations</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Any node in the Riak ring can coordinate a request. The Riak information in this section 
applies to a failure-free environment. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Any</span> <span class="nx">storage</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">eligible</span> <span class="nx">to</span> <span class="nx">receive</span> <span class="nx">client</span> <span class="nx">get</span> <span class="nx">and</span> <span class="nx">put</span> <span class="nx">operations</span> <span class="k">for</span> <span class="nx">any</span> <span class="nx">key</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> 
<span class="nx">section</span><span class="p">,</span> <span class="k">for</span> <span class="nx">sake</span> <span class="nx">of</span> <span class="nx">simplicity</span><span class="p">,</span> <span class="nx">we</span> <span class="nx">describe</span> <span class="nx">how</span> <span class="nx">these</span> <span class="nx">operations</span> <span class="nx">are</span> <span class="nx">performed</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">failure</span><span class="o">-</span><span class="nx">free</span> <span class="nx">environment</span> 
<span class="nx">and</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">subsequent</span> <span class="nx">section</span> <span class="nx">we</span> <span class="nx">describe</span> <span class="nx">how</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">operations</span> <span class="nx">are</span> <span class="nx">executed</span> <span class="nx">during</span> <span class="nx">failures</span><span class="p">.</span>

<span class="nx">Both</span> <span class="nx">get</span> <span class="nx">and</span> <span class="nx">put</span> <span class="nx">operations</span> <span class="nx">are</span> <span class="nx">invoked</span> <span class="nx">using</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">infrastructure</span><span class="o">-</span><span class="nx">specific</span> <span class="nx">request</span> <span class="nx">processing</span> <span class="nx">framework</span> 
<span class="nx">over</span> <span class="nx">HTTP</span><span class="p">.</span> <span class="nx">There</span> <span class="nx">are</span> <span class="nx">two</span> <span class="nx">strategies</span> <span class="nx">that</span> <span class="nx">a</span> <span class="nx">client</span> <span class="nx">can</span> <span class="nx">use</span> <span class="nx">to</span> <span class="nx">select</span> <span class="nx">a</span> <span class="nx">node</span><span class="o">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="nx">route</span> <span class="nx">its</span> <span class="nx">request</span> <span class="nx">through</span> <span class="nx">a</span> 
<span class="nx">generic</span> <span class="nx">load</span> <span class="nx">balancer</span> <span class="nx">that</span> <span class="nx">will</span> <span class="nx">select</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">load</span> <span class="nx">information</span><span class="p">,</span> <span class="nx">or</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="nx">use</span> <span class="nx">a</span> <span class="nx">partition</span><span class="o">-</span><span class="nx">aware</span> <span class="nx">client</span> 
<span class="nx">library</span> <span class="nx">that</span> <span class="nx">routes</span> <span class="nx">requests</span> <span class="nx">directly</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">appropriate</span> <span class="nx">coordinator</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">advantage</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">first</span> 
<span class="nx">approach</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">have</span> <span class="nx">to</span> <span class="nx">link</span> <span class="nx">any</span> <span class="nx">code</span> <span class="nx">specific</span> <span class="nx">to</span> <span class="nx">Dynamo</span> <span class="k">in</span> <span class="nx">its</span> <span class="nx">application</span><span class="p">,</span> <span class="nx">whereas</span> 
<span class="nx">the</span> <span class="nx">second</span> <span class="nx">strategy</span> <span class="nx">can</span> <span class="nx">achieve</span> <span class="nx">lower</span> <span class="nx">latency</span> <span class="nx">because</span> <span class="nx">it</span> <span class="nx">skips</span> <span class="nx">a</span> <span class="nx">potential</span> <span class="nx">forwarding</span> <span class="nx">step</span><span class="p">.</span>

<span class="nx">A</span> <span class="nx">node</span> <span class="nx">handling</span> <span class="nx">a</span> <span class="nx">read</span> <span class="nx">or</span> <span class="nx">write</span> <span class="nx">operation</span> <span class="nx">is</span> <span class="nx">known</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">coordinator</span><span class="p">.</span> <span class="nx">Typically</span><span class="p">,</span> <span class="k">this</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">first</span> 
<span class="nx">among</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">the</span> <span class="nx">requests</span> <span class="nx">are</span> <span class="nx">received</span> <span class="nx">through</span> <span class="nx">a</span> <span class="nx">load</span> <span class="nx">balancer</span><span class="p">,</span> 
<span class="nx">requests</span> <span class="nx">to</span> <span class="nx">access</span> <span class="nx">a</span> <span class="nx">key</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">routed</span> <span class="nx">to</span> <span class="nx">any</span> <span class="nx">random</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">scenario</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">node</span> <span class="nx">that</span> 
<span class="nx">receives</span> <span class="nx">the</span> <span class="nx">request</span> <span class="nx">will</span> <span class="nx">not</span> <span class="nx">coordinate</span> <span class="nx">it</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">not</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">requested</span> <span class="nx">key</span><span class="err">’</span><span class="nx">s</span> 
<span class="nx">preference</span> <span class="nx">list</span><span class="p">.</span> <span class="nx">Instead</span><span class="p">,</span> <span class="nx">that</span> <span class="nx">node</span> <span class="nx">will</span> <span class="nx">forward</span> <span class="nx">the</span> <span class="nx">request</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">among</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">nodes</span> <span class="k">in</span> 
<span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">.</span>

<span class="nx">Read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">operations</span> <span class="nx">involve</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">N</span> <span class="nx">healthy</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">skipping</span> <span class="nx">over</span> 
<span class="nx">those</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">down</span> <span class="nx">or</span> <span class="nx">inaccessible</span><span class="p">.</span> <span class="nx">When</span> <span class="nx">all</span> <span class="nx">nodes</span> <span class="nx">are</span> <span class="nx">healthy</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">key</span><span class="err">’</span><span class="nx">s</span> <span class="nx">preference</span> 
<span class="nx">list</span> <span class="nx">are</span> <span class="nx">accessed</span><span class="p">.</span> <span class="nx">When</span> <span class="nx">there</span> <span class="nx">are</span> <span class="nx">node</span> <span class="nx">failures</span> <span class="nx">or</span> <span class="nx">network</span> <span class="nx">partitions</span><span class="p">,</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">lower</span> <span class="nx">ranked</span> <span class="k">in</span> 
<span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="nx">are</span> <span class="nx">accessed</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Riak makes use of the same values. But, thanks to our concept of buckets, we made it a bit more
customizable. The default R and W values are set at the bucket level but can be configured at 
the request level if the developer deems it necessary for certain data.
"Quorum" as described in Dynamo is the default setting in Riak. </p>

<p>Some more resources on R and W:</p>

<ul>
<li><a href ="http://wiki.basho.com/display/RIAK/REST+API">Riak's REST API</a></li>
<li><a href="http://wiki.basho.com/display/RIAK/An+Introduction+to+Riak#AnIntroductiontoRiak-ReadingData"> Reading and Writing Data</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">To</span> <span class="nx">maintain</span> <span class="nx">consistency</span> <span class="nx">among</span> <span class="nx">its</span> <span class="nx">replicas</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">a</span> <span class="nx">consistency</span> <span class="nx">protocol</span> <span class="nx">similar</span> <span class="nx">to</span> <span class="nx">those</span> <span class="nx">used</span> <span class="k">in</span> 
<span class="nx">quorum</span> <span class="nx">systems</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">protocol</span> <span class="nx">has</span> <span class="nx">two</span> <span class="nx">key</span> <span class="nx">configurable</span> <span class="nx">values</span><span class="o">:</span> <span class="nx">R</span> <span class="nx">and</span> <span class="nx">W</span><span class="p">.</span> <span class="nx">R</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">minimum</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">nodes</span> 
<span class="nx">that</span> <span class="nx">must</span> <span class="nx">participate</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">successful</span> <span class="nx">read</span> <span class="nx">operation</span><span class="p">.</span> <span class="nx">W</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">minimum</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">must</span> 
<span class="nx">participate</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">successful</span> <span class="nx">write</span> <span class="nx">operation</span><span class="p">.</span> <span class="nx">Setting</span> <span class="nx">R</span> <span class="nx">and</span> <span class="nx">W</span> <span class="nx">such</span> <span class="nx">that</span> <span class="nx">R</span> <span class="o">+</span> <span class="nx">W</span> <span class="o">&gt;</span> <span class="nx">N</span> <span class="nx">yields</span> <span class="nx">a</span> <span class="nx">quorum</span><span class="o">-</span><span class="nx">like</span> 
<span class="nx">system</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">latency</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">get</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">put</span><span class="p">)</span> <span class="nx">operation</span> <span class="nx">is</span> <span class="nx">dictated</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">slowest</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">R</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">W</span><span class="p">)</span> 
<span class="nx">replicas</span><span class="p">.</span> <span class="nx">For</span> <span class="k">this</span> <span class="nx">reason</span><span class="p">,</span> <span class="nx">R</span> <span class="nx">and</span> <span class="nx">W</span> <span class="nx">are</span> <span class="nx">usually</span> <span class="nx">configured</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">less</span> <span class="nx">than</span> <span class="nx">N</span><span class="p">,</span> <span class="nx">to</span> <span class="nx">provide</span> <span class="nx">better</span> <span class="nx">latency</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Check on this</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Upon</span> <span class="nx">receiving</span> <span class="nx">a</span> <span class="nx">put</span><span class="p">()</span> <span class="nx">request</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">coordinator</span> <span class="nx">generates</span> <span class="nx">the</span> <span class="nx">vector</span> <span class="nx">clock</span> <span class="k">for</span> <span class="nx">the</span> <span class="k">new</span> <span class="nx">version</span> <span class="nx">and</span> 
<span class="nx">writes</span> <span class="nx">the</span> <span class="k">new</span> <span class="nx">version</span> <span class="nx">locally</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">coordinator</span> <span class="nx">then</span> <span class="nx">sends</span> <span class="nx">the</span> <span class="k">new</span> <span class="nx">version</span> <span class="p">(</span><span class="nx">along</span> <span class="kd">with</span> <span class="nx">the</span> <span class="k">new</span> <span class="nx">vector</span> <span class="nx">clock</span><span class="p">)</span> 
<span class="nx">to</span> <span class="nx">the</span> <span class="nx">N</span> <span class="nx">highest</span><span class="o">-</span><span class="nx">ranked</span> <span class="nx">reachable</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">at</span> <span class="nx">least</span> <span class="nx">W</span><span class="o">-</span><span class="mi">1</span> <span class="nx">nodes</span> <span class="nx">respond</span> <span class="nx">then</span> <span class="nx">the</span> <span class="nx">write</span> <span class="nx">is</span> <span class="nx">considered</span> <span class="nx">successful</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Check on this</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Similarly</span><span class="p">,</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">get</span><span class="p">()</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">coordinator</span> <span class="nx">requests</span> <span class="nx">all</span> <span class="nx">existing</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">data</span> <span class="k">for</span> <span class="nx">that</span> <span class="nx">key</span> <span class="nx">from</span> <span class="nx">the</span> 
<span class="nx">N</span> <span class="nx">highest</span><span class="o">-</span><span class="nx">ranked</span> <span class="nx">reachable</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="k">for</span> <span class="nx">that</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">then</span> <span class="nx">waits</span> <span class="k">for</span> <span class="nx">R</span> <span class="nx">responses</span> 
<span class="nx">before</span> <span class="nx">returning</span> <span class="nx">the</span> <span class="nx">result</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">client</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">the</span> <span class="nx">coordinator</span> <span class="nx">ends</span> <span class="nx">up</span> <span class="nx">gathering</span> <span class="nx">multiple</span> <span class="nx">versions</span> <span class="nx">of</span> 
<span class="nx">the</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">returns</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">versions</span> <span class="nx">it</span> <span class="nx">deems</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">causally</span> <span class="nx">unrelated</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">divergent</span> <span class="nx">versions</span> <span class="nx">are</span> 
<span class="nx">then</span> <span class="nx">reconciled</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">reconciled</span> <span class="nx">version</span> <span class="nx">superseding</span> <span class="nx">the</span> <span class="nx">current</span> <span class="nx">versions</span> <span class="nx">is</span> <span class="nx">written</span> <span class="nx">back</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Annotate this  </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">4.6</span> <span class="nx">Handling</span> <span class="nx">Failures</span><span class="o">:</span> <span class="nx">Hinted</span> <span class="nx">Handoff</span>

<span class="nx">If</span> <span class="nx">Dynamo</span> <span class="nx">used</span> <span class="nx">a</span> <span class="nx">traditional</span> <span class="nx">quorum</span> <span class="nx">approach</span> <span class="nx">it</span> <span class="nx">would</span> <span class="nx">be</span> <span class="nx">unavailable</span> <span class="nx">during</span> <span class="nx">server</span> <span class="nx">failures</span> <span class="nx">and</span> <span class="nx">network</span> 
<span class="nx">partitions</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">would</span> <span class="nx">have</span> <span class="nx">reduced</span> <span class="nx">durability</span> <span class="nx">even</span> <span class="nx">under</span> <span class="nx">the</span> <span class="nx">simplest</span> <span class="nx">of</span> <span class="nx">failure</span> <span class="nx">conditions</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">remedy</span> 
<span class="k">this</span> <span class="nx">it</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">enforce</span> <span class="nx">strict</span> <span class="nx">quorum</span> <span class="nx">membership</span> <span class="nx">and</span> <span class="nx">instead</span> <span class="nx">it</span> <span class="nx">uses</span> <span class="nx">a</span> <span class="err">“</span><span class="nx">sloppy</span> <span class="nx">quorum</span><span class="err">”</span><span class="p">;</span> <span class="nx">all</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> 
<span class="nx">operations</span> <span class="nx">are</span> <span class="nx">performed</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">N</span> <span class="nx">healthy</span> <span class="nx">nodes</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">may</span> <span class="nx">not</span> <span class="nx">always</span> <span class="nx">be</span> 
<span class="nx">the</span> <span class="nx">first</span> <span class="nx">N</span> <span class="nx">nodes</span> <span class="nx">encountered</span> <span class="k">while</span> <span class="nx">walking</span> <span class="nx">the</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="nx">ring</span><span class="p">.</span>

<span class="nx">Consider</span> <span class="nx">the</span> <span class="nx">example</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="nx">configuration</span> <span class="nx">given</span> <span class="k">in</span> <span class="nx">Figure</span> <span class="mi">2</span> <span class="kd">with</span> <span class="nx">N</span><span class="o">=</span><span class="mi">3</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">example</span><span class="p">,</span> <span class="k">if</span> <span class="nx">node</span> 
<span class="nx">A</span> <span class="nx">is</span> <span class="nx">temporarily</span> <span class="nx">down</span> <span class="nx">or</span> <span class="nx">unreachable</span> <span class="nx">during</span> <span class="nx">a</span> <span class="nx">write</span> <span class="nx">operation</span> <span class="nx">then</span> <span class="nx">a</span> <span class="nx">replica</span> <span class="nx">that</span> <span class="nx">would</span> <span class="nx">normally</span> 
<span class="nx">have</span> <span class="nx">lived</span> <span class="nx">on</span> <span class="nx">A</span> <span class="nx">will</span> <span class="nx">now</span> <span class="nx">be</span> <span class="nx">sent</span> <span class="nx">to</span> <span class="nx">node</span> <span class="nx">D</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">done</span> <span class="nx">to</span> <span class="nx">maintain</span> <span class="nx">the</span> <span class="nx">desired</span> <span class="nx">availability</span> <span class="nx">and</span> 
<span class="nx">durability</span> <span class="nx">guarantees</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">replica</span> <span class="nx">sent</span> <span class="nx">to</span> <span class="nx">D</span> <span class="nx">will</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">hint</span> <span class="k">in</span> <span class="nx">its</span> <span class="nx">metadata</span> <span class="nx">that</span> <span class="nx">suggests</span> <span class="nx">which</span> 
<span class="nx">node</span> <span class="nx">was</span> <span class="nx">the</span> <span class="nx">intended</span> <span class="nx">recipient</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">replica</span> <span class="p">(</span><span class="k">in</span> <span class="k">this</span> <span class="k">case</span> <span class="nx">A</span><span class="p">).</span> <span class="nx">Nodes</span> <span class="nx">that</span> <span class="nx">receive</span> <span class="nx">hinted</span> <span class="nx">replicas</span>
<span class="nx">will</span> <span class="nx">keep</span> <span class="nx">them</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">separate</span> <span class="nx">local</span> <span class="nx">database</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">scanned</span> <span class="nx">periodically</span><span class="p">.</span> <span class="nx">Upon</span> <span class="nx">detecting</span> <span class="nx">that</span> <span class="nx">A</span> <span class="nx">has</span> 
<span class="nx">recovered</span><span class="p">,</span> <span class="nx">D</span> <span class="nx">will</span> <span class="nx">attempt</span> <span class="nx">to</span> <span class="nx">deliver</span> <span class="nx">the</span> <span class="nx">replica</span> <span class="nx">to</span> <span class="nx">A</span><span class="p">.</span> <span class="nx">Once</span> <span class="nx">the</span> <span class="nx">transfer</span> <span class="nx">succeeds</span><span class="p">,</span> <span class="nx">D</span> <span class="nx">may</span> <span class="k">delete</span> <span class="nx">the</span> 
<span class="nx">object</span> <span class="nx">from</span> <span class="nx">its</span> <span class="nx">local</span> <span class="nx">store</span> <span class="nx">without</span> <span class="nx">decreasing</span> <span class="nx">the</span> <span class="nx">total</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">replicas</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">.</span>

<span class="nx">Using</span> <span class="nx">hinted</span> <span class="nx">handoff</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">ensures</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">operations</span> <span class="nx">are</span> <span class="nx">not</span> <span class="nx">failed</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">temporary</span> 
<span class="nx">node</span> <span class="nx">or</span> <span class="nx">network</span> <span class="nx">failures</span><span class="p">.</span> <span class="nx">Applications</span> <span class="nx">that</span> <span class="nx">need</span> <span class="nx">the</span> <span class="nx">highest</span> <span class="nx">level</span> <span class="nx">of</span> <span class="nx">availability</span> <span class="nx">can</span> <span class="nx">set</span> <span class="nx">W</span> <span class="nx">to</span> <span class="mi">1</span><span class="p">,</span> 
<span class="nx">which</span> <span class="nx">ensures</span> <span class="nx">that</span> <span class="nx">a</span> <span class="nx">write</span> <span class="nx">is</span> <span class="nx">accepted</span> <span class="nx">as</span> <span class="kr">long</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">has</span> <span class="nx">durably</span> <span class="nx">written</span> 
<span class="nx">the</span> <span class="nx">key</span> <span class="nx">it</span> <span class="nx">to</span> <span class="nx">its</span> <span class="nx">local</span> <span class="nx">store</span><span class="p">.</span> <span class="nx">Thus</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">write</span> <span class="nx">request</span> <span class="nx">is</span> <span class="nx">only</span> <span class="nx">rejected</span> <span class="k">if</span> <span class="nx">all</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span> 
<span class="nx">are</span> <span class="nx">unavailable</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="k">in</span> <span class="nx">practice</span><span class="p">,</span> <span class="nx">most</span> <span class="nx">Amazon</span> <span class="nx">services</span> <span class="k">in</span> <span class="nx">production</span> <span class="nx">set</span> <span class="nx">a</span> <span class="nx">higher</span> <span class="nx">W</span> <span class="nx">to</span> <span class="nx">meet</span> 
<span class="nx">the</span> <span class="nx">desired</span> <span class="nx">level</span> <span class="nx">of</span> <span class="nx">durability</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">more</span> <span class="nx">detailed</span> <span class="nx">discussion</span> <span class="nx">of</span> <span class="nx">configuring</span> <span class="nx">N</span><span class="p">,</span> <span class="nx">R</span> <span class="nx">and</span> <span class="nx">W</span> <span class="nx">follows</span> <span class="k">in</span> <span class="nx">section</span> <span class="mi">6</span><span class="p">.</span>

<span class="nx">It</span> <span class="nx">is</span> <span class="nx">imperative</span> <span class="nx">that</span> <span class="nx">a</span> <span class="nx">highly</span> <span class="nx">available</span> <span class="nx">storage</span> <span class="nx">system</span> <span class="nx">be</span> <span class="nx">capable</span> <span class="nx">of</span> <span class="nx">handling</span> <span class="nx">the</span> <span class="nx">failure</span> <span class="nx">of</span> <span class="nx">an</span> 
<span class="nx">entire</span> <span class="nx">data</span> <span class="nx">center</span><span class="p">(</span><span class="nx">s</span><span class="p">).</span> <span class="nx">Data</span> <span class="nx">center</span> <span class="nx">failures</span> <span class="nx">happen</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">power</span> <span class="nx">outages</span><span class="p">,</span> <span class="nx">cooling</span> <span class="nx">failures</span><span class="p">,</span> <span class="nx">network</span> 
<span class="nx">failures</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">natural</span> <span class="nx">disasters</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">configured</span> <span class="nx">such</span> <span class="nx">that</span> <span class="nx">each</span> <span class="nx">object</span> <span class="nx">is</span> <span class="nx">replicated</span> <span class="nx">across</span> 
<span class="nx">multiple</span> <span class="nx">data</span> <span class="nx">centers</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">essence</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">key</span> <span class="nx">is</span> <span class="nx">constructed</span> <span class="nx">such</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">storage</span> 
<span class="nx">nodes</span> <span class="nx">are</span> <span class="nx">spread</span> <span class="nx">across</span> <span class="nx">multiple</span> <span class="nx">data</span> <span class="nx">centers</span><span class="p">.</span> <span class="nx">These</span> <span class="nx">datacenters</span> <span class="nx">are</span> <span class="nx">connected</span> <span class="nx">through</span> <span class="nx">high</span> <span class="nx">speed</span> 
<span class="nx">network</span> <span class="nx">links</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">scheme</span> <span class="nx">of</span> <span class="nx">replicating</span> <span class="nx">across</span> <span class="nx">multiple</span> <span class="nx">datacenters</span> <span class="nx">allows</span> <span class="nx">us</span> <span class="nx">to</span> <span class="nx">handle</span> <span class="nx">entire</span> <span class="nx">data</span> 
<span class="nx">center</span> <span class="nx">failures</span> <span class="nx">without</span> <span class="nx">a</span> <span class="nx">data</span> <span class="nx">outage</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>All of this</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">4.7</span> <span class="nx">Handling</span> <span class="nx">permanent</span> <span class="nx">failures</span><span class="o">:</span> <span class="nx">Replica</span> <span class="nx">synchronization</span>

<span class="nx">Hinted</span> <span class="nx">handoff</span> <span class="nx">works</span> <span class="nx">best</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">membership</span> <span class="nx">churn</span> <span class="nx">is</span> <span class="nx">low</span> <span class="nx">and</span> <span class="nx">node</span> <span class="nx">failures</span> <span class="nx">are</span> <span class="kr">transient</span><span class="p">.</span> 
<span class="nx">There</span> <span class="nx">are</span> <span class="nx">scenarios</span> <span class="nx">under</span> <span class="nx">which</span> <span class="nx">hinted</span> <span class="nx">replicas</span> <span class="nx">become</span> <span class="nx">unavailable</span> <span class="nx">before</span> <span class="nx">they</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">returned</span> <span class="nx">to</span> 
<span class="nx">the</span> <span class="nx">original</span> <span class="nx">replica</span> <span class="nx">node</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">handle</span> <span class="k">this</span> <span class="nx">and</span> <span class="nx">other</span> <span class="nx">threats</span> <span class="nx">to</span> <span class="nx">durability</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="kr">implements</span> <span class="nx">an</span> 
<span class="nx">anti</span><span class="o">-</span><span class="nx">entropy</span> <span class="p">(</span><span class="nx">replica</span> <span class="nx">synchronization</span><span class="p">)</span> <span class="nx">protocol</span> <span class="nx">to</span> <span class="nx">keep</span> <span class="nx">the</span> <span class="nx">replicas</span> <span class="kr">synchronized</span><span class="p">.</span>

<span class="nx">To</span> <span class="nx">detect</span> <span class="nx">the</span> <span class="nx">inconsistencies</span> <span class="nx">between</span> <span class="nx">replicas</span> <span class="nx">faster</span> <span class="nx">and</span> <span class="nx">to</span> <span class="nx">minimize</span> <span class="nx">the</span> <span class="nx">amount</span> <span class="nx">of</span> <span class="nx">transferred</span> <span class="nx">data</span><span class="p">,</span> 
<span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">Merkle</span> <span class="nx">trees</span> <span class="p">[</span><span class="mi">13</span><span class="p">].</span> <span class="nx">A</span> <span class="nx">Merkle</span> <span class="nx">tree</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">hash</span> <span class="nx">tree</span> <span class="nx">where</span> <span class="nx">leaves</span> <span class="nx">are</span> <span class="nx">hashes</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">values</span> <span class="nx">of</span> 
<span class="nx">individual</span> <span class="nx">keys</span><span class="p">.</span> <span class="nx">Parent</span> <span class="nx">nodes</span> <span class="nx">higher</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">tree</span> <span class="nx">are</span> <span class="nx">hashes</span> <span class="nx">of</span> <span class="nx">their</span> <span class="nx">respective</span> <span class="nx">children</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">principal</span> 
<span class="nx">advantage</span> <span class="nx">of</span> <span class="nx">Merkle</span> <span class="nx">tree</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">each</span> <span class="nx">branch</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">tree</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">checked</span> <span class="nx">independently</span> <span class="nx">without</span> <span class="nx">requiring</span> 
<span class="nx">nodes</span> <span class="nx">to</span> <span class="nx">download</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nx">tree</span> <span class="nx">or</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nx">data</span> <span class="nx">set</span><span class="p">.</span> <span class="nx">Moreover</span><span class="p">,</span> <span class="nx">Merkle</span> <span class="nx">trees</span> <span class="nx">help</span> <span class="k">in</span> <span class="nx">reducing</span> <span class="nx">the</span> 
<span class="nx">amount</span> <span class="nx">of</span> <span class="nx">data</span> <span class="nx">that</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">transferred</span> <span class="k">while</span> <span class="nx">checking</span> <span class="k">for</span> <span class="nx">inconsistencies</span> <span class="nx">among</span> <span class="nx">replicas</span><span class="p">.</span> <span class="nx">For</span> 
<span class="nx">instance</span><span class="p">,</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">hash</span> <span class="nx">values</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">root</span> <span class="nx">of</span> <span class="nx">two</span> <span class="nx">trees</span> <span class="nx">are</span> <span class="nx">equal</span><span class="p">,</span> <span class="nx">then</span> <span class="nx">the</span> <span class="nx">values</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">leaf</span> <span class="nx">nodes</span> 
<span class="k">in</span> <span class="nx">the</span> <span class="nx">tree</span> <span class="nx">are</span> <span class="nx">equal</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="nx">require</span> <span class="nx">no</span> <span class="nx">synchronization</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">not</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">implies</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">values</span> 
<span class="nx">of</span> <span class="nx">some</span> <span class="nx">replicas</span> <span class="nx">are</span> <span class="nx">different</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">such</span> <span class="nx">cases</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="nx">may</span> <span class="nx">exchange</span> <span class="nx">the</span> <span class="nx">hash</span> <span class="nx">values</span> <span class="nx">of</span> <span class="nx">children</span> <span class="nx">and</span> 
<span class="nx">the</span> <span class="nx">process</span> <span class="nx">continues</span> <span class="nx">until</span> <span class="nx">it</span> <span class="nx">reaches</span> <span class="nx">the</span> <span class="nx">leaves</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">trees</span><span class="p">,</span> <span class="nx">at</span> <span class="nx">which</span> <span class="nx">point</span> <span class="nx">the</span> <span class="nx">hosts</span> <span class="nx">can</span> <span class="nx">identify</span> 
<span class="nx">the</span> <span class="nx">keys</span> <span class="nx">that</span> <span class="nx">are</span> <span class="err">“</span><span class="nx">out</span> <span class="nx">of</span> <span class="nx">sync</span><span class="err">”</span><span class="p">.</span> <span class="nx">Merkle</span> <span class="nx">trees</span> <span class="nx">minimize</span> <span class="nx">the</span> <span class="nx">amount</span> <span class="nx">of</span> <span class="nx">data</span> <span class="nx">that</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">transferred</span> 
<span class="k">for</span> <span class="nx">synchronization</span> <span class="nx">and</span> <span class="nx">reduce</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">disk</span> <span class="nx">reads</span> <span class="nx">performed</span> <span class="nx">during</span> <span class="nx">the</span> <span class="nx">anti</span><span class="o">-</span><span class="nx">entropy</span> <span class="nx">process</span><span class="p">.</span>

<span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">Merkle</span> <span class="nx">trees</span> <span class="k">for</span> <span class="nx">anti</span><span class="o">-</span><span class="nx">entropy</span> <span class="nx">as</span> <span class="nx">follows</span><span class="o">:</span> <span class="nx">Each</span> <span class="nx">node</span> <span class="nx">maintains</span> <span class="nx">a</span> <span class="nx">separate</span> <span class="nx">Merkle</span> <span class="nx">tree</span> 
<span class="k">for</span> <span class="nx">each</span> <span class="nx">key</span> <span class="nx">range</span> <span class="p">(</span><span class="nx">the</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">keys</span> <span class="nx">covered</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">virtual</span> <span class="nx">node</span><span class="p">)</span> <span class="nx">it</span> <span class="nx">hosts</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">allows</span> <span class="nx">nodes</span> <span class="nx">to</span> <span class="nx">compare</span> 
<span class="nx">whether</span> <span class="nx">the</span> <span class="nx">keys</span> <span class="nx">within</span> <span class="nx">a</span> <span class="nx">key</span> <span class="nx">range</span> <span class="nx">are</span> <span class="nx">up</span><span class="o">-</span><span class="nx">to</span><span class="o">-</span><span class="nx">date</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">scheme</span><span class="p">,</span> <span class="nx">two</span> <span class="nx">nodes</span> <span class="nx">exchange</span> <span class="nx">the</span> <span class="nx">root</span> <span class="nx">of</span> 
<span class="nx">the</span> <span class="nx">Merkle</span> <span class="nx">tree</span> <span class="nx">corresponding</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">ranges</span> <span class="nx">that</span> <span class="nx">they</span> <span class="nx">host</span> <span class="k">in</span> <span class="nx">common</span><span class="p">.</span> <span class="nx">Subsequently</span><span class="p">,</span> <span class="nx">using</span> <span class="nx">the</span> 
<span class="nx">tree</span> <span class="nx">traversal</span> <span class="nx">scheme</span> <span class="nx">described</span> <span class="nx">above</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="nx">determine</span> <span class="k">if</span> <span class="nx">they</span> <span class="nx">have</span> <span class="nx">any</span> <span class="nx">differences</span> <span class="nx">and</span> <span class="nx">perform</span> 
<span class="nx">the</span> <span class="nx">appropriate</span> <span class="nx">synchronization</span> <span class="nx">action</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">disadvantage</span> <span class="kd">with</span> <span class="k">this</span> <span class="nx">scheme</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">many</span> <span class="nx">key</span> <span class="nx">ranges</span> 
<span class="nx">change</span> <span class="nx">when</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">joins</span> <span class="nx">or</span> <span class="nx">leaves</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">thereby</span> <span class="nx">requiring</span> <span class="nx">the</span> <span class="nx">tree</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">recalculated</span><span class="p">.</span> 
<span class="nx">This</span> <span class="nx">issue</span> <span class="nx">is</span> <span class="nx">addressed</span><span class="p">,</span> <span class="nx">however</span><span class="p">,</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">refined</span> <span class="nx">partitioning</span> <span class="nx">scheme</span> <span class="nx">described</span> <span class="k">in</span> <span class="nx">Section</span> <span class="mf">6.2</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>All of 4.8</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">4.8</span> <span class="nx">Membership</span> <span class="nx">and</span> <span class="nx">Failure</span> <span class="nx">Detection</span>

<span class="mf">4.8</span><span class="p">.</span><span class="mi">1</span> <span class="nx">Ring</span> <span class="nx">Membership</span>

<span class="nx">In</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">environment</span> <span class="nx">node</span> <span class="nx">outages</span> <span class="p">(</span><span class="nx">due</span> <span class="nx">to</span> <span class="nx">failures</span> <span class="nx">and</span> <span class="nx">maintenance</span> <span class="nx">tasks</span><span class="p">)</span> <span class="nx">are</span> <span class="nx">often</span> <span class="kr">transient</span> <span class="nx">but</span> <span class="nx">may</span> 
<span class="nx">last</span> <span class="k">for</span> <span class="nx">extended</span> <span class="nx">intervals</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">node</span> <span class="nx">outage</span> <span class="nx">rarely</span> <span class="nx">signifies</span> <span class="nx">a</span> <span class="nx">permanent</span> <span class="nx">departure</span> <span class="nx">and</span> <span class="nx">therefore</span> <span class="nx">should</span> 
<span class="nx">not</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">rebalancing</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">partition</span> <span class="nx">assignment</span> <span class="nx">or</span> <span class="nx">repair</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">unreachable</span> <span class="nx">replicas</span><span class="p">.</span> <span class="nx">Similarly</span><span class="p">,</span> 
<span class="nx">manual</span> <span class="nx">error</span> <span class="nx">could</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">unintentional</span> <span class="nx">startup</span> <span class="nx">of</span> <span class="k">new</span> <span class="nx">Dynamo</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">these</span> <span class="nx">reasons</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">was</span> 
<span class="nx">deemed</span> <span class="nx">appropriate</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">an</span> <span class="nx">explicit</span> <span class="nx">mechanism</span> <span class="nx">to</span> <span class="nx">initiate</span> <span class="nx">the</span> <span class="nx">addition</span> <span class="nx">and</span> <span class="nx">removal</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">from</span> <span class="nx">a</span> 
<span class="nx">Dynamo</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">An</span> <span class="nx">administrator</span> <span class="nx">uses</span> <span class="nx">a</span> <span class="nx">command</span> <span class="nx">line</span> <span class="nx">tool</span> <span class="nx">or</span> <span class="nx">a</span> <span class="nx">browser</span> <span class="nx">to</span> <span class="nx">connect</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">Dynamo</span> <span class="nx">node</span> <span class="nx">and</span> 
<span class="nx">issue</span> <span class="nx">a</span> <span class="nx">membership</span> <span class="nx">change</span> <span class="nx">to</span> <span class="nx">join</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">ring</span> <span class="nx">or</span> <span class="nx">remove</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">node</span> <span class="nx">that</span> <span class="nx">serves</span> 
<span class="nx">the</span> <span class="nx">request</span> <span class="nx">writes</span> <span class="nx">the</span> <span class="nx">membership</span> <span class="nx">change</span> <span class="nx">and</span> <span class="nx">its</span> <span class="nx">time</span> <span class="nx">of</span> <span class="nx">issue</span> <span class="nx">to</span> <span class="nx">persistent</span> <span class="nx">store</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">membership</span> 
<span class="nx">changes</span> <span class="nx">form</span> <span class="nx">a</span> <span class="nx">history</span> <span class="nx">because</span> <span class="nx">nodes</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">removed</span> <span class="nx">and</span> <span class="nx">added</span> <span class="nx">back</span> <span class="nx">multiple</span> <span class="nx">times</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">gossip</span><span class="o">-</span><span class="nx">based</span> <span class="nx">protocol</span> 
<span class="nx">propagates</span> <span class="nx">membership</span> <span class="nx">changes</span> <span class="nx">and</span> <span class="nx">maintains</span> <span class="nx">an</span> <span class="nx">eventually</span> <span class="nx">consistent</span> <span class="nx">view</span> <span class="nx">of</span> <span class="nx">membership</span><span class="p">.</span> <span class="nx">Each</span> <span class="nx">node</span> 
<span class="nx">contacts</span> <span class="nx">a</span> <span class="nx">peer</span> <span class="nx">chosen</span> <span class="nx">at</span> <span class="nx">random</span> <span class="nx">every</span> <span class="nx">second</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">two</span> <span class="nx">nodes</span> <span class="nx">efficiently</span> <span class="nx">reconcile</span> <span class="nx">their</span> <span class="nx">persisted</span> 
<span class="nx">membership</span> <span class="nx">change</span> <span class="nx">histories</span><span class="p">.</span>

<span class="nx">When</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">starts</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">time</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">chooses</span> <span class="nx">its</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">tokens</span> <span class="p">(</span><span class="nx">virtual</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">consistent</span> 
<span class="nx">hash</span> <span class="nx">space</span><span class="p">)</span> <span class="nx">and</span> <span class="nx">maps</span> <span class="nx">nodes</span> <span class="nx">to</span> <span class="nx">their</span> <span class="nx">respective</span> <span class="nx">token</span> <span class="nx">sets</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">mapping</span> <span class="nx">is</span> <span class="nx">persisted</span> <span class="nx">on</span> <span class="nx">disk</span> <span class="nx">and</span> <span class="nx">initially</span> 
<span class="nx">contains</span> <span class="nx">only</span> <span class="nx">the</span> <span class="nx">local</span> <span class="nx">node</span> <span class="nx">and</span> <span class="nx">token</span> <span class="nx">set</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">mappings</span> <span class="nx">stored</span> <span class="nx">at</span> <span class="nx">different</span> <span class="nx">Dynamo</span> <span class="nx">nodes</span> <span class="nx">are</span> <span class="nx">reconciled</span> 
<span class="nx">during</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">communication</span> <span class="nx">exchange</span> <span class="nx">that</span> <span class="nx">reconciles</span> <span class="nx">the</span> <span class="nx">membership</span> <span class="nx">change</span> <span class="nx">histories</span><span class="p">.</span> <span class="nx">Therefore</span><span class="p">,</span> 
<span class="nx">partitioning</span> <span class="nx">and</span> <span class="nx">placement</span> <span class="nx">information</span> <span class="nx">also</span> <span class="nx">propagates</span> <span class="nx">via</span> <span class="nx">the</span> <span class="nx">gossip</span><span class="o">-</span><span class="nx">based</span> <span class="nx">protocol</span> <span class="nx">and</span> <span class="nx">each</span> <span class="nx">storage</span> 
<span class="nx">node</span> <span class="nx">is</span> <span class="nx">aware</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">token</span> <span class="nx">ranges</span> <span class="nx">handled</span> <span class="nx">by</span> <span class="nx">its</span> <span class="nx">peers</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">allows</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">to</span> <span class="nx">forward</span> <span class="nx">a</span> <span class="nx">key</span><span class="err">’</span><span class="nx">s</span> <span class="nx">read</span><span class="o">/</span><span class="nx">write</span> 
<span class="nx">operations</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">right</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">directly</span><span class="p">.</span>

<span class="mf">4.8</span><span class="p">.</span><span class="mi">2</span> <span class="nx">External</span> <span class="nx">Discovery</span>

<span class="nx">The</span> <span class="nx">mechanism</span> <span class="nx">described</span> <span class="nx">above</span> <span class="nx">could</span> <span class="nx">temporarily</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">logically</span> <span class="nx">partitioned</span> <span class="nx">Dynamo</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">For</span> 
<span class="nx">example</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">administrator</span> <span class="nx">could</span> <span class="nx">contact</span> <span class="nx">node</span> <span class="nx">A</span> <span class="nx">to</span> <span class="nx">join</span> <span class="nx">A</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">,</span> <span class="nx">then</span> <span class="nx">contact</span> <span class="nx">node</span> <span class="nx">B</span> <span class="nx">to</span> <span class="nx">join</span> 
<span class="nx">B</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">scenario</span><span class="p">,</span> <span class="nx">nodes</span> <span class="nx">A</span> <span class="nx">and</span> <span class="nx">B</span> <span class="nx">would</span> <span class="nx">each</span> <span class="nx">consider</span> <span class="nx">itself</span> <span class="nx">a</span> <span class="nx">member</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">,</span> <span class="nx">yet</span> 
<span class="nx">neither</span> <span class="nx">would</span> <span class="nx">be</span> <span class="nx">immediately</span> <span class="nx">aware</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">other</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">prevent</span> <span class="nx">logical</span> <span class="nx">partitions</span><span class="p">,</span> <span class="nx">some</span> <span class="nx">Dynamo</span> <span class="nx">nodes</span> <span class="nx">play</span> 
<span class="nx">the</span> <span class="nx">role</span> <span class="nx">of</span> <span class="nx">seeds</span><span class="p">.</span> <span class="nx">Seeds</span> <span class="nx">are</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">discovered</span> <span class="nx">via</span> <span class="nx">an</span> <span class="nx">external</span> <span class="nx">mechanism</span> <span class="nx">and</span> <span class="nx">are</span> <span class="nx">known</span> <span class="nx">to</span> <span class="nx">all</span> 
<span class="nx">nodes</span><span class="p">.</span> <span class="nx">Because</span> <span class="nx">all</span> <span class="nx">nodes</span> <span class="nx">eventually</span> <span class="nx">reconcile</span> <span class="nx">their</span> <span class="nx">membership</span> <span class="kd">with</span> <span class="nx">a</span> <span class="nx">seed</span><span class="p">,</span> <span class="nx">logical</span> <span class="nx">partitions</span> <span class="nx">are</span> 
<span class="nx">highly</span> <span class="nx">unlikely</span><span class="p">.</span> <span class="nx">Seeds</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">obtained</span> <span class="nx">either</span> <span class="nx">from</span> <span class="kr">static</span> <span class="nx">configuration</span> <span class="nx">or</span> <span class="nx">from</span> <span class="nx">a</span> <span class="nx">configuration</span> 
<span class="nx">service</span><span class="p">.</span> <span class="nx">Typically</span> <span class="nx">seeds</span> <span class="nx">are</span> <span class="nx">fully</span> <span class="nx">functional</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">Dynamo</span> <span class="nx">ring</span><span class="p">.</span>

<span class="mf">4.8</span><span class="p">.</span><span class="mi">3</span> <span class="nx">Failure</span> <span class="nx">Detection</span>

<span class="nx">Failure</span> <span class="nx">detection</span> <span class="k">in</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">used</span> <span class="nx">to</span> <span class="nx">avoid</span> <span class="nx">attempts</span> <span class="nx">to</span> <span class="nx">communicate</span> <span class="kd">with</span> <span class="nx">unreachable</span> <span class="nx">peers</span> <span class="nx">during</span> 
<span class="nx">get</span><span class="p">()</span> <span class="nx">and</span> <span class="nx">put</span><span class="p">()</span> <span class="nx">operations</span> <span class="nx">and</span> <span class="nx">when</span> <span class="nx">transferring</span> <span class="nx">partitions</span> <span class="nx">and</span> <span class="nx">hinted</span> <span class="nx">replicas</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">the</span> <span class="nx">purpose</span> <span class="nx">of</span> 
<span class="nx">avoiding</span> <span class="nx">failed</span> <span class="nx">attempts</span> <span class="nx">at</span> <span class="nx">communication</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">purely</span> <span class="nx">local</span> <span class="nx">notion</span> <span class="nx">of</span> <span class="nx">failure</span> <span class="nx">detection</span> <span class="nx">is</span> <span class="nx">entirely</span> 
<span class="nx">sufficient</span><span class="o">:</span> <span class="nx">node</span> <span class="nx">A</span> <span class="nx">may</span> <span class="nx">consider</span> <span class="nx">node</span> <span class="nx">B</span> <span class="nx">failed</span> <span class="k">if</span> <span class="nx">node</span> <span class="nx">B</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">respond</span> <span class="nx">to</span> <span class="nx">node</span> <span class="nx">A</span><span class="err">’</span><span class="nx">s</span> <span class="nx">messages</span> <span class="p">(</span><span class="nx">even</span> 
<span class="k">if</span> <span class="nx">B</span> <span class="nx">is</span> <span class="nx">responsive</span> <span class="nx">to</span> <span class="nx">node</span> <span class="nx">C</span><span class="o">*</span><span class="nx">s</span> <span class="nx">messages</span><span class="p">).</span> <span class="nx">In</span> <span class="nx">the</span> <span class="nx">presence</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">steady</span> <span class="nx">rate</span> <span class="nx">of</span> <span class="nx">client</span> <span class="nx">requests</span> <span class="nx">generating</span> 
<span class="nx">inter</span><span class="o">-</span><span class="nx">node</span> <span class="nx">communication</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">Dynamo</span> <span class="nx">ring</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">A</span> <span class="nx">quickly</span> <span class="nx">discovers</span> <span class="nx">that</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">B</span> <span class="nx">is</span> <span class="nx">unresponsive</span> 
<span class="nx">when</span> <span class="nx">B</span> <span class="nx">fails</span> <span class="nx">to</span> <span class="nx">respond</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">message</span><span class="p">;</span> <span class="nx">Node</span> <span class="nx">A</span> <span class="nx">then</span> <span class="nx">uses</span> <span class="nx">alternate</span> <span class="nx">nodes</span> <span class="nx">to</span> <span class="nx">service</span> <span class="nx">requests</span> <span class="nx">that</span> <span class="nx">map</span> <span class="nx">to</span> 
<span class="nx">B</span><span class="s1">&#39;s partitions; A periodically retries B to check for the latter&#39;</span><span class="nx">s</span> <span class="nx">recovery</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">the</span> <span class="nx">absence</span> <span class="nx">of</span> <span class="nx">client</span> 
<span class="nx">requests</span> <span class="nx">to</span> <span class="nx">drive</span> <span class="nx">traffic</span> <span class="nx">between</span> <span class="nx">two</span> <span class="nx">nodes</span><span class="p">,</span> <span class="nx">neither</span> <span class="nx">node</span> <span class="nx">really</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">know</span> <span class="nx">whether</span> <span class="nx">the</span> <span class="nx">other</span> <span class="nx">is</span> 
<span class="nx">reachable</span> <span class="nx">and</span> <span class="nx">responsive</span><span class="p">.</span>

<span class="nx">Decentralized</span> <span class="nx">failure</span> <span class="nx">detection</span> <span class="nx">protocols</span> <span class="nx">use</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">gossip</span><span class="o">-</span><span class="nx">style</span> <span class="nx">protocol</span> <span class="nx">that</span> <span class="nx">enable</span> <span class="nx">each</span> <span class="nx">node</span> 
<span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">to</span> <span class="nx">learn</span> <span class="nx">about</span> <span class="nx">the</span> <span class="nx">arrival</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">departure</span><span class="p">)</span> <span class="nx">of</span> <span class="nx">other</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">detailed</span> <span class="nx">information</span> <span class="nx">on</span> 
<span class="nx">decentralized</span> <span class="nx">failure</span> <span class="nx">detectors</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">parameters</span> <span class="nx">affecting</span> <span class="nx">their</span> <span class="nx">accuracy</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">interested</span> <span class="nx">reader</span> 
<span class="nx">is</span> <span class="nx">referred</span> <span class="nx">to</span> <span class="p">[</span><span class="mi">8</span><span class="p">].</span> <span class="nx">Early</span> <span class="nx">designs</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="nx">used</span> <span class="nx">a</span> <span class="nx">decentralized</span> <span class="nx">failure</span> <span class="nx">detector</span> <span class="nx">to</span> <span class="nx">maintain</span> <span class="nx">a</span> <span class="nx">globally</span> 
<span class="nx">consistent</span> <span class="nx">view</span> <span class="nx">of</span> <span class="nx">failure</span> <span class="nx">state</span><span class="p">.</span> <span class="nx">Later</span> <span class="nx">it</span> <span class="nx">was</span> <span class="nx">determined</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">explicit</span> <span class="nx">node</span> <span class="nx">join</span> <span class="nx">and</span> <span class="nx">leave</span> <span class="nx">methods</span> 
<span class="nx">obviates</span> <span class="nx">the</span> <span class="nx">need</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">global</span> <span class="nx">view</span> <span class="nx">of</span> <span class="nx">failure</span> <span class="nx">state</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">because</span> <span class="nx">nodes</span> <span class="nx">are</span> <span class="nx">notified</span> <span class="nx">of</span> <span class="nx">permanent</span> 
<span class="nx">node</span> <span class="nx">additions</span> <span class="nx">and</span> <span class="nx">removals</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">explicit</span> <span class="nx">node</span> <span class="nx">join</span> <span class="nx">and</span> <span class="nx">leave</span> <span class="nx">methods</span> <span class="nx">and</span> <span class="nx">temporary</span> <span class="nx">node</span> <span class="nx">failures</span> <span class="nx">are</span> 
<span class="nx">detected</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">individual</span> <span class="nx">nodes</span> <span class="nx">when</span> <span class="nx">they</span> <span class="nx">fail</span> <span class="nx">to</span> <span class="nx">communicate</span> <span class="kd">with</span> <span class="nx">others</span> <span class="p">(</span><span class="k">while</span> <span class="nx">forwarding</span> <span class="nx">requests</span><span class="p">).</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Annoate all of 4.9 </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">4.9</span> <span class="nx">Adding</span><span class="o">/</span><span class="nx">Removing</span> <span class="nx">Storage</span> <span class="nx">Nodes</span>

<span class="nx">When</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">node</span> <span class="p">(</span><span class="nx">say</span> <span class="nx">X</span><span class="p">)</span> <span class="nx">is</span> <span class="nx">added</span> <span class="nx">into</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">gets</span> <span class="nx">assigned</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">tokens</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">randomly</span> 
<span class="nx">scattered</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">ring</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">every</span> <span class="nx">key</span> <span class="nx">range</span> <span class="nx">that</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">to</span> <span class="nx">node</span> <span class="nx">X</span><span class="p">,</span> <span class="nx">there</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">nodes</span> 
<span class="p">(</span><span class="nx">less</span> <span class="nx">than</span> <span class="nx">or</span> <span class="nx">equal</span> <span class="nx">to</span> <span class="nx">N</span><span class="p">)</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">currently</span> <span class="k">in</span> <span class="nx">charge</span> <span class="nx">of</span> <span class="nx">handling</span> <span class="nx">keys</span> <span class="nx">that</span> <span class="nx">fall</span> <span class="nx">within</span> <span class="nx">its</span> <span class="nx">token</span> <span class="nx">range</span><span class="p">.</span> 
<span class="nx">Due</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">allocation</span> <span class="nx">of</span> <span class="nx">key</span> <span class="nx">ranges</span> <span class="nx">to</span> <span class="nx">X</span><span class="p">,</span> <span class="nx">some</span> <span class="nx">existing</span> <span class="nx">nodes</span> <span class="nx">no</span> <span class="nx">longer</span> <span class="nx">have</span> <span class="nx">to</span> <span class="nx">some</span> <span class="nx">of</span> <span class="nx">their</span> <span class="nx">keys</span> <span class="nx">and</span> 
<span class="nx">these</span> <span class="nx">nodes</span> <span class="nx">transfer</span> <span class="nx">those</span> <span class="nx">keys</span> <span class="nx">to</span> <span class="nx">X</span><span class="p">.</span> <span class="nx">Let</span> <span class="nx">us</span> <span class="nx">consider</span> <span class="nx">a</span> <span class="nx">simple</span> <span class="nx">bootstrapping</span> <span class="nx">scenario</span> <span class="nx">where</span> <span class="nx">node</span> <span class="nx">X</span> <span class="nx">is</span> 
<span class="nx">added</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">ring</span> <span class="nx">shown</span> <span class="k">in</span> <span class="nx">Figure</span> <span class="mi">2</span> <span class="nx">between</span> <span class="nx">A</span> <span class="nx">and</span> <span class="nx">B</span><span class="p">.</span> <span class="nx">When</span> <span class="nx">X</span> <span class="nx">is</span> <span class="nx">added</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="k">in</span> <span class="nx">charge</span> <span class="nx">of</span> 
<span class="nx">storing</span> <span class="nx">keys</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">ranges</span> <span class="p">(</span><span class="nx">F</span><span class="p">,</span> <span class="nx">G</span><span class="p">],</span> <span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">A</span><span class="p">]</span> <span class="nx">and</span> <span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">X</span><span class="p">].</span> <span class="nx">As</span> <span class="nx">a</span> <span class="nx">consequence</span><span class="p">,</span> <span class="nx">nodes</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span> <span class="nx">and</span> <span class="nx">D</span> <span class="nx">no</span> <span class="nx">longer</span> <span class="nx">have</span> 
<span class="nx">to</span> <span class="nx">store</span> <span class="nx">the</span> <span class="nx">keys</span> <span class="k">in</span> <span class="nx">these</span> <span class="nx">respective</span> <span class="nx">ranges</span><span class="p">.</span> <span class="nx">Therefore</span><span class="p">,</span> <span class="nx">nodes</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">D</span> <span class="nx">will</span> <span class="nx">offer</span> <span class="nx">to</span> <span class="nx">and</span> <span class="nx">upon</span> <span class="nx">confirmation</span> 
<span class="nx">from</span> <span class="nx">X</span> <span class="nx">transfer</span> <span class="nx">the</span> <span class="nx">appropriate</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">keys</span><span class="p">.</span> <span class="nx">When</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">removed</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">reallocation</span> <span class="nx">of</span> 
<span class="nx">keys</span> <span class="nx">happens</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">reverse</span> <span class="nx">process</span><span class="p">.</span>

<span class="nx">Operational</span> <span class="nx">experience</span> <span class="nx">has</span> <span class="nx">shown</span> <span class="nx">that</span> <span class="k">this</span> <span class="nx">approach</span> <span class="nx">distributes</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">of</span> <span class="nx">key</span> <span class="nx">distribution</span> <span class="nx">uniformly</span> 
<span class="nx">across</span> <span class="nx">the</span> <span class="nx">storage</span> <span class="nx">nodes</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">is</span> <span class="nx">important</span> <span class="nx">to</span> <span class="nx">meet</span> <span class="nx">the</span> <span class="nx">latency</span> <span class="nx">requirements</span> <span class="nx">and</span> <span class="nx">to</span> <span class="nx">ensure</span> <span class="nx">fast</span> 
<span class="nx">bootstrapping</span><span class="p">.</span> <span class="nx">Finally</span><span class="p">,</span> <span class="nx">by</span> <span class="nx">adding</span> <span class="nx">a</span> <span class="nx">confirmation</span> <span class="nx">round</span> <span class="nx">between</span> <span class="nx">the</span> <span class="nx">source</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">destination</span><span class="p">,</span> <span class="nx">it</span> 
<span class="nx">is</span> <span class="nx">made</span> <span class="nx">sure</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">destination</span> <span class="nx">node</span> <span class="nx">does</span> <span class="nx">not</span> <span class="nx">receive</span> <span class="nx">any</span> <span class="nx">duplicate</span> <span class="nx">transfers</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">given</span> <span class="nx">key</span> <span class="nx">range</span><span class="p">.</span>

<span class="mi">5</span><span class="p">.</span><span class="nx">Implementation</span>

<span class="nx">In</span> <span class="nx">Dynamo</span><span class="p">,</span> <span class="nx">each</span> <span class="nx">storage</span> <span class="nx">node</span> <span class="nx">has</span> <span class="nx">three</span> <span class="nx">main</span> <span class="nx">software</span> <span class="nx">components</span><span class="o">:</span> <span class="nx">request</span> <span class="nx">coordination</span><span class="p">,</span> <span class="nx">membership</span> <span class="nx">and</span> 
<span class="nx">failure</span> <span class="nx">detection</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">a</span> <span class="nx">local</span> <span class="nx">persistence</span> <span class="nx">engine</span><span class="p">.</span> <span class="nx">All</span> <span class="nx">these</span> <span class="nx">components</span> <span class="nx">are</span> <span class="nx">implemented</span> <span class="k">in</span> <span class="nx">Java</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>We use Bitcask as default and also offer x, y and z.</p>

<p>Why do we use these? pros, cons</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">local</span> <span class="nx">persistence</span> <span class="nx">component</span> <span class="nx">allows</span> <span class="k">for</span> <span class="nx">different</span> <span class="nx">storage</span> <span class="nx">engines</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">plugged</span> <span class="k">in</span><span class="p">.</span> 
<span class="nx">Engines</span> <span class="nx">that</span> <span class="nx">are</span> <span class="k">in</span> <span class="nx">use</span> <span class="nx">are</span> <span class="nx">Berkeley</span> <span class="nx">Database</span> <span class="p">(</span><span class="nx">BDB</span><span class="p">)</span> <span class="nx">Transactional</span> <span class="nx">Data</span> <span class="nx">Store</span><span class="p">,</span> <span class="nx">BDB</span> <span class="nx">Java</span> <span class="nx">Edition</span><span class="p">,</span> 
<span class="nx">MySQL</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">an</span> <span class="k">in</span><span class="o">-</span><span class="nx">memory</span> <span class="nx">buffer</span> <span class="kd">with</span> <span class="nx">persistent</span> <span class="nx">backing</span> <span class="nx">store</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">main</span> <span class="nx">reason</span> <span class="k">for</span> <span class="nx">designing</span> <span class="nx">a</span> 
<span class="nx">pluggable</span> <span class="nx">persistence</span> <span class="nx">component</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">choose</span> <span class="nx">the</span> <span class="nx">storage</span> <span class="nx">engine</span> <span class="nx">best</span> <span class="nx">suited</span> <span class="k">for</span> <span class="nx">an</span> <span class="nx">application</span><span class="err">’</span><span class="nx">s</span> 
<span class="nx">access</span> <span class="nx">patterns</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">BDB</span> <span class="nx">can</span> <span class="nx">handle</span> <span class="nx">objects</span> <span class="nx">typically</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">order</span> <span class="nx">of</span> <span class="nx">tens</span> <span class="nx">of</span> <span class="nx">kilobytes</span> 
<span class="nx">whereas</span> <span class="nx">MySQL</span> <span class="nx">can</span> <span class="nx">handle</span> <span class="nx">objects</span> <span class="nx">of</span> <span class="nx">larger</span> <span class="nx">sizes</span><span class="p">.</span> <span class="nx">Applications</span> <span class="nx">choose</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">local</span> <span class="nx">persistence</span> 
<span class="nx">engine</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">their</span> <span class="nx">object</span> <span class="nx">size</span> <span class="nx">distribution</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">majority</span> <span class="nx">of</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">production</span> <span class="nx">instances</span> <span class="nx">use</span> 
<span class="nx">BDB</span> <span class="nx">Transactional</span> <span class="nx">Data</span> <span class="nx">Store</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">request</span> <span class="nx">coordination</span> <span class="nx">component</span> <span class="nx">is</span> <span class="nx">built</span> <span class="nx">on</span> <span class="nx">top</span> <span class="nx">of</span> <span class="nx">an</span> <span class="nx">event</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">messaging</span> <span class="nx">substrate</span> <span class="nx">where</span> <span class="nx">the</span> 
<span class="nx">message</span> <span class="nx">processing</span> <span class="nx">pipeline</span> <span class="nx">is</span> <span class="nx">split</span> <span class="nx">into</span> <span class="nx">multiple</span> <span class="nx">stages</span> <span class="nx">similar</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">SEDA</span> <span class="nx">architecture</span> <span class="p">[</span><span class="mi">24</span><span class="p">].</span> <span class="nx">All</span> 
<span class="nx">communications</span> <span class="nx">are</span> <span class="nx">implemented</span> <span class="nx">using</span> <span class="nx">Java</span> <span class="nx">NIO</span> <span class="nx">channels</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">coordinator</span> <span class="nx">executes</span> <span class="nx">the</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> 
<span class="nx">requests</span> <span class="nx">on</span> <span class="nx">behalf</span> <span class="nx">of</span> <span class="nx">clients</span> <span class="nx">by</span> <span class="nx">collecting</span> <span class="nx">data</span> <span class="nx">from</span> <span class="nx">one</span> <span class="nx">or</span> <span class="nx">more</span> <span class="nx">nodes</span> <span class="p">(</span><span class="k">in</span> <span class="nx">the</span> <span class="k">case</span> <span class="nx">of</span> <span class="nx">reads</span><span class="p">)</span> <span class="nx">or</span> 
<span class="nx">storing</span> <span class="nx">data</span> <span class="nx">at</span> <span class="nx">one</span> <span class="nx">or</span> <span class="nx">more</span> <span class="nx">nodes</span> <span class="p">(</span><span class="k">for</span> <span class="nx">writes</span><span class="p">).</span> <span class="nx">Each</span> <span class="nx">client</span> <span class="nx">request</span> <span class="nx">results</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">creation</span> <span class="nx">of</span> <span class="nx">a</span> 
<span class="nx">state</span> <span class="nx">machine</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">node</span> <span class="nx">that</span> <span class="nx">received</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">request</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">state</span> <span class="nx">machine</span> <span class="nx">contains</span> <span class="nx">all</span> <span class="nx">the</span> 
<span class="nx">logic</span> <span class="k">for</span> <span class="nx">identifying</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="nx">responsible</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">sending</span> <span class="nx">the</span> <span class="nx">requests</span><span class="p">,</span> <span class="nx">waiting</span> <span class="k">for</span> <span class="nx">responses</span><span class="p">,</span> 
<span class="nx">potentially</span> <span class="nx">doing</span> <span class="nx">retries</span><span class="p">,</span> <span class="nx">processing</span> <span class="nx">the</span> <span class="nx">replies</span> <span class="nx">and</span> <span class="nx">packaging</span> <span class="nx">the</span> <span class="nx">response</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">client</span><span class="p">.</span> <span class="nx">Each</span> 
<span class="nx">state</span> <span class="nx">machine</span> <span class="nx">instance</span> <span class="nx">handles</span> <span class="nx">exactly</span> <span class="nx">one</span> <span class="nx">client</span> <span class="nx">request</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">read</span> <span class="nx">operation</span> <span class="kr">implements</span> 
<span class="nx">the</span> <span class="nx">following</span> <span class="nx">state</span> <span class="nx">machine</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">send</span> <span class="nx">read</span> <span class="nx">requests</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">nodes</span><span class="p">,</span> <span class="p">(</span><span class="nx">ii</span><span class="p">)</span> <span class="nx">wait</span> <span class="k">for</span> <span class="nx">minimum</span> <span class="nx">number</span> <span class="nx">of</span> 
<span class="nx">required</span> <span class="nx">responses</span><span class="p">,</span> <span class="p">(</span><span class="nx">iii</span><span class="p">)</span> <span class="k">if</span> <span class="nx">too</span> <span class="nx">few</span> <span class="nx">replies</span> <span class="nx">were</span> <span class="nx">received</span> <span class="nx">within</span> <span class="nx">a</span> <span class="nx">given</span> <span class="nx">time</span> <span class="nx">bound</span><span class="p">,</span> <span class="nx">fail</span> <span class="nx">the</span> 
<span class="nx">request</span><span class="p">,</span> <span class="p">(</span><span class="nx">iv</span><span class="p">)</span> <span class="nx">otherwise</span> <span class="nx">gather</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">versions</span> <span class="nx">and</span> <span class="nx">determine</span> <span class="nx">the</span> <span class="nx">ones</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">returned</span> <span class="nx">and</span> 
<span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="k">if</span> <span class="nx">versioning</span> <span class="nx">is</span> <span class="nx">enabled</span><span class="p">,</span> <span class="nx">perform</span> <span class="nx">syntactic</span> <span class="nx">reconciliation</span> <span class="nx">and</span> <span class="nx">generate</span> <span class="nx">an</span> <span class="nx">opaque</span> <span class="nx">write</span> <span class="nx">context</span> 
<span class="nx">that</span> <span class="nx">contains</span> <span class="nx">the</span> <span class="nx">vector</span> <span class="nx">clock</span> <span class="nx">that</span> <span class="nx">subsumes</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">remaining</span> <span class="nx">versions</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">the</span> <span class="nx">sake</span> <span class="nx">of</span> <span class="nx">brevity</span> <span class="nx">the</span> 
<span class="nx">failure</span> <span class="nx">handling</span> <span class="nx">and</span> <span class="nx">retry</span> <span class="nx">states</span> <span class="nx">are</span> <span class="nx">left</span> <span class="nx">out</span><span class="p">.</span>

<span class="nx">After</span> <span class="nx">the</span> <span class="nx">read</span> <span class="nx">response</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">returned</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">caller</span> <span class="nx">the</span> <span class="nx">state</span> <span class="nx">machine</span> <span class="nx">waits</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">small</span> <span class="nx">period</span> <span class="nx">of</span> 
<span class="nx">time</span> <span class="nx">to</span> <span class="nx">receive</span> <span class="nx">any</span> <span class="nx">outstanding</span> <span class="nx">responses</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">stale</span> <span class="nx">versions</span> <span class="nx">were</span> <span class="nx">returned</span> <span class="k">in</span> <span class="nx">any</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">responses</span><span class="p">,</span> 
<span class="nx">the</span> <span class="nx">coordinator</span> <span class="nx">updates</span> <span class="nx">those</span> <span class="nx">nodes</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">latest</span> <span class="nx">version</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">process</span> <span class="nx">is</span> <span class="nx">called</span> <span class="nx">read</span> <span class="nx">repair</span> <span class="nx">because</span> 
<span class="nx">it</span> <span class="nx">repairs</span> <span class="nx">replicas</span> <span class="nx">that</span> <span class="nx">have</span> <span class="nx">missed</span> <span class="nx">a</span> <span class="nx">recent</span> <span class="nx">update</span> <span class="nx">at</span> <span class="nx">an</span> <span class="nx">opportunistic</span> <span class="nx">time</span> <span class="nx">and</span> <span class="nx">relieves</span> <span class="nx">the</span> <span class="nx">anti</span><span class="o">-</span><span class="nx">entropy</span> 
<span class="nx">protocol</span> <span class="nx">from</span> <span class="nx">having</span> <span class="nx">to</span> <span class="k">do</span> <span class="nx">it</span><span class="p">.</span>

<span class="nx">As</span> <span class="nx">noted</span> <span class="nx">earlier</span><span class="p">,</span> <span class="nx">write</span> <span class="nx">requests</span> <span class="nx">are</span> <span class="nx">coordinated</span> <span class="nx">by</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">.</span> 
<span class="nx">Although</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">desirable</span> <span class="nx">always</span> <span class="nx">to</span> <span class="nx">have</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">node</span> <span class="nx">among</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">to</span> <span class="nx">coordinate</span> <span class="nx">the</span> <span class="nx">writes</span> <span class="nx">thereby</span> 
<span class="nx">serializing</span> <span class="nx">all</span> <span class="nx">writes</span> <span class="nx">at</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">location</span><span class="p">,</span> <span class="k">this</span> <span class="nx">approach</span> <span class="nx">has</span> <span class="nx">led</span> <span class="nx">to</span> <span class="nx">uneven</span> <span class="nx">load</span> <span class="nx">distribution</span> <span class="nx">resulting</span> 
<span class="k">in</span> <span class="nx">SLA</span> <span class="nx">violations</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">because</span> <span class="nx">the</span> <span class="nx">request</span> <span class="nx">load</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">uniformly</span> <span class="nx">distributed</span> <span class="nx">across</span> <span class="nx">objects</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">counter</span> 
<span class="k">this</span><span class="p">,</span> <span class="nx">any</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">top</span> <span class="nx">N</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="nx">is</span> <span class="nx">allowed</span> <span class="nx">to</span> <span class="nx">coordinate</span> <span class="nx">the</span> <span class="nx">writes</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">particular</span><span class="p">,</span> 
<span class="nx">since</span> <span class="nx">each</span> <span class="nx">write</span> <span class="nx">usually</span> <span class="nx">follows</span> <span class="nx">a</span> <span class="nx">read</span> <span class="nx">operation</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">coordinator</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">write</span> <span class="nx">is</span> <span class="nx">chosen</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">the</span> <span class="nx">node</span> 
<span class="nx">that</span> <span class="nx">replied</span> <span class="nx">fastest</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">previous</span> <span class="nx">read</span> <span class="nx">operation</span> <span class="nx">which</span> <span class="nx">is</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">context</span> <span class="nx">information</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">request</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">optimization</span> <span class="nx">enables</span> <span class="nx">us</span> <span class="nx">to</span> <span class="nx">pick</span> <span class="nx">the</span> <span class="nx">node</span> <span class="nx">that</span> <span class="nx">has</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">that</span> <span class="nx">was</span> <span class="nx">read</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">preceding</span> 
<span class="nx">read</span> <span class="nx">operation</span> <span class="nx">thereby</span> <span class="nx">increasing</span> <span class="nx">the</span> <span class="nx">chances</span> <span class="nx">of</span> <span class="nx">getting</span> <span class="err">“</span><span class="nx">read</span><span class="o">-</span><span class="nx">your</span><span class="o">-</span><span class="nx">writes</span><span class="err">”</span> <span class="nx">consistency</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">also</span> <span class="nx">reduces</span> 
<span class="nx">variability</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">request</span> <span class="nx">handling</span> <span class="nx">which</span> <span class="nx">improves</span> <span class="nx">the</span> <span class="nx">performance</span> <span class="nx">at</span> <span class="nx">the</span> <span class="mf">99.9</span> <span class="nx">percentile</span><span class="p">.</span>

<span class="mi">6</span><span class="p">.</span> <span class="nx">Experiences</span> <span class="o">&amp;</span> <span class="nx">Lessons</span> <span class="nx">Learned</span>

<span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">used</span> <span class="nx">by</span> <span class="nx">several</span> <span class="nx">services</span> <span class="kd">with</span> <span class="nx">different</span> <span class="nx">configurations</span><span class="p">.</span> <span class="nx">These</span> <span class="nx">instances</span> <span class="nx">differ</span> <span class="nx">by</span> <span class="nx">their</span> 
<span class="nx">version</span> <span class="nx">reconciliation</span> <span class="nx">logic</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">read</span><span class="o">/</span><span class="nx">write</span> <span class="nx">quorum</span> <span class="nx">characteristics</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">following</span> <span class="nx">are</span> <span class="nx">the</span> <span class="nx">main</span> 
<span class="nx">patterns</span> <span class="k">in</span> <span class="nx">which</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">used</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>This paragraph</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Business</span> <span class="nx">logic</span> <span class="nx">specific</span> <span class="nx">reconciliation</span><span class="o">:</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">popular</span> <span class="nx">use</span> <span class="k">case</span> <span class="k">for</span> <span class="nx">Dynamo</span><span class="p">.</span> <span class="nx">Each</span> <span class="nx">data</span> <span class="nx">object</span> <span class="nx">is</span> 
<span class="nx">replicated</span> <span class="nx">across</span> <span class="nx">multiple</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">In</span> <span class="k">case</span> <span class="nx">of</span> <span class="nx">divergent</span> <span class="nx">versions</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">application</span> <span class="nx">performs</span> <span class="nx">its</span> 
<span class="nx">own</span> <span class="nx">reconciliation</span> <span class="nx">logic</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">shopping</span> <span class="nx">cart</span> <span class="nx">service</span> <span class="nx">discussed</span> <span class="nx">earlier</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">prime</span> <span class="nx">example</span> <span class="nx">of</span> <span class="k">this</span> 
<span class="nx">category</span><span class="p">.</span> <span class="nx">Its</span> <span class="nx">business</span> <span class="nx">logic</span> <span class="nx">reconciles</span> <span class="nx">objects</span> <span class="nx">by</span> <span class="nx">merging</span> <span class="nx">different</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">customer</span><span class="err">’</span><span class="nx">s</span> 
<span class="nx">shopping</span> <span class="nx">cart</span><span class="p">.</span>

<span class="nx">Timestamp</span> <span class="nx">based</span> <span class="nx">reconciliation</span><span class="o">:</span> <span class="nx">This</span> <span class="k">case</span> <span class="nx">differs</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">previous</span> <span class="nx">one</span> <span class="nx">only</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">reconciliation</span> 
<span class="nx">mechanism</span><span class="p">.</span> <span class="nx">In</span> <span class="k">case</span> <span class="nx">of</span> <span class="nx">divergent</span> <span class="nx">versions</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">performs</span> <span class="nx">simple</span> <span class="nx">timestamp</span> <span class="nx">based</span> <span class="nx">reconciliation</span> 
<span class="nx">logic</span> <span class="nx">of</span> <span class="err">“</span><span class="nx">last</span> <span class="nx">write</span> <span class="nx">wins</span><span class="err">”</span><span class="p">;</span> <span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">the</span> <span class="nx">object</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">largest</span> <span class="nx">physical</span> <span class="nx">timestamp</span> <span class="nx">value</span> <span class="nx">is</span> <span class="nx">chosen</span> 
<span class="nx">as</span> <span class="nx">the</span> <span class="nx">correct</span> <span class="nx">version</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">service</span> <span class="nx">that</span> <span class="nx">maintains</span> <span class="nx">customer</span><span class="err">’</span><span class="nx">s</span> <span class="nx">session</span> <span class="nx">information</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">good</span> <span class="nx">example</span> 
<span class="nx">of</span> <span class="nx">a</span> <span class="nx">service</span> <span class="nx">that</span> <span class="nx">uses</span> <span class="k">this</span> <span class="nx">mode</span><span class="p">.</span>

<span class="nx">High</span> <span class="nx">performance</span> <span class="nx">read</span> <span class="nx">engine</span><span class="o">:</span> <span class="nx">While</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">built</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">an</span> <span class="err">“</span><span class="nx">always</span> <span class="nx">writeable</span><span class="err">”</span> <span class="nx">data</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">few</span> 
<span class="nx">services</span> <span class="nx">are</span> <span class="nx">tuning</span> <span class="nx">its</span> <span class="nx">quorum</span> <span class="nx">characteristics</span> <span class="nx">and</span> <span class="nx">using</span> <span class="nx">it</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">high</span> <span class="nx">performance</span> <span class="nx">read</span> <span class="nx">engine</span><span class="p">.</span> 
<span class="nx">Typically</span><span class="p">,</span> <span class="nx">these</span> <span class="nx">services</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">high</span> <span class="nx">read</span> <span class="nx">request</span> <span class="nx">rate</span> <span class="nx">and</span> <span class="nx">only</span> <span class="nx">a</span> <span class="nx">small</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">updates</span><span class="p">.</span> 
<span class="nx">In</span> <span class="k">this</span> <span class="nx">configuration</span><span class="p">,</span> <span class="nx">typically</span> <span class="nx">R</span> <span class="nx">is</span> <span class="nx">set</span> <span class="nx">to</span> <span class="nx">be</span> <span class="mi">1</span> <span class="nx">and</span> <span class="nx">W</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">N</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">these</span> <span class="nx">services</span><span class="p">,</span> <span class="nx">Dynamo</span> 
<span class="nx">provides</span> <span class="nx">the</span> <span class="nx">ability</span> <span class="nx">to</span> <span class="nx">partition</span> <span class="nx">and</span> <span class="nx">replicate</span> <span class="nx">their</span> <span class="nx">data</span> <span class="nx">across</span> <span class="nx">multiple</span> <span class="nx">nodes</span> <span class="nx">thereby</span> <span class="nx">offering</span> 
<span class="nx">incremental</span> <span class="nx">scalability</span><span class="p">.</span> <span class="nx">Some</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">instances</span> <span class="kd">function</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">authoritative</span> <span class="nx">persistence</span> <span class="nx">cache</span> 
<span class="k">for</span> <span class="nx">data</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">more</span> <span class="nx">heavy</span> <span class="nx">weight</span> <span class="nx">backing</span> <span class="nx">stores</span><span class="p">.</span> <span class="nx">Services</span> <span class="nx">that</span> <span class="nx">maintain</span> <span class="nx">product</span> <span class="nx">catalog</span> <span class="nx">and</span> 
<span class="nx">promotional</span> <span class="nx">items</span> <span class="nx">fit</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">category</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">main</span> <span class="nx">advantage</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">its</span> <span class="nx">client</span> <span class="nx">applications</span> <span class="nx">can</span> <span class="nx">tune</span> <span class="nx">the</span> <span class="nx">values</span> <span class="nx">of</span> <span class="nx">N</span><span class="p">,</span> <span class="nx">R</span> <span class="nx">and</span> <span class="nx">W</span> <span class="nx">to</span> 
<span class="nx">achieve</span> <span class="nx">their</span> <span class="nx">desired</span> <span class="nx">levels</span> <span class="nx">of</span> <span class="nx">performance</span><span class="p">,</span> <span class="nx">availability</span> <span class="nx">and</span> <span class="nx">durability</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">value</span> 
<span class="nx">of</span> <span class="nx">N</span> <span class="nx">determines</span> <span class="nx">the</span> <span class="nx">durability</span> <span class="nx">of</span> <span class="nx">each</span> <span class="nx">object</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">typical</span> <span class="nx">value</span> <span class="nx">of</span> <span class="nx">N</span> <span class="nx">used</span> <span class="nx">by</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">users</span> <span class="nx">is</span> <span class="mi">3</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">values</span> <span class="nx">of</span> <span class="nx">W</span> <span class="nx">and</span> <span class="nx">R</span> <span class="nx">impact</span> <span class="nx">object</span> <span class="nx">availability</span><span class="p">,</span> <span class="nx">durability</span> <span class="nx">and</span> <span class="nx">consistency</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="k">if</span> <span class="nx">W</span> <span class="nx">is</span> <span class="nx">set</span> 
<span class="nx">to</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">then</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">will</span> <span class="nx">never</span> <span class="nx">reject</span> <span class="nx">a</span> <span class="nx">write</span> <span class="nx">request</span> <span class="nx">as</span> <span class="kr">long</span> <span class="nx">as</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">at</span> <span class="nx">least</span> <span class="nx">one</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">the</span> 
<span class="nx">system</span> <span class="nx">that</span> <span class="nx">can</span> <span class="nx">successfully</span> <span class="nx">process</span> <span class="nx">a</span> <span class="nx">write</span> <span class="nx">request</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">low</span> <span class="nx">values</span> <span class="nx">of</span> <span class="nx">W</span> <span class="nx">and</span> <span class="nx">R</span> <span class="nx">can</span> <span class="nx">increase</span> <span class="nx">the</span> 
<span class="nx">risk</span> <span class="nx">of</span> <span class="nx">inconsistency</span> <span class="nx">as</span> <span class="nx">write</span> <span class="nx">requests</span> <span class="nx">are</span> <span class="nx">deemed</span> <span class="nx">successful</span> <span class="nx">and</span> <span class="nx">returned</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">clients</span> <span class="nx">even</span> <span class="k">if</span> <span class="nx">they</span> 
<span class="nx">are</span> <span class="nx">not</span> <span class="nx">processed</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">majority</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">replicas</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">also</span> <span class="nx">introduces</span> <span class="nx">a</span> <span class="nx">vulnerability</span> <span class="nb">window</span> <span class="k">for</span> 
<span class="nx">durability</span> <span class="nx">when</span> <span class="nx">a</span> <span class="nx">write</span> <span class="nx">request</span> <span class="nx">is</span> <span class="nx">successfully</span> <span class="nx">returned</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">even</span> <span class="nx">though</span> <span class="nx">it</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">persisted</span> 
<span class="nx">at</span> <span class="nx">only</span> <span class="nx">a</span> <span class="nx">small</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">nodes</span><span class="p">.</span>

<span class="nx">Traditional</span> <span class="nx">wisdom</span> <span class="nx">holds</span> <span class="nx">that</span> <span class="nx">durability</span> <span class="nx">and</span> <span class="nx">availability</span> <span class="nx">go</span> <span class="nx">hand</span><span class="o">-</span><span class="k">in</span><span class="o">-</span><span class="nx">hand</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="k">this</span> <span class="nx">is</span> <span class="nx">not</span> 
<span class="nx">necessarily</span> <span class="kc">true</span> <span class="nx">here</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">vulnerability</span> <span class="nb">window</span> <span class="k">for</span> <span class="nx">durability</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">decreased</span> <span class="nx">by</span> 
<span class="nx">increasing</span> <span class="nx">W</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">may</span> <span class="nx">increase</span> <span class="nx">the</span> <span class="nx">probability</span> <span class="nx">of</span> <span class="nx">rejecting</span> <span class="nx">requests</span> <span class="p">(</span><span class="nx">thereby</span> <span class="nx">decreasing</span> 
<span class="nx">availability</span><span class="p">)</span> <span class="nx">because</span> <span class="nx">more</span> <span class="nx">storage</span> <span class="nx">hosts</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">alive</span> <span class="nx">to</span> <span class="nx">process</span> <span class="nx">a</span> <span class="nx">write</span> <span class="nx">request</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">common</span> <span class="p">(</span><span class="nx">N</span><span class="p">,</span><span class="nx">R</span><span class="p">,</span><span class="nx">W</span><span class="p">)</span> <span class="nx">configuration</span> <span class="nx">used</span> <span class="nx">by</span> <span class="nx">several</span> <span class="nx">instances</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">).</span> <span class="nx">These</span> <span class="nx">values</span> <span class="nx">are</span> 
<span class="nx">chosen</span> <span class="nx">to</span> <span class="nx">meet</span> <span class="nx">the</span> <span class="nx">necessary</span> <span class="nx">levels</span> <span class="nx">of</span> <span class="nx">performance</span><span class="p">,</span> <span class="nx">durability</span><span class="p">,</span> <span class="nx">consistency</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">availability</span> <span class="nx">SLAs</span><span class="p">.</span>

<span class="nx">All</span> <span class="nx">the</span> <span class="nx">measurements</span> <span class="nx">presented</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">section</span> <span class="nx">were</span> <span class="nx">taken</span> <span class="nx">on</span> <span class="nx">a</span> <span class="nx">live</span> <span class="nx">system</span> <span class="nx">operating</span> <span class="kd">with</span> <span class="nx">a</span> <span class="nx">configuration</span> 
<span class="nx">of</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="nx">and</span> <span class="nx">running</span> <span class="nx">a</span> <span class="nx">couple</span> <span class="nx">hundred</span> <span class="nx">nodes</span> <span class="kd">with</span> <span class="nx">homogenous</span> <span class="nx">hardware</span> <span class="nx">configurations</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">mentioned</span> <span class="nx">earlier</span><span class="p">,</span> 
<span class="nx">each</span> <span class="nx">instance</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="nx">contains</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">located</span> <span class="k">in</span> <span class="nx">multiple</span> <span class="nx">datacenters</span><span class="p">.</span> <span class="nx">These</span> <span class="nx">datacenters</span> <span class="nx">are</span> 
<span class="nx">typically</span> <span class="nx">connected</span> <span class="nx">through</span> <span class="nx">high</span> <span class="nx">speed</span> <span class="nx">network</span> <span class="nx">links</span><span class="p">.</span> <span class="nx">Recall</span> <span class="nx">that</span> <span class="nx">to</span> <span class="nx">generate</span> <span class="nx">a</span> <span class="nx">successful</span> <span class="nx">get</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">put</span><span class="p">)</span> 
<span class="nx">response</span> <span class="nx">R</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">W</span><span class="p">)</span> <span class="nx">nodes</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">respond</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">coordinator</span><span class="p">.</span> <span class="nx">Clearly</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">network</span> <span class="nx">latencies</span> <span class="nx">between</span> 
<span class="nx">datacenters</span> <span class="nx">affect</span> <span class="nx">the</span> <span class="nx">response</span> <span class="nx">time</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="p">(</span><span class="nx">and</span> <span class="nx">their</span> <span class="nx">datacenter</span> <span class="nx">locations</span><span class="p">)</span> <span class="nx">are</span> <span class="nx">chosen</span> <span class="nx">such</span> 
<span class="nx">that</span> <span class="nx">the</span> <span class="nx">applications</span> <span class="nx">target</span> <span class="nx">SLAs</span> <span class="nx">are</span> <span class="nx">met</span><span class="p">.</span>

<span class="mf">6.1</span> <span class="nx">Balancing</span> <span class="nx">Performance</span> <span class="nx">and</span> <span class="nx">Durability</span>

<span class="nx">While</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">principle</span> <span class="nx">design</span> <span class="nx">goal</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">build</span> <span class="nx">a</span> <span class="nx">highly</span> <span class="nx">available</span> <span class="nx">data</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">performance</span> <span class="nx">is</span> <span class="nx">an</span> 
<span class="nx">equally</span> <span class="nx">important</span> <span class="nx">criterion</span> <span class="k">in</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">platform</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">noted</span> <span class="nx">earlier</span><span class="p">,</span> <span class="nx">to</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="nx">consistent</span> <span class="nx">customer</span> 
<span class="nx">experience</span><span class="p">,</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> <span class="nx">services</span> <span class="nx">set</span> <span class="nx">their</span> <span class="nx">performance</span> <span class="nx">targets</span> <span class="nx">at</span> <span class="nx">higher</span> <span class="nx">percentiles</span> <span class="p">(</span><span class="nx">such</span> <span class="nx">as</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> 
<span class="nx">or</span> <span class="mf">99.99</span><span class="nx">th</span> <span class="nx">percentiles</span><span class="p">).</span> <span class="nx">A</span> <span class="nx">typical</span> <span class="nx">SLA</span> <span class="nx">required</span> <span class="nx">of</span> <span class="nx">services</span> <span class="nx">that</span> <span class="nx">use</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">that</span> <span class="mf">99.9</span><span class="o">%</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">requests</span> <span class="nx">execute</span> <span class="nx">within</span> <span class="mi">300</span><span class="nx">ms</span><span class="p">.</span>

<span class="nx">Since</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">run</span> <span class="nx">on</span> <span class="nx">standard</span> <span class="nx">commodity</span> <span class="nx">hardware</span> <span class="nx">components</span> <span class="nx">that</span> <span class="nx">have</span> <span class="nx">far</span> <span class="nx">less</span> <span class="nx">I</span><span class="o">/</span><span class="nx">O</span> <span class="nx">throughput</span> 
<span class="nx">than</span> <span class="nx">high</span><span class="o">-</span><span class="nx">end</span> <span class="nx">enterprise</span> <span class="nx">servers</span><span class="p">,</span> <span class="nx">providing</span> <span class="nx">consistently</span> <span class="nx">high</span> <span class="nx">performance</span> <span class="k">for</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">operations</span> 
<span class="nx">is</span> <span class="nx">a</span> <span class="nx">non</span><span class="o">-</span><span class="nx">trivial</span> <span class="nx">task</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">involvement</span> <span class="nx">of</span> <span class="nx">multiple</span> <span class="nx">storage</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">operations</span> <span class="nx">makes</span> 
<span class="nx">it</span> <span class="nx">even</span> <span class="nx">more</span> <span class="nx">challenging</span><span class="p">,</span> <span class="nx">since</span> <span class="nx">the</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">operations</span> <span class="nx">is</span> <span class="nx">limited</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">slowest</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">R</span> <span class="nx">or</span> <span class="nx">W</span> <span class="nx">replicas</span><span class="p">.</span> <span class="nx">Figure</span> <span class="mi">4</span> <span class="nx">shows</span> <span class="nx">the</span> <span class="nx">average</span> <span class="nx">and</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">latencies</span> <span class="nx">of</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> 
<span class="nx">operations</span> <span class="nx">during</span> <span class="nx">a</span> <span class="nx">period</span> <span class="nx">of</span> <span class="mi">30</span> <span class="nx">days</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">seen</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">figure</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">latencies</span> <span class="nx">exhibit</span> <span class="nx">a</span> <span class="nx">clear</span> <span class="nx">diurnal</span> 
<span class="nx">pattern</span> <span class="nx">which</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">result</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">diurnal</span> <span class="nx">pattern</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">incoming</span> <span class="nx">request</span> <span class="nx">rate</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">a</span> 
<span class="nx">significant</span> <span class="nx">difference</span> <span class="k">in</span> <span class="nx">request</span> <span class="nx">rate</span> <span class="nx">between</span> <span class="nx">the</span> <span class="nx">daytime</span> <span class="nx">and</span> <span class="nx">night</span><span class="p">).</span> <span class="nx">Moreover</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">write</span> <span class="nx">latencies</span> 
<span class="nx">are</span> <span class="nx">higher</span> <span class="nx">than</span> <span class="nx">read</span> <span class="nx">latencies</span> <span class="nx">obviously</span> <span class="nx">because</span> <span class="nx">write</span> <span class="nx">operations</span> <span class="nx">always</span> <span class="nx">results</span> <span class="k">in</span> <span class="nx">disk</span> <span class="nx">access</span><span class="p">.</span> 
<span class="nx">Also</span><span class="p">,</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">latencies</span> <span class="nx">are</span> <span class="nx">around</span> <span class="mi">200</span> <span class="nx">ms</span> <span class="nx">and</span> <span class="nx">are</span> <span class="nx">an</span> <span class="nx">order</span> <span class="nx">of</span> <span class="nx">magnitude</span> <span class="nx">higher</span> <span class="nx">than</span> 
<span class="nx">the</span> <span class="nx">averages</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">because</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">latencies</span> <span class="nx">are</span> <span class="nx">affected</span> <span class="nx">by</span> <span class="nx">several</span> <span class="nx">factors</span> <span class="nx">such</span> 
<span class="nx">as</span> <span class="nx">variability</span> <span class="k">in</span> <span class="nx">request</span> <span class="nx">load</span><span class="p">,</span> <span class="nx">object</span> <span class="nx">sizes</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">locality</span> <span class="nx">patterns</span><span class="p">.</span>

<span class="nx">Figure</span> <span class="mi">4</span><span class="o">:</span> <span class="nx">Average</span> <span class="nx">and</span> <span class="mf">99.9</span> <span class="nx">percentiles</span> <span class="nx">of</span> <span class="nx">latencies</span> <span class="k">for</span> <span class="nx">read</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">requests</span> <span class="nx">during</span> <span class="nx">our</span> <span class="nx">peak</span> 
<span class="nx">request</span> <span class="nx">season</span> <span class="nx">of</span> <span class="nx">December</span> <span class="mi">2006</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">intervals</span> <span class="nx">between</span> <span class="nx">consecutive</span> <span class="nx">ticks</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">x</span><span class="o">-</span><span class="nx">axis</span> <span class="nx">correspond</span> 
<span class="nx">to</span> <span class="mi">12</span> <span class="nx">hours</span><span class="p">.</span> <span class="nx">Latencies</span> <span class="nx">follow</span> <span class="nx">a</span> <span class="nx">diurnal</span> <span class="nx">pattern</span> <span class="nx">similar</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">request</span> <span class="nx">rate</span> <span class="nx">and</span> <span class="mf">99.9</span> <span class="nx">percentile</span> 
<span class="nx">latencies</span> <span class="nx">are</span> <span class="nx">an</span> <span class="nx">order</span> <span class="nx">of</span> <span class="nx">magnitude</span> <span class="nx">higher</span> <span class="nx">than</span> <span class="nx">averages</span><span class="p">.</span>

<span class="nx">While</span> <span class="k">this</span> <span class="nx">level</span> <span class="nx">of</span> <span class="nx">performance</span> <span class="nx">is</span> <span class="nx">acceptable</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">services</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">few</span> <span class="nx">customer</span><span class="o">-</span><span class="nx">facing</span> 
<span class="nx">services</span> <span class="nx">required</span> <span class="nx">higher</span> <span class="nx">levels</span> <span class="nx">of</span> <span class="nx">performance</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">these</span> <span class="nx">services</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">provides</span> <span class="nx">the</span> <span class="nx">ability</span> 
<span class="nx">to</span> <span class="nx">trade</span><span class="o">-</span><span class="nx">off</span> <span class="nx">durability</span> <span class="nx">guarantees</span> <span class="k">for</span> <span class="nx">performance</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">the</span> <span class="nx">optimization</span> <span class="nx">each</span> <span class="nx">storage</span> <span class="nx">node</span> <span class="nx">maintains</span> 
<span class="nx">an</span> <span class="nx">object</span> <span class="nx">buffer</span> <span class="k">in</span> <span class="nx">its</span> <span class="nx">main</span> <span class="nx">memory</span><span class="p">.</span> <span class="nx">Each</span> <span class="nx">write</span> <span class="nx">operation</span> <span class="nx">is</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">buffer</span> <span class="nx">and</span> <span class="nx">gets</span> <span class="nx">periodically</span> 
<span class="nx">written</span> <span class="nx">to</span> <span class="nx">storage</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">writer</span> <span class="nx">thread</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">scheme</span><span class="p">,</span> <span class="nx">read</span> <span class="nx">operations</span> <span class="nx">first</span> <span class="nx">check</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">requested</span> <span class="nx">key</span> 
<span class="nx">is</span> <span class="nx">present</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">buffer</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">so</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">object</span> <span class="nx">is</span> <span class="nx">read</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">buffer</span> <span class="nx">instead</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">storage</span> <span class="nx">engine</span><span class="p">.</span>

<span class="nx">This</span> <span class="nx">optimization</span> <span class="nx">has</span> <span class="nx">resulted</span> <span class="k">in</span> <span class="nx">lowering</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">latency</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">factor</span> <span class="nx">of</span> <span class="mi">5</span> <span class="nx">during</span> 
<span class="nx">peak</span> <span class="nx">traffic</span> <span class="nx">even</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">very</span> <span class="nx">small</span> <span class="nx">buffer</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">thousand</span> <span class="nx">objects</span> <span class="p">(</span><span class="nx">see</span> <span class="nx">Figure</span> <span class="mi">5</span><span class="p">).</span> <span class="nx">Also</span><span class="p">,</span> <span class="nx">as</span> <span class="nx">seen</span> <span class="k">in</span> 
<span class="nx">the</span> <span class="nx">figure</span><span class="p">,</span> <span class="nx">write</span> <span class="nx">buffering</span> <span class="nx">smoothes</span> <span class="nx">out</span> <span class="nx">higher</span> <span class="nx">percentile</span> <span class="nx">latencies</span><span class="p">.</span> <span class="nx">Obviously</span><span class="p">,</span> <span class="k">this</span> <span class="nx">scheme</span> <span class="nx">trades</span>
<span class="nx">durability</span> <span class="k">for</span> <span class="nx">performance</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">scheme</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">server</span> <span class="nx">crash</span> <span class="nx">can</span> <span class="nx">result</span> <span class="k">in</span> <span class="nx">missing</span> <span class="nx">writes</span> <span class="nx">that</span> <span class="nx">were</span> 
<span class="nx">queued</span> <span class="nx">up</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">buffer</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">reduce</span> <span class="nx">the</span> <span class="nx">durability</span> <span class="nx">risk</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">write</span> <span class="nx">operation</span> <span class="nx">is</span> <span class="nx">refined</span> <span class="nx">to</span> <span class="nx">have</span> <span class="nx">the</span> 
<span class="nx">coordinator</span> <span class="nx">choose</span> <span class="nx">one</span> <span class="nx">out</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">N</span> <span class="nx">replicas</span> <span class="nx">to</span> <span class="nx">perform</span> <span class="nx">a</span> <span class="err">“</span><span class="nx">durable</span> <span class="nx">write</span><span class="err">”</span><span class="p">.</span> <span class="nx">Since</span> <span class="nx">the</span> <span class="nx">coordinator</span> <span class="nx">waits</span> 
<span class="nx">only</span> <span class="k">for</span> <span class="nx">W</span> <span class="nx">responses</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">write</span> <span class="nx">operation</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">affected</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">durable</span> <span class="nx">write</span> <span class="nx">operation</span> <span class="nx">performed</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">replica</span><span class="p">.</span>


<span class="nx">Figure</span> <span class="mi">5</span><span class="o">:</span> <span class="nx">Comparison</span> <span class="nx">of</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">latencies</span> <span class="k">for</span> <span class="nx">buffered</span> <span class="nx">vs</span><span class="p">.</span> <span class="nx">non</span><span class="o">-</span><span class="nx">buffered</span> <span class="nx">writes</span> 
<span class="nx">over</span> <span class="nx">a</span> <span class="nx">period</span> <span class="nx">of</span> <span class="mi">24</span> <span class="nx">hours</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">intervals</span> <span class="nx">between</span> <span class="nx">consecutive</span> <span class="nx">ticks</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">x</span><span class="o">-</span><span class="nx">axis</span> <span class="nx">correspond</span> <span class="nx">to</span> <span class="nx">one</span> <span class="nx">hour</span><span class="p">.</span>

<span class="mf">6.2</span> <span class="nx">Ensuring</span> <span class="nx">Uniform</span> <span class="nx">Load</span> <span class="nx">distribution</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>This following paragraph</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Dynamo</span> <span class="nx">uses</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="nx">to</span> <span class="nx">partition</span> <span class="nx">its</span> <span class="nx">key</span> <span class="nx">space</span> <span class="nx">across</span> <span class="nx">its</span> <span class="nx">replicas</span> <span class="nx">and</span> <span class="nx">to</span> <span class="nx">ensure</span> <span class="nx">uniform</span> 
<span class="nx">load</span> <span class="nx">distribution</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">uniform</span> <span class="nx">key</span> <span class="nx">distribution</span> <span class="nx">can</span> <span class="nx">help</span> <span class="nx">us</span> <span class="nx">achieve</span> <span class="nx">uniform</span> <span class="nx">load</span> <span class="nx">distribution</span> <span class="nx">assuming</span> 
<span class="nx">the</span> <span class="nx">access</span> <span class="nx">distribution</span> <span class="nx">of</span> <span class="nx">keys</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">highly</span> <span class="nx">skewed</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">particular</span><span class="p">,</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">design</span> <span class="nx">assumes</span> <span class="nx">that</span> <span class="nx">even</span> 
<span class="nx">where</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">significant</span> <span class="nx">skew</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">access</span> <span class="nx">distribution</span> <span class="nx">there</span> <span class="nx">are</span> <span class="nx">enough</span> <span class="nx">keys</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">popular</span> <span class="nx">end</span> 
<span class="nx">of</span> <span class="nx">the</span> <span class="nx">distribution</span> <span class="nx">so</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">of</span> <span class="nx">handling</span> <span class="nx">popular</span> <span class="nx">keys</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">spread</span> <span class="nx">across</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="nx">uniformly</span> 
<span class="nx">through</span> <span class="nx">partitioning</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">section</span> <span class="nx">discusses</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">imbalance</span> <span class="nx">seen</span> <span class="k">in</span> <span class="nx">Dynamo</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">impact</span> <span class="nx">of</span> 
<span class="nx">different</span> <span class="nx">partitioning</span> <span class="nx">strategies</span> <span class="nx">on</span> <span class="nx">load</span> <span class="nx">distribution</span><span class="p">.</span>

<span class="nx">To</span> <span class="nx">study</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">imbalance</span> <span class="nx">and</span> <span class="nx">its</span> <span class="nx">correlation</span> <span class="kd">with</span> <span class="nx">request</span> <span class="nx">load</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">total</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">requests</span> 
<span class="nx">received</span> <span class="nx">by</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">was</span> <span class="nx">measured</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">period</span> <span class="nx">of</span> <span class="mi">24</span> <span class="nx">hours</span> <span class="o">-</span> <span class="nx">broken</span> <span class="nx">down</span> <span class="nx">into</span> <span class="nx">intervals</span> <span class="nx">of</span> <span class="mi">30</span> 
<span class="nx">minutes</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">a</span> <span class="nx">given</span> <span class="nx">time</span> <span class="nb">window</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">considered</span> <span class="nx">to</span> <span class="nx">be</span> <span class="err">“</span><span class="k">in</span><span class="o">-</span><span class="nx">balance</span><span class="err">”</span><span class="p">,</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">node</span><span class="err">’</span><span class="nx">s</span> <span class="nx">request</span> 
<span class="nx">load</span> <span class="nx">deviates</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">average</span> <span class="nx">load</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">value</span> <span class="nx">a</span> <span class="nx">less</span> <span class="nx">than</span> <span class="nx">a</span> <span class="nx">certain</span> <span class="nx">threshold</span> <span class="p">(</span><span class="nx">here</span> <span class="mi">15</span><span class="o">%</span><span class="p">).</span> <span class="nx">Otherwise</span> 
<span class="nx">the</span> <span class="nx">node</span> <span class="nx">was</span> <span class="nx">deemed</span> <span class="err">“</span><span class="nx">out</span><span class="o">-</span><span class="nx">of</span><span class="o">-</span><span class="nx">balance</span><span class="err">”</span><span class="p">.</span> <span class="nx">Figure</span> <span class="mi">6</span> <span class="nx">presents</span> <span class="nx">the</span> <span class="nx">fraction</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">are</span> <span class="err">“</span><span class="nx">out</span><span class="o">-</span><span class="nx">of</span><span class="o">-</span><span class="nx">balance</span><span class="err">”</span> 
<span class="p">(</span><span class="nx">henceforth</span><span class="p">,</span> <span class="err">“</span><span class="nx">imbalance</span> <span class="nx">ratio</span><span class="err">”</span><span class="p">)</span> <span class="nx">during</span> <span class="k">this</span> <span class="nx">time</span> <span class="nx">period</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">reference</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">corresponding</span> <span class="nx">request</span> <span class="nx">load</span> 
<span class="nx">received</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nx">system</span> <span class="nx">during</span> <span class="k">this</span> <span class="nx">time</span> <span class="nx">period</span> <span class="nx">is</span> <span class="nx">also</span> <span class="nx">plotted</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">seen</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">figure</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">imbalance</span> 
<span class="nx">ratio</span> <span class="nx">decreases</span> <span class="kd">with</span> <span class="nx">increasing</span> <span class="nx">load</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">during</span> <span class="nx">low</span> <span class="nx">loads</span> <span class="nx">the</span> <span class="nx">imbalance</span> <span class="nx">ratio</span> <span class="nx">is</span> <span class="nx">as</span> <span class="nx">high</span> <span class="nx">as</span> <span class="mi">20</span><span class="o">%</span> 
<span class="nx">and</span> <span class="nx">during</span> <span class="nx">high</span> <span class="nx">loads</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">close</span> <span class="nx">to</span> <span class="mi">10</span><span class="o">%</span><span class="p">.</span> <span class="nx">Intuitively</span><span class="p">,</span> <span class="k">this</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">explained</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">fact</span> <span class="nx">that</span> <span class="nx">under</span> <span class="nx">high</span> 
<span class="nx">loads</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">large</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">popular</span> <span class="nx">keys</span> <span class="nx">are</span> <span class="nx">accessed</span> <span class="nx">and</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">uniform</span> <span class="nx">distribution</span> <span class="nx">of</span> <span class="nx">keys</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">is</span> 
<span class="nx">evenly</span> <span class="nx">distributed</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">during</span> <span class="nx">low</span> <span class="nx">loads</span> <span class="p">(</span><span class="nx">where</span> <span class="nx">load</span> <span class="nx">is</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="nx">th</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">measured</span> <span class="nx">peak</span> <span class="nx">load</span><span class="p">),</span> <span class="nx">fewer</span> 
<span class="nx">popular</span> <span class="nx">keys</span> <span class="nx">are</span> <span class="nx">accessed</span><span class="p">,</span> <span class="nx">resulting</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">higher</span> <span class="nx">load</span> <span class="nx">imbalance</span><span class="p">.</span>


<span class="nx">Figure</span> <span class="mi">6</span><span class="o">:</span> <span class="nx">Fraction</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">out</span><span class="o">-</span><span class="nx">of</span><span class="o">-</span><span class="nx">balance</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">nodes</span> <span class="nx">whose</span> <span class="nx">request</span> <span class="nx">load</span> <span class="nx">is</span> <span class="nx">above</span> <span class="nx">a</span> 
<span class="nx">certain</span> <span class="nx">threshold</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">average</span> <span class="nx">system</span> <span class="nx">load</span><span class="p">)</span> <span class="nx">and</span> <span class="nx">their</span> <span class="nx">corresponding</span> <span class="nx">request</span> <span class="nx">load</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">interval</span> 
<span class="nx">between</span> <span class="nx">ticks</span> <span class="k">in</span> <span class="nx">x</span><span class="o">-</span><span class="nx">axis</span> <span class="nx">corresponds</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">time</span> <span class="nx">period</span> <span class="nx">of</span> <span class="mi">30</span> <span class="nx">minutes</span><span class="p">.</span>

<span class="nx">This</span> <span class="nx">section</span> <span class="nx">discusses</span> <span class="nx">how</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">partitioning</span> <span class="nx">scheme</span> <span class="nx">has</span> <span class="nx">evolved</span> <span class="nx">over</span> <span class="nx">time</span> 
<span class="nx">and</span> <span class="nx">its</span> <span class="nx">implications</span> <span class="nx">on</span> <span class="nx">load</span> <span class="nx">distribution</span><span class="p">.</span>

<span class="nx">Strategy</span> <span class="mi">1</span><span class="o">:</span> <span class="nx">T</span> <span class="nx">random</span> <span class="nx">tokens</span> <span class="nx">per</span> <span class="nx">node</span> <span class="nx">and</span> <span class="nx">partition</span> <span class="nx">by</span> <span class="nx">token</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">This</span> <span class="nx">was</span> <span class="nx">the</span> <span class="nx">initial</span> <span class="nx">strategy</span> 
<span class="nx">deployed</span> <span class="k">in</span> <span class="nx">production</span> <span class="p">(</span><span class="nx">and</span> <span class="nx">described</span> <span class="k">in</span> <span class="nx">Section</span> <span class="mf">4.2</span><span class="p">).</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">scheme</span><span class="p">,</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">T</span> 
<span class="nx">tokens</span> <span class="p">(</span><span class="nx">chosen</span> <span class="nx">uniformly</span> <span class="nx">at</span> <span class="nx">random</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">hash</span> <span class="nx">space</span><span class="p">).</span> <span class="nx">The</span> <span class="nx">tokens</span> <span class="nx">of</span> <span class="nx">all</span> <span class="nx">nodes</span> <span class="nx">are</span> <span class="nx">ordered</span> 
<span class="nx">according</span> <span class="nx">to</span> <span class="nx">their</span> <span class="nx">values</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">hash</span> <span class="nx">space</span><span class="p">.</span> <span class="nx">Every</span> <span class="nx">two</span> <span class="nx">consecutive</span> <span class="nx">tokens</span> <span class="nx">define</span> <span class="nx">a</span> <span class="nx">range</span><span class="p">.</span> <span class="nx">The</span> 
<span class="nx">last</span> <span class="nx">token</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">token</span> <span class="nx">form</span> <span class="nx">a</span> <span class="nx">range</span> <span class="nx">that</span> <span class="s2">&quot;wraps&quot;</span> <span class="nx">around</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">highest</span> <span class="nx">value</span> <span class="nx">to</span> <span class="nx">the</span> 
<span class="nx">lowest</span> <span class="nx">value</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">hash</span> <span class="nx">space</span><span class="p">.</span> <span class="nx">Because</span> <span class="nx">the</span> <span class="nx">tokens</span> <span class="nx">are</span> <span class="nx">chosen</span> <span class="nx">randomly</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">ranges</span> <span class="nx">vary</span> <span class="k">in</span> <span class="nx">size</span><span class="p">.</span> 
<span class="nx">As</span> <span class="nx">nodes</span> <span class="nx">join</span> <span class="nx">and</span> <span class="nx">leave</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">token</span> <span class="nx">set</span> <span class="nx">changes</span> <span class="nx">and</span> <span class="nx">consequently</span> <span class="nx">the</span> <span class="nx">ranges</span> <span class="nx">change</span><span class="p">.</span> 
<span class="nx">Note</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">space</span> <span class="nx">needed</span> <span class="nx">to</span> <span class="nx">maintain</span> <span class="nx">the</span> <span class="nx">membership</span> <span class="nx">at</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">increases</span> <span class="nx">linearly</span> <span class="kd">with</span> <span class="nx">the</span> 
<span class="nx">number</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">.</span>

<span class="nx">While</span> <span class="nx">using</span> <span class="k">this</span> <span class="nx">strategy</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">problems</span> <span class="nx">were</span> <span class="nx">encountered</span><span class="p">.</span> <span class="nx">First</span><span class="p">,</span> <span class="nx">when</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">node</span> <span class="nx">joins</span> 
<span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="err">“</span><span class="nx">steal</span><span class="err">”</span> <span class="nx">its</span> <span class="nx">key</span> <span class="nx">ranges</span> <span class="nx">from</span> <span class="nx">other</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="nx">handing</span> <span class="nx">the</span> 
<span class="nx">key</span> <span class="nx">ranges</span> <span class="nx">off</span> <span class="nx">to</span> <span class="nx">the</span> <span class="k">new</span> <span class="nx">node</span> <span class="nx">have</span> <span class="nx">to</span> <span class="nx">scan</span> <span class="nx">their</span> <span class="nx">local</span> <span class="nx">persistence</span> <span class="nx">store</span> <span class="nx">to</span> <span class="nx">retrieve</span> <span class="nx">the</span> <span class="nx">appropriate</span> 
<span class="nx">set</span> <span class="nx">of</span> <span class="nx">data</span> <span class="nx">items</span><span class="p">.</span> <span class="nx">Note</span> <span class="nx">that</span> <span class="nx">performing</span> <span class="nx">such</span> <span class="nx">a</span> <span class="nx">scan</span> <span class="nx">operation</span> <span class="nx">on</span> <span class="nx">a</span> <span class="nx">production</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">tricky</span> <span class="nx">as</span> 
<span class="nx">scans</span> <span class="nx">are</span> <span class="nx">highly</span> <span class="nx">resource</span> <span class="nx">intensive</span> <span class="nx">operations</span> <span class="nx">and</span> <span class="nx">they</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">executed</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">background</span> 
<span class="nx">without</span> <span class="nx">affecting</span> <span class="nx">the</span> <span class="nx">customer</span> <span class="nx">performance</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">requires</span> <span class="nx">us</span> <span class="nx">to</span> <span class="nx">run</span> <span class="nx">the</span> <span class="nx">bootstrapping</span> <span class="nx">task</span> <span class="nx">at</span> 
<span class="nx">the</span> <span class="nx">lowest</span> <span class="nx">priority</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="k">this</span> <span class="nx">significantly</span> <span class="nx">slows</span> <span class="nx">the</span> <span class="nx">bootstrapping</span> <span class="nx">process</span> <span class="nx">and</span> <span class="nx">during</span> 
<span class="nx">busy</span> <span class="nx">shopping</span> <span class="nx">season</span><span class="p">,</span> <span class="nx">when</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="nx">are</span> <span class="nx">handling</span> <span class="nx">millions</span> <span class="nx">of</span> <span class="nx">requests</span> <span class="nx">a</span> <span class="nx">day</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">bootstrapping</span> 
<span class="nx">has</span> <span class="nx">taken</span> <span class="nx">almost</span> <span class="nx">a</span> <span class="nx">day</span> <span class="nx">to</span> <span class="nx">complete</span><span class="p">.</span> <span class="nx">Second</span><span class="p">,</span> <span class="nx">when</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">joins</span><span class="o">/</span><span class="nx">leaves</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">ranges</span> 
<span class="nx">handled</span> <span class="nx">by</span> <span class="nx">many</span> <span class="nx">nodes</span> <span class="nx">change</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">Merkle</span> <span class="nx">trees</span> <span class="k">for</span> <span class="nx">the</span> <span class="k">new</span> <span class="nx">ranges</span> <span class="nx">need</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">recalculated</span><span class="p">,</span> 
<span class="nx">which</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">non</span><span class="o">-</span><span class="nx">trivial</span> <span class="nx">operation</span> <span class="nx">to</span> <span class="nx">perform</span> <span class="nx">on</span> <span class="nx">a</span> <span class="nx">production</span> <span class="nx">system</span><span class="p">.</span> <span class="nx">Finally</span><span class="p">,</span> <span class="nx">there</span> <span class="nx">was</span> <span class="nx">no</span> <span class="nx">easy</span> 
<span class="nx">way</span> <span class="nx">to</span> <span class="nx">take</span> <span class="nx">a</span> <span class="nx">snapshot</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nx">key</span> <span class="nx">space</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">randomness</span> <span class="k">in</span> <span class="nx">key</span> <span class="nx">ranges</span><span class="p">,</span> <span class="nx">and</span> <span class="k">this</span> 
<span class="nx">made</span> <span class="nx">the</span> <span class="nx">process</span> <span class="nx">of</span> <span class="nx">archival</span> <span class="nx">complicated</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">scheme</span><span class="p">,</span> <span class="nx">archiving</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nx">key</span> <span class="nx">space</span> <span class="nx">requires</span> 
<span class="nx">us</span> <span class="nx">to</span> <span class="nx">retrieve</span> <span class="nx">the</span> <span class="nx">keys</span> <span class="nx">from</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">separately</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">is</span> <span class="nx">highly</span> <span class="nx">inefficient</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">fundamental</span> <span class="nx">issue</span> <span class="kd">with</span> <span class="k">this</span> <span class="nx">strategy</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">schemes</span> <span class="k">for</span> <span class="nx">data</span> <span class="nx">partitioning</span> <span class="nx">and</span> <span class="nx">data</span> 
<span class="nx">placement</span> <span class="nx">are</span> <span class="nx">intertwined</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="k">in</span> <span class="nx">some</span> <span class="nx">cases</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">preferred</span> <span class="nx">to</span> <span class="nx">add</span> <span class="nx">more</span> <span class="nx">nodes</span> <span class="nx">to</span> 
<span class="nx">the</span> <span class="nx">system</span> <span class="k">in</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">handle</span> <span class="nx">an</span> <span class="nx">increase</span> <span class="k">in</span> <span class="nx">request</span> <span class="nx">load</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">scenario</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">not</span> 
<span class="nx">possible</span> <span class="nx">to</span> <span class="nx">add</span> <span class="nx">nodes</span> <span class="nx">without</span> <span class="nx">affecting</span> <span class="nx">data</span> <span class="nx">partitioning</span><span class="p">.</span> <span class="nx">Ideally</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">desirable</span> <span class="nx">to</span> <span class="nx">use</span> 
<span class="nx">independent</span> <span class="nx">schemes</span> <span class="k">for</span> <span class="nx">partitioning</span> <span class="nx">and</span> <span class="nx">placement</span><span class="p">.</span> <span class="nx">To</span> <span class="k">this</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">following</span> <span class="nx">strategies</span> <span class="nx">were</span> <span class="nx">evaluated</span><span class="o">:</span>

<span class="nx">Strategy</span> <span class="mi">2</span><span class="o">:</span> <span class="nx">T</span> <span class="nx">random</span> <span class="nx">tokens</span> <span class="nx">per</span> <span class="nx">node</span> <span class="nx">and</span> <span class="nx">equal</span> <span class="nx">sized</span> <span class="nx">partitions</span><span class="o">:</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">strategy</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">hash</span> <span class="nx">space</span> 
<span class="nx">is</span> <span class="nx">divided</span> <span class="nx">into</span> <span class="nx">Q</span> <span class="nx">equally</span> <span class="nx">sized</span> <span class="nx">partitions</span><span class="o">/</span><span class="nx">ranges</span> <span class="nx">and</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">T</span> <span class="nx">random</span> <span class="nx">tokens</span><span class="p">.</span> <span class="nx">Q</span> <span class="nx">is</span> 
<span class="nx">usually</span> <span class="nx">set</span> <span class="nx">such</span> <span class="nx">that</span> <span class="nx">Q</span> <span class="o">&gt;&gt;</span> <span class="nx">N</span> <span class="nx">and</span> <span class="nx">Q</span> <span class="o">&gt;&gt;</span> <span class="nx">S</span><span class="o">*</span><span class="nx">T</span><span class="p">,</span> <span class="nx">where</span> <span class="nx">S</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> 
<span class="nx">strategy</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">tokens</span> <span class="nx">are</span> <span class="nx">only</span> <span class="nx">used</span> <span class="nx">to</span> <span class="nx">build</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">that</span> <span class="nx">maps</span> <span class="nx">values</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">hash</span> <span class="nx">space</span> <span class="nx">to</span> <span class="nx">the</span> 
<span class="nx">ordered</span> <span class="nx">lists</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">and</span> <span class="nx">not</span> <span class="nx">to</span> <span class="nx">decide</span> <span class="nx">the</span> <span class="nx">partitioning</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">partition</span> <span class="nx">is</span> <span class="nx">placed</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">first</span> <span class="nx">N</span> <span class="nx">unique</span> 
<span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">are</span> <span class="nx">encountered</span> <span class="k">while</span> <span class="nx">walking</span> <span class="nx">the</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="nx">ring</span> <span class="nx">clockwise</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">partition</span><span class="p">.</span> <span class="nx">Figure</span> <span class="mi">7</span> <span class="nx">illustrates</span> <span class="k">this</span> <span class="nx">strategy</span> <span class="k">for</span> <span class="nx">N</span><span class="o">=</span><span class="mi">3</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">example</span><span class="p">,</span> <span class="nx">nodes</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span> <span class="nx">are</span> <span class="nx">encountered</span> 
<span class="k">while</span> <span class="nx">walking</span> <span class="nx">the</span> <span class="nx">ring</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">partition</span> <span class="nx">that</span> <span class="nx">contains</span> <span class="nx">key</span> <span class="nx">k1</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">primary</span> <span class="nx">advantages</span> <span class="nx">of</span> 
<span class="k">this</span> <span class="nx">strategy</span> <span class="nx">are</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">decoupling</span> <span class="nx">of</span> <span class="nx">partitioning</span> <span class="nx">and</span> <span class="nx">partition</span> <span class="nx">placement</span><span class="p">,</span> <span class="nx">and</span> <span class="p">(</span><span class="nx">ii</span><span class="p">)</span> <span class="nx">enabling</span> <span class="nx">the</span> 
<span class="nx">possibility</span> <span class="nx">of</span> <span class="nx">changing</span> <span class="nx">the</span> <span class="nx">placement</span> <span class="nx">scheme</span> <span class="nx">at</span> <span class="nx">runtime</span><span class="p">.</span>

<span class="nx">Figure</span> <span class="mi">7</span><span class="o">:</span> <span class="nx">Partitioning</span> <span class="nx">and</span> <span class="nx">placement</span> <span class="nx">of</span> <span class="nx">keys</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">three</span> <span class="nx">strategies</span><span class="p">.</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">C</span> <span class="nx">depict</span> <span class="nx">the</span> <span class="nx">three</span> 
<span class="nx">unique</span> <span class="nx">nodes</span> <span class="nx">that</span> <span class="nx">form</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">k1</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">consistent</span> <span class="nx">hashing</span> <span class="nx">ring</span> <span class="p">(</span><span class="nx">N</span><span class="o">=</span><span class="mi">3</span><span class="p">).</span> <span class="nx">The</span> 
<span class="nx">shaded</span> <span class="nx">area</span> <span class="nx">indicates</span> <span class="nx">the</span> <span class="nx">key</span> <span class="nx">range</span> <span class="k">for</span> <span class="nx">which</span> <span class="nx">nodes</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">C</span> <span class="nx">form</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">.</span> <span class="nx">Dark</span> <span class="nx">arrows</span> 
<span class="nx">indicate</span> <span class="nx">the</span> <span class="nx">token</span> <span class="nx">locations</span> <span class="k">for</span> <span class="nx">various</span> <span class="nx">nodes</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Next two paragraphs</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Strategy</span> <span class="mi">3</span><span class="o">:</span> <span class="nx">Q</span><span class="o">/</span><span class="nx">S</span> <span class="nx">tokens</span> <span class="nx">per</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">equal</span><span class="o">-</span><span class="nx">sized</span> <span class="nx">partitions</span><span class="o">:</span> <span class="nx">Similar</span> <span class="nx">to</span> <span class="nx">strategy</span> <span class="mi">2</span><span class="p">,</span> <span class="k">this</span> <span class="nx">strategy</span> 
<span class="nx">divides</span> <span class="nx">the</span> <span class="nx">hash</span> <span class="nx">space</span> <span class="nx">into</span> <span class="nx">Q</span> <span class="nx">equally</span> <span class="nx">sized</span> <span class="nx">partitions</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">placement</span> <span class="nx">of</span> <span class="nx">partition</span> <span class="nx">is</span> <span class="nx">decoupled</span> 
<span class="nx">from</span> <span class="nx">the</span> <span class="nx">partitioning</span> <span class="nx">scheme</span><span class="p">.</span> <span class="nx">Moreover</span><span class="p">,</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">Q</span><span class="o">/</span><span class="nx">S</span> <span class="nx">tokens</span> <span class="nx">where</span> <span class="nx">S</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> 
<span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">.</span> <span class="nx">When</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">leaves</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">,</span> <span class="nx">its</span> <span class="nx">tokens</span> <span class="nx">are</span> <span class="nx">randomly</span> <span class="nx">distributed</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">remaining</span> 
<span class="nx">nodes</span> <span class="nx">such</span> <span class="nx">that</span> <span class="nx">these</span> <span class="nx">properties</span> <span class="nx">are</span> <span class="nx">preserved</span><span class="p">.</span> <span class="nx">Similarly</span><span class="p">,</span> <span class="nx">when</span> <span class="nx">a</span> <span class="nx">node</span> <span class="nx">joins</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">it</span> <span class="s2">&quot;steals&quot;</span> 
<span class="nx">tokens</span> <span class="nx">from</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">way</span> <span class="nx">that</span> <span class="nx">preserves</span> <span class="nx">these</span> <span class="nx">properties</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">efficiency</span> <span class="nx">of</span> <span class="nx">these</span> <span class="nx">three</span> <span class="nx">strategies</span> <span class="nx">is</span> <span class="nx">evaluated</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">system</span> <span class="kd">with</span> <span class="nx">S</span><span class="o">=</span><span class="mi">30</span> <span class="nx">and</span> <span class="nx">N</span><span class="o">=</span><span class="mi">3</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> 
<span class="nx">comparing</span> <span class="nx">these</span> <span class="nx">different</span> <span class="nx">strategies</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">fair</span> <span class="nx">manner</span> <span class="nx">is</span> <span class="nx">hard</span> <span class="nx">as</span> <span class="nx">different</span> <span class="nx">strategies</span> <span class="nx">have</span> <span class="nx">different</span> 
<span class="nx">configurations</span> <span class="nx">to</span> <span class="nx">tune</span> <span class="nx">their</span> <span class="nx">efficiency</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">distribution</span> <span class="nx">property</span> <span class="nx">of</span> <span class="nx">strategy</span> <span class="mi">1</span> 
<span class="nx">depends</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">tokens</span> <span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">T</span><span class="p">)</span> <span class="k">while</span> <span class="nx">strategy</span> <span class="mi">3</span> <span class="nx">depends</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">partitions</span> 
<span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">e</span><span class="p">.,</span> <span class="nx">Q</span><span class="p">).</span> <span class="nx">One</span> <span class="nx">fair</span> <span class="nx">way</span> <span class="nx">to</span> <span class="nx">compare</span> <span class="nx">these</span> <span class="nx">strategies</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">evaluate</span> <span class="nx">the</span> <span class="nx">skew</span> <span class="k">in</span> <span class="nx">their</span> <span class="nx">load</span> <span class="nx">distribution</span> 
<span class="k">while</span> <span class="nx">all</span> <span class="nx">strategies</span> <span class="nx">use</span> <span class="nx">the</span> <span class="nx">same</span> <span class="nx">amount</span> <span class="nx">of</span> <span class="nx">space</span> <span class="nx">to</span> <span class="nx">maintain</span> <span class="nx">their</span> <span class="nx">membership</span> <span class="nx">information</span><span class="p">.</span> <span class="nx">For</span> 
<span class="nx">instance</span><span class="p">,</span> <span class="k">in</span> <span class="nx">strategy</span> <span class="mi">1</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">maintain</span> <span class="nx">the</span> <span class="nx">token</span> <span class="nx">positions</span> <span class="nx">of</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> 
<span class="nx">ring</span> <span class="nx">and</span> <span class="k">in</span> <span class="nx">strategy</span> <span class="mi">3</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">maintain</span> <span class="nx">the</span> <span class="nx">information</span> <span class="nx">regarding</span> <span class="nx">the</span> <span class="nx">partitions</span> <span class="nx">assigned</span> 
<span class="nx">to</span> <span class="nx">each</span> <span class="nx">node</span><span class="p">.</span>

<span class="nx">In</span> <span class="nx">our</span> <span class="nx">next</span> <span class="nx">experiment</span><span class="p">,</span> <span class="nx">these</span> <span class="nx">strategies</span> <span class="nx">were</span> <span class="nx">evaluated</span> <span class="nx">by</span> <span class="nx">varying</span> <span class="nx">the</span> <span class="nx">relevant</span> <span class="nx">parameters</span> 
<span class="p">(</span><span class="nx">T</span> <span class="nx">and</span> <span class="nx">Q</span><span class="p">).</span> <span class="nx">The</span> <span class="nx">load</span> <span class="nx">balancing</span> <span class="nx">efficiency</span> <span class="nx">of</span> <span class="nx">each</span> <span class="nx">strategy</span> <span class="nx">was</span> <span class="nx">measured</span> <span class="k">for</span> <span class="nx">different</span> <span class="nx">sizes</span> <span class="nx">of</span> 
<span class="nx">membership</span> <span class="nx">information</span> <span class="nx">that</span> <span class="nx">needs</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">maintained</span> <span class="nx">at</span> <span class="nx">each</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">where</span> <span class="nx">Load</span> <span class="nx">balancing</span> <span class="nx">efficiency</span> 
<span class="nx">is</span> <span class="nx">defined</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">ratio</span> <span class="nx">of</span> <span class="nx">average</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">requests</span> <span class="nx">served</span> <span class="nx">by</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">maximum</span> <span class="nx">number</span> 
<span class="nx">of</span> <span class="nx">requests</span> <span class="nx">served</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">hottest</span> <span class="nx">node</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">results</span> <span class="nx">are</span> <span class="nx">given</span> <span class="k">in</span> <span class="nx">Figure</span> <span class="mi">8</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">seen</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">figure</span><span class="p">,</span> <span class="nx">strategy</span> <span class="mi">3</span> <span class="nx">achieves</span> <span class="nx">the</span> <span class="nx">best</span> <span class="nx">load</span> 
<span class="nx">balancing</span> <span class="nx">efficiency</span> <span class="nx">and</span> <span class="nx">strategy</span> <span class="mi">2</span> <span class="nx">has</span> <span class="nx">the</span> <span class="nx">worst</span> <span class="nx">load</span> <span class="nx">balancing</span> <span class="nx">efficiency</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">a</span> <span class="nx">brief</span> <span class="nx">time</span><span class="p">,</span> 
<span class="nx">Strategy</span> <span class="mi">2</span> <span class="nx">served</span> <span class="nx">as</span> <span class="nx">an</span> <span class="nx">interim</span> <span class="nx">setup</span> <span class="nx">during</span> <span class="nx">the</span> <span class="nx">process</span> <span class="nx">of</span> <span class="nx">migrating</span> <span class="nx">Dynamo</span> <span class="nx">instances</span> <span class="nx">from</span> 
<span class="nx">using</span> <span class="nx">Strategy</span> <span class="mi">1</span> <span class="nx">to</span> <span class="nx">Strategy</span> <span class="mi">3</span><span class="p">.</span> <span class="nx">Compared</span> <span class="nx">to</span> <span class="nx">Strategy</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">Strategy</span> <span class="mi">3</span> <span class="nx">achieves</span> <span class="nx">better</span> <span class="nx">efficiency</span> 
<span class="nx">and</span> <span class="nx">reduces</span> <span class="nx">the</span> <span class="nx">size</span> <span class="nx">of</span> <span class="nx">membership</span> <span class="nx">information</span> <span class="nx">maintained</span> <span class="nx">at</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">by</span> <span class="nx">three</span> <span class="nx">orders</span> <span class="nx">of</span> 
<span class="nx">magnitude</span><span class="p">.</span> <span class="nx">While</span> <span class="nx">storage</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">a</span> <span class="nx">major</span> <span class="nx">issue</span> <span class="nx">the</span> <span class="nx">nodes</span> <span class="nx">gossip</span> <span class="nx">the</span> <span class="nx">membership</span> <span class="nx">information</span> 
<span class="nx">periodically</span> <span class="nx">and</span> <span class="nx">as</span> <span class="nx">such</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">desirable</span> <span class="nx">to</span> <span class="nx">keep</span> <span class="k">this</span> <span class="nx">information</span> <span class="nx">as</span> <span class="nx">compact</span> <span class="nx">as</span> <span class="nx">possible</span><span class="p">.</span> 
<span class="nx">In</span> <span class="nx">addition</span> <span class="nx">to</span> <span class="k">this</span><span class="p">,</span> <span class="nx">strategy</span> <span class="mi">3</span> <span class="nx">is</span> <span class="nx">advantageous</span> <span class="nx">and</span> <span class="nx">simpler</span> <span class="nx">to</span> <span class="nx">deploy</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">following</span> 
<span class="nx">reasons</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="nx">Faster</span> <span class="nx">bootstrapping</span><span class="o">/</span><span class="nx">recovery</span><span class="o">:</span> <span class="nx">Since</span> <span class="nx">partition</span> <span class="nx">ranges</span> <span class="nx">are</span> <span class="nx">fixed</span><span class="p">,</span> <span class="nx">they</span> <span class="nx">can</span> <span class="nx">be</span> 
<span class="nx">stored</span> <span class="k">in</span> <span class="nx">separate</span> <span class="nx">files</span><span class="p">,</span> <span class="nx">meaning</span> <span class="nx">a</span> <span class="nx">partition</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">relocated</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">unit</span> <span class="nx">by</span> <span class="nx">simply</span> <span class="nx">transferring</span> 
<span class="nx">the</span> <span class="nx">file</span> <span class="p">(</span><span class="nx">avoiding</span> <span class="nx">random</span> <span class="nx">accesses</span> <span class="nx">needed</span> <span class="nx">to</span> <span class="nx">locate</span> <span class="nx">specific</span> <span class="nx">items</span><span class="p">).</span> <span class="nx">This</span> <span class="nx">simplifies</span> <span class="nx">the</span> <span class="nx">process</span> 
<span class="nx">of</span> <span class="nx">bootstrapping</span> <span class="nx">and</span> <span class="nx">recovery</span><span class="p">.</span> <span class="p">(</span><span class="nx">ii</span><span class="p">)</span> <span class="nx">Ease</span> <span class="nx">of</span> <span class="nx">archival</span><span class="o">:</span> <span class="nx">Periodical</span> <span class="nx">archiving</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">dataset</span> <span class="nx">is</span> <span class="nx">a</span> 
<span class="nx">mandatory</span> <span class="nx">requirement</span> <span class="k">for</span> <span class="nx">most</span> <span class="nx">of</span> <span class="nx">Amazon</span> <span class="nx">storage</span> <span class="nx">services</span><span class="p">.</span> <span class="nx">Archiving</span> <span class="nx">the</span> <span class="nx">entire</span> <span class="nx">dataset</span> <span class="nx">stored</span> 
<span class="nx">by</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">simpler</span> <span class="k">in</span> <span class="nx">strategy</span> <span class="mi">3</span> <span class="nx">because</span> <span class="nx">the</span> <span class="nx">partition</span> <span class="nx">files</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">archived</span> <span class="nx">separately</span><span class="p">.</span> <span class="nx">By</span> 
<span class="nx">contrast</span><span class="p">,</span> <span class="k">in</span> <span class="nx">Strategy</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">tokens</span> <span class="nx">are</span> <span class="nx">chosen</span> <span class="nx">randomly</span> <span class="nx">and</span><span class="p">,</span> <span class="nx">archiving</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">stored</span> <span class="k">in</span> <span class="nx">Dynamo</span> 
<span class="nx">requires</span> <span class="nx">retrieving</span> <span class="nx">the</span> <span class="nx">keys</span> <span class="nx">from</span> <span class="nx">individual</span> <span class="nx">nodes</span> <span class="nx">separately</span> <span class="nx">and</span> <span class="nx">is</span> <span class="nx">usually</span> <span class="nx">inefficient</span> <span class="nx">and</span> 
<span class="nx">slow</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">disadvantage</span> <span class="nx">of</span> <span class="nx">strategy</span> <span class="mi">3</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">changing</span> <span class="nx">the</span> <span class="nx">node</span> <span class="nx">membership</span> <span class="nx">requires</span> <span class="nx">coordination</span> 
<span class="k">in</span> <span class="nx">order</span> <span class="nx">to</span> <span class="nx">preserve</span> <span class="nx">the</span> <span class="nx">properties</span> <span class="nx">required</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">assignment</span><span class="p">.</span>


<span class="nx">Figure</span> <span class="mi">8</span><span class="o">:</span> <span class="nx">Comparison</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">distribution</span> <span class="nx">efficiency</span> <span class="nx">of</span> <span class="nx">different</span> <span class="nx">strategies</span> <span class="k">for</span> <span class="nx">system</span> <span class="kd">with</span> <span class="mi">30</span> 
<span class="nx">nodes</span> <span class="nx">and</span> <span class="nx">N</span><span class="o">=</span><span class="mi">3</span> <span class="kd">with</span> <span class="nx">equal</span> <span class="nx">amount</span> <span class="nx">of</span> <span class="nx">metadata</span> <span class="nx">maintained</span> <span class="nx">at</span> <span class="nx">each</span> <span class="nx">node</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">values</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">size</span> 
<span class="nx">and</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">replicas</span> <span class="nx">are</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">typical</span> <span class="nx">configuration</span> <span class="nx">deployed</span> <span class="k">for</span> <span class="nx">majority</span> <span class="nx">of</span> <span class="nx">our</span> <span class="nx">services</span><span class="p">.</span>

<span class="mf">6.3</span> <span class="nx">Divergent</span> <span class="nx">Versions</span><span class="o">:</span> <span class="nx">When</span> <span class="nx">and</span> <span class="nx">How</span> <span class="nx">Many</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Next two paragraphs</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">As</span> <span class="nx">noted</span> <span class="nx">earlier</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">designed</span> <span class="nx">to</span> <span class="nx">tradeoff</span> <span class="nx">consistency</span> <span class="k">for</span> <span class="nx">availability</span><span class="p">.</span> <span class="nx">To</span> <span class="nx">understand</span> <span class="nx">the</span> 
<span class="nx">precise</span> <span class="nx">impact</span> <span class="nx">of</span> <span class="nx">different</span> <span class="nx">failures</span> <span class="nx">on</span> <span class="nx">consistency</span><span class="p">,</span> <span class="nx">detailed</span> <span class="nx">data</span> <span class="nx">is</span> <span class="nx">required</span> <span class="nx">on</span> <span class="nx">multiple</span> <span class="nx">factors</span><span class="o">:</span> 
<span class="nx">outage</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">type</span> <span class="nx">of</span> <span class="nx">failure</span><span class="p">,</span> <span class="nx">component</span> <span class="nx">reliability</span><span class="p">,</span> <span class="nx">workload</span> <span class="nx">etc</span><span class="p">.</span> <span class="nx">Presenting</span> <span class="nx">these</span> <span class="nx">numbers</span> <span class="k">in</span> 
<span class="nx">detail</span> <span class="nx">is</span> <span class="nx">outside</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">scope</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">paper</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="k">this</span> <span class="nx">section</span> <span class="nx">discusses</span> <span class="nx">a</span> <span class="nx">good</span> <span class="nx">summary</span> <span class="nx">metric</span><span class="o">:</span> 
<span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">divergent</span> <span class="nx">versions</span> <span class="nx">seen</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">application</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">live</span> <span class="nx">production</span> <span class="nx">environment</span><span class="p">.</span>

<span class="nx">Divergent</span> <span class="nx">versions</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">data</span> <span class="nx">item</span> <span class="nx">arise</span> <span class="k">in</span> <span class="nx">two</span> <span class="nx">scenarios</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">first</span> <span class="nx">is</span> <span class="nx">when</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">is</span> <span class="nx">facing</span> 
<span class="nx">failure</span> <span class="nx">scenarios</span> <span class="nx">such</span> <span class="nx">as</span> <span class="nx">node</span> <span class="nx">failures</span><span class="p">,</span> <span class="nx">data</span> <span class="nx">center</span> <span class="nx">failures</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">network</span> <span class="nx">partitions</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">second</span> <span class="nx">is</span> 
<span class="nx">when</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">is</span> <span class="nx">handling</span> <span class="nx">a</span> <span class="nx">large</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">concurrent</span> <span class="nx">writers</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">data</span> <span class="nx">item</span> <span class="nx">and</span> <span class="nx">multiple</span> 
<span class="nx">nodes</span> <span class="nx">end</span> <span class="nx">up</span> <span class="nx">coordinating</span> <span class="nx">the</span> <span class="nx">updates</span> <span class="nx">concurrently</span><span class="p">.</span> <span class="nx">From</span> <span class="nx">both</span> <span class="nx">a</span> <span class="nx">usability</span> <span class="nx">and</span> <span class="nx">efficiency</span> <span class="nx">perspective</span><span class="p">,</span> 
<span class="nx">it</span> <span class="nx">is</span> <span class="nx">preferred</span> <span class="nx">to</span> <span class="nx">keep</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">divergent</span> <span class="nx">versions</span> <span class="nx">at</span> <span class="nx">any</span> <span class="nx">given</span> <span class="nx">time</span> <span class="nx">as</span> <span class="nx">low</span> <span class="nx">as</span> <span class="nx">possible</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">the</span> 
<span class="nx">versions</span> <span class="nx">cannot</span> <span class="nx">be</span> <span class="nx">syntactically</span> <span class="nx">reconciled</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">vector</span> <span class="nx">clocks</span> <span class="nx">alone</span><span class="p">,</span> <span class="nx">they</span> <span class="nx">have</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">passed</span> <span class="nx">to</span> 
<span class="nx">the</span> <span class="nx">business</span> <span class="nx">logic</span> <span class="k">for</span> <span class="nx">semantic</span> <span class="nx">reconciliation</span><span class="p">.</span> <span class="nx">Semantic</span> <span class="nx">reconciliation</span> <span class="nx">introduces</span> <span class="nx">additional</span> <span class="nx">load</span> <span class="nx">on</span> 
<span class="nx">services</span><span class="p">,</span> <span class="nx">so</span> <span class="nx">it</span> <span class="nx">is</span> <span class="nx">desirable</span> <span class="nx">to</span> <span class="nx">minimize</span> <span class="nx">the</span> <span class="nx">need</span> <span class="k">for</span> <span class="nx">it</span><span class="p">.</span>

<span class="nx">In</span> <span class="nx">our</span> <span class="nx">next</span> <span class="nx">experiment</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">versions</span> <span class="nx">returned</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">shopping</span> <span class="nx">cart</span> <span class="nx">service</span> <span class="nx">was</span> <span class="nx">profiled</span> 
<span class="k">for</span> <span class="nx">a</span> <span class="nx">period</span> <span class="nx">of</span> <span class="mi">24</span> <span class="nx">hours</span><span class="p">.</span> <span class="nx">During</span> <span class="k">this</span> <span class="nx">period</span><span class="p">,</span> <span class="mf">99.94</span><span class="o">%</span> <span class="nx">of</span> <span class="nx">requests</span> <span class="nx">saw</span> <span class="nx">exactly</span> <span class="nx">one</span> <span class="nx">version</span><span class="p">;</span> <span class="mf">0.00057</span><span class="o">%</span> 
<span class="nx">of</span> <span class="nx">requests</span> <span class="nx">saw</span> <span class="mi">2</span> <span class="nx">versions</span><span class="p">;</span> <span class="mf">0.00047</span><span class="o">%</span> <span class="nx">of</span> <span class="nx">requests</span> <span class="nx">saw</span> <span class="mi">3</span> <span class="nx">versions</span> <span class="nx">and</span> <span class="mf">0.00009</span><span class="o">%</span> <span class="nx">of</span> <span class="nx">requests</span> <span class="nx">saw</span> <span class="mi">4</span> 
<span class="nx">versions</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">shows</span> <span class="nx">that</span> <span class="nx">divergent</span> <span class="nx">versions</span> <span class="nx">are</span> <span class="nx">created</span> <span class="nx">rarely</span><span class="p">.</span>

<span class="nx">Experience</span> <span class="nx">shows</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">increase</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">divergent</span> <span class="nx">versions</span> <span class="nx">is</span> <span class="nx">contributed</span> <span class="nx">not</span> <span class="nx">by</span> 
<span class="nx">failures</span> <span class="nx">but</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">increase</span> <span class="k">in</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">concurrent</span> <span class="nx">writers</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">increase</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">number</span> 
<span class="nx">of</span> <span class="nx">concurrent</span> <span class="nx">writes</span> <span class="nx">is</span> <span class="nx">usually</span> <span class="nx">triggered</span> <span class="nx">by</span> <span class="nx">busy</span> <span class="nx">robots</span> <span class="p">(</span><span class="nx">automated</span> <span class="nx">client</span> <span class="nx">programs</span><span class="p">)</span> <span class="nx">and</span> 
<span class="nx">rarely</span> <span class="nx">by</span> <span class="nx">humans</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">issue</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">discussed</span> <span class="k">in</span> <span class="nx">detail</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">sensitive</span> <span class="nx">nature</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">story</span><span class="p">.</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Next paragraph </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="mf">6.4</span> <span class="nx">Client</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">or</span> <span class="nx">Server</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">Coordination</span>

<span class="nx">As</span> <span class="nx">mentioned</span> <span class="k">in</span> <span class="nx">Section</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">has</span> <span class="nx">a</span> <span class="nx">request</span> <span class="nx">coordination</span> <span class="nx">component</span> <span class="nx">that</span> <span class="nx">uses</span> <span class="nx">a</span> <span class="nx">state</span> 
<span class="nx">machine</span> <span class="nx">to</span> <span class="nx">handle</span> <span class="nx">incoming</span> <span class="nx">requests</span><span class="p">.</span> <span class="nx">Client</span> <span class="nx">requests</span> <span class="nx">are</span> <span class="nx">uniformly</span> <span class="nx">assigned</span> <span class="nx">to</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> 
<span class="nx">ring</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">load</span> <span class="nx">balancer</span><span class="p">.</span> <span class="nx">Any</span> <span class="nx">Dynamo</span> <span class="nx">node</span> <span class="nx">can</span> <span class="nx">act</span> <span class="nx">as</span> <span class="nx">a</span> <span class="nx">coordinator</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">read</span> <span class="nx">request</span><span class="p">.</span> <span class="nx">Write</span> 
<span class="nx">requests</span> <span class="nx">on</span> <span class="nx">the</span> <span class="nx">other</span> <span class="nx">hand</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">coordinated</span> <span class="nx">by</span> <span class="nx">a</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">key</span><span class="err">’</span><span class="nx">s</span> <span class="nx">current</span> <span class="nx">preference</span> <span class="nx">list</span><span class="p">.</span> 
<span class="nx">This</span> <span class="nx">restriction</span> <span class="nx">is</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">fact</span> <span class="nx">that</span> <span class="nx">these</span> <span class="nx">preferred</span> <span class="nx">nodes</span> <span class="nx">have</span> <span class="nx">the</span> <span class="nx">added</span> <span class="nx">responsibility</span> 
<span class="nx">of</span> <span class="nx">creating</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">version</span> <span class="nx">stamp</span> <span class="nx">that</span> <span class="nx">causally</span> <span class="nx">subsumes</span> <span class="nx">the</span> <span class="nx">version</span> <span class="nx">that</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">updated</span> <span class="nx">by</span> 
<span class="nx">the</span> <span class="nx">write</span> <span class="nx">request</span><span class="p">.</span> <span class="nx">Note</span> <span class="nx">that</span> <span class="k">if</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">versioning</span> <span class="nx">scheme</span> <span class="nx">is</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">physical</span> <span class="nx">timestamps</span><span class="p">,</span> 
<span class="nx">any</span> <span class="nx">node</span> <span class="nx">can</span> <span class="nx">coordinate</span> <span class="nx">a</span> <span class="nx">write</span> <span class="nx">request</span><span class="p">.</span>

<span class="nx">An</span> <span class="nx">alternative</span> <span class="nx">approach</span> <span class="nx">to</span> <span class="nx">request</span> <span class="nx">coordination</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">move</span> <span class="nx">the</span> <span class="nx">state</span> <span class="nx">machine</span> <span class="nx">to</span> <span class="nx">the</span> 
<span class="nx">client</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">In</span> <span class="k">this</span> <span class="nx">scheme</span> <span class="nx">client</span> <span class="nx">applications</span> <span class="nx">use</span> <span class="nx">a</span> <span class="nx">library</span> <span class="nx">to</span> <span class="nx">perform</span> <span class="nx">request</span> 
<span class="nx">coordination</span> <span class="nx">locally</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">client</span> <span class="nx">periodically</span> <span class="nx">picks</span> <span class="nx">a</span> <span class="nx">random</span> <span class="nx">Dynamo</span> <span class="nx">node</span> <span class="nx">and</span> <span class="nx">downloads</span> 
<span class="nx">its</span> <span class="nx">current</span> <span class="nx">view</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="nx">membership</span> <span class="nx">state</span><span class="p">.</span> <span class="nx">Using</span> <span class="k">this</span> <span class="nx">information</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">can</span> 
<span class="nx">determine</span> <span class="nx">which</span> <span class="nx">set</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">form</span> <span class="nx">the</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="k">for</span> <span class="nx">any</span> <span class="nx">given</span> <span class="nx">key</span><span class="p">.</span> <span class="nx">Read</span> <span class="nx">requests</span> 
<span class="nx">can</span> <span class="nx">be</span> <span class="nx">coordinated</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">node</span> <span class="nx">thereby</span> <span class="nx">avoiding</span> <span class="nx">the</span> <span class="nx">extra</span> <span class="nx">network</span> <span class="nx">hop</span> <span class="nx">that</span> <span class="nx">is</span> 
<span class="nx">incurred</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">request</span> <span class="nx">were</span> <span class="nx">assigned</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">random</span> <span class="nx">Dynamo</span> <span class="nx">node</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">balancer</span><span class="p">.</span> 
<span class="nx">Writes</span> <span class="nx">will</span> <span class="nx">either</span> <span class="nx">be</span> <span class="nx">forwarded</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">key</span><span class="err">’</span><span class="nx">s</span> <span class="nx">preference</span> <span class="nx">list</span> <span class="nx">or</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">coordinated</span> 
<span class="nx">locally</span> <span class="k">if</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">using</span> <span class="nx">timestamps</span> <span class="nx">based</span> <span class="nx">versioning</span><span class="p">.</span>

<span class="nx">An</span> <span class="nx">important</span> <span class="nx">advantage</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">client</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">coordination</span> <span class="nx">approach</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">a</span> <span class="nx">load</span> <span class="nx">balancer</span> <span class="nx">is</span> <span class="nx">no</span> 
<span class="nx">longer</span> <span class="nx">required</span> <span class="nx">to</span> <span class="nx">uniformly</span> <span class="nx">distribute</span> <span class="nx">client</span> <span class="nx">load</span><span class="p">.</span> <span class="nx">Fair</span> <span class="nx">load</span> <span class="nx">distribution</span> <span class="nx">is</span> <span class="nx">implicitly</span> 
<span class="nx">guaranteed</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">near</span> <span class="nx">uniform</span> <span class="nx">assignment</span> <span class="nx">of</span> <span class="nx">keys</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">storage</span> <span class="nx">nodes</span><span class="p">.</span> <span class="nx">Obviously</span><span class="p">,</span> <span class="nx">the</span> 
<span class="nx">efficiency</span> <span class="nx">of</span> <span class="k">this</span> <span class="nx">scheme</span> <span class="nx">is</span> <span class="nx">dependent</span> <span class="nx">on</span> <span class="nx">how</span> <span class="nx">fresh</span> <span class="nx">the</span> <span class="nx">membership</span> <span class="nx">information</span> <span class="nx">is</span> <span class="nx">at</span> <span class="nx">the</span> 
<span class="nx">client</span><span class="p">.</span> <span class="nx">Currently</span> <span class="nx">clients</span> <span class="nx">poll</span> <span class="nx">a</span> <span class="nx">random</span> <span class="nx">Dynamo</span> <span class="nx">node</span> <span class="nx">every</span> <span class="mi">10</span> <span class="nx">seconds</span> <span class="k">for</span> <span class="nx">membership</span> <span class="nx">updates</span><span class="p">.</span> 
<span class="nx">A</span> <span class="nx">pull</span> <span class="nx">based</span> <span class="nx">approach</span> <span class="nx">was</span> <span class="nx">chosen</span> <span class="nx">over</span> <span class="nx">a</span> <span class="nx">push</span> <span class="nx">based</span> <span class="nx">one</span> <span class="nx">as</span> <span class="nx">the</span> <span class="nx">former</span> <span class="nx">scales</span> <span class="nx">better</span> <span class="kd">with</span> 
<span class="nx">large</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">clients</span> <span class="nx">and</span> <span class="nx">requires</span> <span class="nx">very</span> <span class="nx">little</span> <span class="nx">state</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">maintained</span> <span class="nx">at</span> <span class="nx">servers</span> <span class="nx">regarding</span> 
<span class="nx">clients</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">worst</span> <span class="k">case</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">exposed</span> <span class="nx">to</span> <span class="nx">stale</span> <span class="nx">membership</span> <span class="k">for</span> 
<span class="nx">duration</span> <span class="nx">of</span> <span class="mi">10</span> <span class="nx">seconds</span><span class="p">.</span> <span class="nx">In</span> <span class="k">case</span><span class="p">,</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">client</span> <span class="nx">detects</span> <span class="nx">its</span> <span class="nx">membership</span> <span class="nx">table</span> <span class="nx">is</span> <span class="nx">stale</span> 
<span class="p">(</span><span class="k">for</span> <span class="nx">instance</span><span class="p">,</span> <span class="nx">when</span> <span class="nx">some</span> <span class="nx">members</span> <span class="nx">are</span> <span class="nx">unreachable</span><span class="p">),</span> <span class="nx">it</span> <span class="nx">will</span> <span class="nx">immediately</span> <span class="nx">refresh</span> <span class="nx">its</span> <span class="nx">membership</span> 
<span class="nx">information</span><span class="p">.</span>

<span class="nx">Table</span> <span class="mi">2</span> <span class="nx">shows</span> <span class="nx">the</span> <span class="nx">latency</span> <span class="nx">improvements</span> <span class="nx">at</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">and</span> <span class="nx">averages</span> <span class="nx">that</span> <span class="nx">were</span> <span class="nx">observed</span> 
<span class="k">for</span> <span class="nx">a</span> <span class="nx">period</span> <span class="nx">of</span> <span class="mi">24</span> <span class="nx">hours</span> <span class="nx">using</span> <span class="nx">client</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">coordination</span> <span class="nx">compared</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">server</span><span class="o">-</span><span class="nx">driven</span> 
<span class="nx">approach</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">seen</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">client</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">coordination</span> <span class="nx">approach</span> <span class="nx">reduces</span> <span class="nx">the</span> <span class="nx">latencies</span> 
<span class="nx">by</span> <span class="nx">at</span> <span class="nx">least</span> <span class="mi">30</span> <span class="nx">milliseconds</span> <span class="k">for</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">latencies</span> <span class="nx">and</span> <span class="nx">decreases</span> <span class="nx">the</span> <span class="nx">average</span> <span class="nx">by</span> <span class="mi">3</span> <span class="nx">to</span> <span class="mi">4</span> 
<span class="nx">milliseconds</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">latency</span> <span class="nx">improvement</span> <span class="nx">is</span> <span class="nx">because</span> <span class="nx">the</span> <span class="nx">client</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">approach</span> <span class="nx">eliminates</span> <span class="nx">the</span> <span class="nx">overhead</span> 
<span class="nx">of</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">balancer</span> <span class="nx">and</span> <span class="nx">the</span> <span class="nx">extra</span> <span class="nx">network</span> <span class="nx">hop</span> <span class="nx">that</span> <span class="nx">may</span> <span class="nx">be</span> <span class="nx">incurred</span> <span class="nx">when</span> <span class="nx">a</span> <span class="nx">request</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">to</span> 
<span class="nx">a</span> <span class="nx">random</span> <span class="nx">node</span><span class="p">.</span> <span class="nx">As</span> <span class="nx">seen</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">average</span> <span class="nx">latencies</span> <span class="nx">tend</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">significantly</span> <span class="nx">lower</span> <span class="nx">than</span> <span class="nx">latencies</span> 
<span class="nx">at</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">because</span> <span class="nx">Dynamo</span><span class="err">’</span><span class="nx">s</span> <span class="nx">storage</span> <span class="nx">engine</span> <span class="nx">caches</span> <span class="nx">and</span> <span class="nx">write</span> <span class="nx">buffer</span> <span class="nx">have</span> <span class="nx">good</span> 
<span class="nx">hit</span> <span class="nx">ratios</span><span class="p">.</span> <span class="nx">Moreover</span><span class="p">,</span> <span class="nx">since</span> <span class="nx">the</span> <span class="nx">load</span> <span class="nx">balancers</span> <span class="nx">and</span> <span class="nx">network</span> <span class="nx">introduce</span> <span class="nx">additional</span> <span class="nx">variability</span> <span class="nx">to</span> <span class="nx">the</span> 
<span class="nx">response</span> <span class="nx">time</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">gain</span> <span class="k">in</span> <span class="nx">response</span> <span class="nx">time</span> <span class="nx">is</span> <span class="nx">higher</span> <span class="k">for</span> <span class="nx">the</span> <span class="mf">99.9</span><span class="nx">th</span> <span class="nx">percentile</span> <span class="nx">than</span> <span class="nx">the</span> <span class="nx">average</span><span class="p">.</span>

<span class="nx">Table</span> <span class="mi">2</span><span class="o">:</span> <span class="nx">Performance</span> <span class="nx">of</span> <span class="nx">client</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">and</span> <span class="nx">server</span><span class="o">-</span><span class="nx">driven</span> <span class="nx">coordination</span> <span class="nx">approaches</span><span class="p">.</span>


<span class="mf">6.5</span> <span class="nx">Balancing</span> <span class="nx">background</span> <span class="nx">vs</span><span class="p">.</span> <span class="nx">foreground</span> <span class="nx">tasks</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Riak does this, too. Explain explain. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Each</span> <span class="nx">node</span> <span class="nx">performs</span> <span class="nx">different</span> <span class="nx">kinds</span> <span class="nx">of</span> <span class="nx">background</span> <span class="nx">tasks</span> <span class="k">for</span> <span class="nx">replica</span> <span class="nx">synchronization</span> <span class="nx">and</span> <span class="nx">data</span> <span class="nx">handoff</span> 
<span class="p">(</span><span class="nx">either</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">hinting</span> <span class="nx">or</span> <span class="nx">adding</span><span class="o">/</span><span class="nx">removing</span> <span class="nx">nodes</span><span class="p">)</span> <span class="k">in</span> <span class="nx">addition</span> <span class="nx">to</span> <span class="nx">its</span> <span class="nx">normal</span> <span class="nx">foreground</span> <span class="nx">put</span><span class="o">/</span><span class="nx">get</span> 
<span class="nx">operations</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">early</span> <span class="nx">production</span> <span class="nx">settings</span><span class="p">,</span> <span class="nx">these</span> <span class="nx">background</span> <span class="nx">tasks</span> <span class="nx">triggered</span> <span class="nx">the</span> <span class="nx">problem</span> <span class="nx">of</span> <span class="nx">resource</span> 
<span class="nx">contention</span> <span class="nx">and</span> <span class="nx">affected</span> <span class="nx">the</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">regular</span> <span class="nx">put</span> <span class="nx">and</span> <span class="nx">get</span> <span class="nx">operations</span><span class="p">.</span> <span class="nx">Hence</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">became</span> 
<span class="nx">necessary</span> <span class="nx">to</span> <span class="nx">ensure</span> <span class="nx">that</span> <span class="nx">background</span> <span class="nx">tasks</span> <span class="nx">ran</span> <span class="nx">only</span> <span class="nx">when</span> <span class="nx">the</span> <span class="nx">regular</span> <span class="nx">critical</span> <span class="nx">operations</span> <span class="nx">are</span> <span class="nx">not</span> 
<span class="nx">affected</span> <span class="nx">significantly</span><span class="p">.</span> <span class="nx">To</span> <span class="k">this</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">background</span> <span class="nx">tasks</span> <span class="nx">were</span> <span class="nx">integrated</span> <span class="kd">with</span> <span class="nx">an</span> <span class="nx">admission</span> <span class="nx">control</span> 
<span class="nx">mechanism</span><span class="p">.</span> <span class="nx">Each</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">background</span> <span class="nx">tasks</span> <span class="nx">uses</span> <span class="k">this</span> <span class="nx">controller</span> <span class="nx">to</span> <span class="nx">reserve</span> <span class="nx">runtime</span> <span class="nx">slices</span> <span class="nx">of</span> <span class="nx">the</span> 
<span class="nx">resource</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span> <span class="nx">database</span><span class="p">),</span> <span class="nx">shared</span> <span class="nx">across</span> <span class="nx">all</span> <span class="nx">background</span> <span class="nx">tasks</span><span class="p">.</span> <span class="nx">A</span> <span class="nx">feedback</span> <span class="nx">mechanism</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">the</span> 
<span class="nx">monitored</span> <span class="nx">performance</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">foreground</span> <span class="nx">tasks</span> <span class="nx">is</span> <span class="nx">employed</span> <span class="nx">to</span> <span class="nx">change</span> <span class="nx">the</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">slices</span> <span class="nx">that</span> <span class="nx">are</span> 
<span class="nx">available</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">background</span> <span class="nx">tasks</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">admission</span> <span class="nx">controller</span> <span class="nx">constantly</span> <span class="nx">monitors</span> <span class="nx">the</span> <span class="nx">behavior</span> <span class="nx">of</span> <span class="nx">resource</span> <span class="nx">accesses</span> <span class="k">while</span> <span class="nx">executing</span> <span class="nx">a</span> 
<span class="s2">&quot;foreground&quot;</span> <span class="nx">put</span><span class="o">/</span><span class="nx">get</span> <span class="nx">operation</span><span class="p">.</span> <span class="nx">Monitored</span> <span class="nx">aspects</span> <span class="nx">include</span> <span class="nx">latencies</span> <span class="k">for</span> <span class="nx">disk</span> <span class="nx">operations</span><span class="p">,</span> <span class="nx">failed</span> <span class="nx">database</span> 
<span class="nx">accesses</span> <span class="nx">due</span> <span class="nx">to</span> <span class="nx">lock</span><span class="o">-</span><span class="nx">contention</span> <span class="nx">and</span> <span class="nx">transaction</span> <span class="nx">timeouts</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">request</span> <span class="nx">queue</span> <span class="nx">wait</span> <span class="nx">times</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">information</span> 
<span class="nx">is</span> <span class="nx">used</span> <span class="nx">to</span> <span class="nx">check</span> <span class="nx">whether</span> <span class="nx">the</span> <span class="nx">percentiles</span> <span class="nx">of</span> <span class="nx">latencies</span> <span class="p">(</span><span class="nx">or</span> <span class="nx">failures</span><span class="p">)</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">given</span> <span class="nx">trailing</span> <span class="nx">time</span> <span class="nb">window</span> <span class="nx">are</span> 
<span class="nx">close</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">desired</span> <span class="nx">threshold</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">example</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">background</span> <span class="nx">controller</span> <span class="nx">checks</span> <span class="nx">to</span> <span class="nx">see</span> <span class="nx">how</span> <span class="nx">close</span> <span class="nx">the</span> <span class="mi">99</span><span class="nx">th</span> 
<span class="nx">percentile</span> <span class="nx">database</span> <span class="nx">read</span> <span class="nx">latency</span> <span class="p">(</span><span class="nx">over</span> <span class="nx">the</span> <span class="nx">last</span> <span class="mi">60</span> <span class="nx">seconds</span><span class="p">)</span> <span class="nx">is</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">preset</span> <span class="nx">threshold</span> <span class="p">(</span><span class="nx">say</span> <span class="mi">50</span><span class="nx">ms</span><span class="p">).</span> <span class="nx">The</span> 
<span class="nx">controller</span> <span class="nx">uses</span> <span class="nx">such</span> <span class="nx">comparisons</span> <span class="nx">to</span> <span class="nx">assess</span> <span class="nx">the</span> <span class="nx">resource</span> <span class="nx">availability</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">foreground</span> <span class="nx">operations</span><span class="p">.</span> 
<span class="nx">Subsequently</span><span class="p">,</span> <span class="nx">it</span> <span class="nx">decides</span> <span class="nx">on</span> <span class="nx">how</span> <span class="nx">many</span> <span class="nx">time</span> <span class="nx">slices</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">available</span> <span class="nx">to</span> <span class="nx">background</span> <span class="nx">tasks</span><span class="p">,</span> <span class="nx">thereby</span> <span class="nx">using</span> 
<span class="nx">the</span> <span class="nx">feedback</span> <span class="nx">loop</span> <span class="nx">to</span> <span class="nx">limit</span> <span class="nx">the</span> <span class="nx">intrusiveness</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">background</span> <span class="nx">activities</span><span class="p">.</span> <span class="nx">Note</span> <span class="nx">that</span> <span class="nx">a</span> <span class="nx">similar</span> <span class="nx">problem</span> 
<span class="nx">of</span> <span class="nx">managing</span> <span class="nx">background</span> <span class="nx">tasks</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">studied</span> <span class="k">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">].</span>

<span class="mf">6.6</span> <span class="nx">Discussion</span>

<span class="nx">This</span> <span class="nx">section</span> <span class="nx">summarizes</span> <span class="nx">some</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">experiences</span> <span class="nx">gained</span> <span class="nx">during</span> <span class="nx">the</span> <span class="nx">process</span> <span class="nx">of</span> <span class="nx">implementation</span> <span class="nx">and</span> 
<span class="nx">maintenance</span> <span class="nx">of</span> <span class="nx">Dynamo</span><span class="p">.</span> <span class="nx">Many</span> <span class="nx">Amazon</span> <span class="nx">internal</span> <span class="nx">services</span> <span class="nx">have</span> <span class="nx">used</span> <span class="nx">Dynamo</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">past</span> <span class="nx">two</span> <span class="nx">years</span> <span class="nx">and</span> 
<span class="nx">it</span> <span class="nx">has</span> <span class="nx">provided</span> <span class="nx">significant</span> <span class="nx">levels</span> <span class="nx">of</span> <span class="nx">availability</span> <span class="nx">to</span> <span class="nx">its</span> <span class="nx">applications</span><span class="p">.</span> <span class="nx">In</span> <span class="nx">particular</span><span class="p">,</span> <span class="nx">applications</span> 
<span class="nx">have</span> <span class="nx">received</span> <span class="nx">successful</span> <span class="nx">responses</span> <span class="p">(</span><span class="nx">without</span> <span class="nx">timing</span> <span class="nx">out</span><span class="p">)</span> <span class="k">for</span> <span class="mf">99.9995</span><span class="o">%</span> <span class="nx">of</span> <span class="nx">its</span> <span class="nx">requests</span> <span class="nx">and</span> <span class="nx">no</span> <span class="nx">data</span> <span class="nx">loss</span> 
<span class="nx">event</span> <span class="nx">has</span> <span class="nx">occurred</span> <span class="nx">to</span> <span class="nx">date</span><span class="p">.</span>

<span class="nx">Moreover</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">primary</span> <span class="nx">advantage</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">provides</span> <span class="nx">the</span> <span class="nx">necessary</span> <span class="nx">knobs</span> <span class="nx">using</span> <span class="nx">the</span> <span class="nx">three</span> 
<span class="nx">parameters</span> <span class="nx">of</span> <span class="p">(</span><span class="nx">N</span><span class="p">,</span><span class="nx">R</span><span class="p">,</span><span class="nx">W</span><span class="p">)</span> <span class="nx">to</span> <span class="nx">tune</span> <span class="nx">their</span> <span class="nx">instance</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">their</span> <span class="nx">needs</span><span class="p">..</span> <span class="nx">Unlike</span> <span class="nx">popular</span> <span class="nx">commercial</span> <span class="nx">data</span> 
<span class="nx">stores</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">exposes</span> <span class="nx">data</span> <span class="nx">consistency</span> <span class="nx">and</span> <span class="nx">reconciliation</span> <span class="nx">logic</span> <span class="nx">issues</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">developers</span><span class="p">.</span> <span class="nx">At</span> <span class="nx">the</span> 
<span class="nx">outset</span><span class="p">,</span> <span class="nx">one</span> <span class="nx">may</span> <span class="nx">expect</span> <span class="nx">the</span> <span class="nx">application</span> <span class="nx">logic</span> <span class="nx">to</span> <span class="nx">become</span> <span class="nx">more</span> <span class="nx">complex</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">historically</span><span class="p">,</span> <span class="nx">Amazon</span><span class="err">’</span><span class="nx">s</span> 
<span class="nx">platform</span> <span class="nx">is</span> <span class="nx">built</span> <span class="k">for</span> <span class="nx">high</span> <span class="nx">availability</span> <span class="nx">and</span> <span class="nx">many</span> <span class="nx">applications</span> <span class="nx">are</span> <span class="nx">designed</span> <span class="nx">to</span> <span class="nx">handle</span> <span class="nx">different</span> <span class="nx">failure</span> 
<span class="nx">modes</span> <span class="nx">and</span> <span class="nx">inconsistencies</span> <span class="nx">that</span> <span class="nx">may</span> <span class="nx">arise</span><span class="p">.</span> <span class="nx">Hence</span><span class="p">,</span> <span class="nx">porting</span> <span class="nx">such</span> <span class="nx">applications</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">Dynamo</span> <span class="nx">was</span> <span class="nx">a</span> 
<span class="nx">relatively</span> <span class="nx">simple</span> <span class="nx">task</span><span class="p">.</span> <span class="nx">For</span> <span class="k">new</span> <span class="nx">applications</span> <span class="nx">that</span> <span class="nx">want</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">Dynamo</span><span class="p">,</span> <span class="nx">some</span> <span class="nx">analysis</span> <span class="nx">is</span> <span class="nx">required</span> 
<span class="nx">during</span> <span class="nx">the</span> <span class="nx">initial</span> <span class="nx">stages</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">development</span> <span class="nx">to</span> <span class="nx">pick</span> <span class="nx">the</span> <span class="nx">right</span> <span class="nx">conflict</span> <span class="nx">resolution</span> <span class="nx">mechanisms</span> <span class="nx">that</span> 
<span class="nx">meet</span> <span class="nx">the</span> <span class="nx">business</span> <span class="k">case</span> <span class="nx">appropriately</span><span class="p">.</span> <span class="nx">Finally</span><span class="p">,</span> <span class="nx">Dynamo</span> <span class="nx">adopts</span> <span class="nx">a</span> <span class="nx">full</span> <span class="nx">membership</span> <span class="nx">model</span> <span class="nx">where</span> <span class="nx">each</span> <span class="nx">node</span> 
<span class="nx">is</span> <span class="nx">aware</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">data</span> <span class="nx">hosted</span> <span class="nx">by</span> <span class="nx">its</span> <span class="nx">peers</span><span class="p">.</span> <span class="nx">To</span> <span class="k">do</span> <span class="k">this</span><span class="p">,</span> <span class="nx">each</span> <span class="nx">node</span> <span class="nx">actively</span> <span class="nx">gossips</span> <span class="nx">the</span> <span class="nx">full</span> <span class="nx">routing</span> <span class="nx">table</span>
<span class="kd">with</span> <span class="nx">other</span> <span class="nx">nodes</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">system</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">model</span> <span class="nx">works</span> <span class="nx">well</span> <span class="k">for</span> <span class="nx">a</span> <span class="nx">system</span> <span class="nx">that</span> <span class="nx">contains</span> <span class="nx">couple</span> <span class="nx">of</span> <span class="nx">hundreds</span> <span class="nx">of</span> 
<span class="nx">nodes</span><span class="p">.</span> <span class="nx">However</span><span class="p">,</span> <span class="nx">scaling</span> <span class="nx">such</span> <span class="nx">a</span> <span class="nx">design</span> <span class="nx">to</span> <span class="nx">run</span> <span class="kd">with</span> <span class="nx">tens</span> <span class="nx">of</span> <span class="nx">thousands</span> <span class="nx">of</span> <span class="nx">nodes</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">trivial</span> <span class="nx">because</span> <span class="nx">the</span> 
<span class="nx">overhead</span> <span class="k">in</span> <span class="nx">maintaining</span> <span class="nx">the</span> <span class="nx">routing</span> <span class="nx">table</span> <span class="nx">increases</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">system</span> <span class="nx">size</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">limitation</span> <span class="nx">might</span> <span class="nx">be</span> 
<span class="nx">overcome</span> <span class="nx">by</span> <span class="nx">introducing</span> <span class="nx">hierarchical</span> <span class="nx">extensions</span> <span class="nx">to</span> <span class="nx">Dynamo</span><span class="p">.</span> <span class="nx">Also</span><span class="p">,</span> <span class="nx">note</span> <span class="nx">that</span> <span class="k">this</span> <span class="nx">problem</span> <span class="nx">is</span> <span class="nx">actively</span> 
<span class="nx">addressed</span> <span class="nx">by</span> <span class="nx">O</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="nx">DHT</span> <span class="nx">systems</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.,</span> <span class="p">[</span><span class="mi">14</span><span class="p">]).</span>

<span class="mi">7</span><span class="p">.</span> <span class="nx">Conclusions</span>

<span class="nx">This</span> <span class="nx">paper</span> <span class="nx">described</span> <span class="nx">Dynamo</span><span class="p">,</span> <span class="nx">a</span> <span class="nx">highly</span> <span class="nx">available</span> <span class="nx">and</span> <span class="nx">scalable</span> <span class="nx">data</span> <span class="nx">store</span><span class="p">,</span> <span class="nx">used</span> <span class="k">for</span> <span class="nx">storing</span> <span class="nx">state</span> 
<span class="nx">of</span> <span class="nx">a</span> <span class="nx">number</span> <span class="nx">of</span> <span class="nx">core</span> <span class="nx">services</span> <span class="nx">of</span> <span class="nx">Amazon</span><span class="p">.</span><span class="nx">com</span><span class="err">’</span><span class="nx">s</span> <span class="nx">e</span><span class="o">-</span><span class="nx">commerce</span> <span class="nx">platform</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">has</span> <span class="nx">provided</span> <span class="nx">the</span> <span class="nx">desired</span> 
<span class="nx">levels</span> <span class="nx">of</span> <span class="nx">availability</span> <span class="nx">and</span> <span class="nx">performance</span> <span class="nx">and</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">successful</span> <span class="k">in</span> <span class="nx">handling</span> <span class="nx">server</span> <span class="nx">failures</span><span class="p">,</span> <span class="nx">data</span> 
<span class="nx">center</span> <span class="nx">failures</span> <span class="nx">and</span> <span class="nx">network</span> <span class="nx">partitions</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">is</span> <span class="nx">incrementally</span> <span class="nx">scalable</span> <span class="nx">and</span> <span class="nx">allows</span> <span class="nx">service</span> <span class="nx">owners</span> 
<span class="nx">to</span> <span class="nx">scale</span> <span class="nx">up</span> <span class="nx">and</span> <span class="nx">down</span> <span class="nx">based</span> <span class="nx">on</span> <span class="nx">their</span> <span class="nx">current</span> <span class="nx">request</span> <span class="nx">load</span><span class="p">.</span> <span class="nx">Dynamo</span> <span class="nx">allows</span> <span class="nx">service</span> <span class="nx">owners</span> <span class="nx">to</span> <span class="nx">customize</span> 
<span class="nx">their</span> <span class="nx">storage</span> <span class="nx">system</span> <span class="nx">to</span> <span class="nx">meet</span> <span class="nx">their</span> <span class="nx">desired</span> <span class="nx">performance</span><span class="p">,</span> <span class="nx">durability</span> <span class="nx">and</span> <span class="nx">consistency</span> <span class="nx">SLAs</span> <span class="nx">by</span> <span class="nx">allowing</span> 
<span class="nx">them</span> <span class="nx">to</span> <span class="nx">tune</span> <span class="nx">the</span> <span class="nx">parameters</span> <span class="nx">N</span><span class="p">,</span> <span class="nx">R</span><span class="p">,</span> <span class="nx">and</span> <span class="nx">W</span><span class="p">.</span>

<span class="nx">The</span> <span class="nx">production</span> <span class="nx">use</span> <span class="nx">of</span> <span class="nx">Dynamo</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">past</span> <span class="nx">year</span> <span class="nx">demonstrates</span> <span class="nx">that</span> <span class="nx">decentralized</span> <span class="nx">techniques</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">combined</span> 
<span class="nx">to</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="nx">single</span> <span class="nx">highly</span><span class="o">-</span><span class="nx">available</span> <span class="nx">system</span><span class="p">.</span> <span class="nx">Its</span> <span class="nx">success</span> <span class="k">in</span> <span class="nx">one</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">most</span> <span class="nx">challenging</span> <span class="nx">application</span> 
<span class="nx">environments</span> <span class="nx">shows</span> <span class="nx">that</span> <span class="nx">an</span> <span class="nx">eventual</span><span class="o">-</span><span class="nx">consistent</span> <span class="nx">storage</span> <span class="nx">system</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">a</span> <span class="nx">building</span> <span class="nx">block</span> <span class="k">for</span> <span class="nx">highly</span><span class="o">-</span><span class="nx">available</span> 
<span class="nx">applications</span><span class="p">.</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 